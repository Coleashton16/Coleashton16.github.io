<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antihypertensives Learning Module</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CSS configuration to use the Inter font.
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    keyframes: {
                        'fade-in': {
                            '0%': { opacity: '0', transform: 'scale(0.95)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                    },
                    animation: {
                        'fade-in': 'fade-in 0.3s ease-out forwards',
                    },
                },
            },
        };
    </script>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="font-sans antialiased text-gray-900 bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        // --- React and Library Setup ---
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- Mock Authentication Setup for Standalone Demo ---
        // This mock object simulates basic user authentication to allow progress tracking via localStorage.
        // In a real application, this would be replaced with actual Firebase authentication.
        const mockAuth = {
            onAuthStateChanged: (callback) => {
                // Simulate an asynchronous authentication check, providing a unique user ID.
                setTimeout(() => callback({ uid: 'standalone-antihypertensive-user' }), 100);
                return () => {}; // Returns an empty function as a cleanup/unsubscribe placeholder.
            },
            signInAnonymously: () => Promise.resolve({ user: { uid: 'standalone-antihypertensive-user' } }), // Mock anonymous sign-in.
        };

        // --- Content & Data Structure for the Learning Modules ---
        // The main content is broken down into smaller, focused modules based on concepts.
        const contentData = {
            'intro-hypertension': {
                title: 'Introduction to Hypertension',
                color: 'from-sky-500 to-cyan-400',
                description: 'Understand hypertension, its guidelines, and physiological regulators.',
                steps: [
                    { id: 'hypertension-overview', title: 'Hypertension: Overview & Types', type: 'text', content: `<strong>Hypertension</strong> is the most common condition leading to myocardial infarction (MI), stroke, renal failure, and death.
                        <br><br>
                        <strong>Essential hypertension:</strong> Affects 95% of persons with high blood pressure (BP). Its exact origin is unknown, but contributing factors include hyperlipidemia, African American race, diabetes, aging, stress, excessive alcohol ingestion, smoking, obesity (30% of cases), and family history.
                        <br><br>
                        <strong>Secondary hypertension:</strong> Accounts for 5% of cases, related to renal and endocrine disorders.` },
                    { id: 'hypertension-guidelines', title: 'Guidelines for Hypertension (JNC 8)', type: 'text', content: `BP data should be based on an average of more than two readings on more than two occasions. The JNC 8 (2017) guidelines aim to decrease the risk of cardiovascular disease (CVD).
                        <ul>
                            <li><strong>Normal BP:</strong> Less than 120/80 mm Hg</li>
                            <li><strong>Elevated BP:</strong> Systolic (SBP) 120 to 129 and Diastolic (DBP) less than 80</li>
                            <li><strong>Stage 1 Hypertension:</strong> 130/80 to 139/89</li>
                            <li><strong>Stage 2 Hypertension:</strong> 140/90 or greater</li>
                        </ul>
                        SBP is more important than DBP as a CVD risk.
                        <br><br>
                        According to JNC 8:
                        <ul>
                            <li>BP goal for population younger than 60 years: 140/90 mm Hg.</li>
                            <li>BP target for those above 60 years: 150/90 mm Hg.</li>
                        </ul>
                        Two out of three patients with hypertension have uncontrolled BP or are not optimally treated. Only approximately 48% of hypertensive individuals have this condition under control.` },
                    { id: 'bp-regulators', title: 'Selected Regulators of Blood Pressure', type: 'text', content: `The kidneys and blood vessels regulate BP.
                        <ul>
                            <li><strong>Kidneys:</strong> Control fluid volume and the <strong>renin-angiotensin-aldosterone system (RAAS)</strong>. Renin stimulates angiotensin II (potent vasoconstrictor), which causes aldosterone release. Aldosterone promotes sodium and water retention, increasing fluid volume and BP.</li>
                            <li><strong>Baroreceptors:</strong> In the aorta and carotid sinus, assist in BP regulation.</li>
                            <li><strong>Vasomotor center:</strong> In the medulla, assists in BP regulation.</li>
                            <li><strong>Catecholamines:</strong> Norepinephrine (from sympathetic nerve terminals) and epinephrine (from adrenal medulla) increase BP through vasoconstriction.</li>
                            <li><strong>Other hormones:</strong>
                                <ul>
                                    <li><strong>Antidiuretic hormone (ADH):</strong> Stimulates kidneys to conserve water during fluid deficit; inhibited during fluid overload to excrete water.</li>
                                    <li><strong>Atrial natriuretic peptide (ANP) hormone:</strong> Promotes vasodilation and increased GFR, leading to increased urine volume and decreased BP.</li>
                                    <li><strong>Brain natriuretic peptide (BNP) hormone:</strong> Aids in HF diagnosis, promoting vasodilation and diuresis.</li>
                                </ul>
                            </li>
                        </ul>` },
                    { id: 'physiologic-risk-factors', title: 'Physiologic Risk Factors & Cultural Responses', type: 'text', content: `<strong>Physiologic Risk Factors:</strong>
                        <ul>
                            <li>Diet high in saturated fat and simple carbohydrates (can increase BP).</li>
                            <li>Alcohol (increases renin secretions).</li>
                            <li>Obesity (increases cardiac output, stroke volume, left ventricular filling; two-thirds of hypertensive persons are obese). Weight loss and mild-moderate sodium restriction can decrease hypertension.</li>
                        </ul>
                        <strong>Cultural Responses to Antihypertensive Agents:</strong>
                        <ul>
                            <li><strong>African Americans:</strong> More likely to develop hypertension at an earlier age and have a higher mortality rate. Beta-adrenergic blockers and ACE inhibitors are less effective unless combined with a diuretic (due to susceptibility to low-renin hypertension). Alpha1 blockers and calcium channel blockers are effective. They respond well to diuretics as initial monotherapy.</li>
                            <li><strong>Asian Americans:</strong> Twice as sensitive as Caucasians to beta blockers and other antihypertensives; often require reduced dosing.</li>
                            <li><strong>Native Americans:</strong> Reduced or lower response to beta blockers compared with Caucasians.</li>
                        </ul>
                        Monitoring BP and drug dosing is crucial for these cultural groups.` },
                    { id: 'hypertension-older-adults', title: 'Hypertension in Older Adults', type: 'text', content: `Approximately 70 million American adults (46% of the adult population) have hypertension. Of individuals over 60 years of age, 65% have developed hypertension (two in three people). Only about 48% of hypertensive individuals have this condition under control.
                        <br><br>
                        Males aged 18-49 typically have a higher prevalence of hypertension than females. Both systolic and diastolic hypertension are associated with increased cardiovascular morbidity and mortality. Antihypertensive therapy can lead to a 34% decrease in stroke and a 19% decrease in coronary heart disease.
                        <br><br>
                        A troublesome side effect in older adults (especially frail or institutionalized) is <strong>orthostatic (postural) hypotension</strong>. This sudden low BP causes dizziness due to blood pooling in lower extremities when repositioning upright. The sympathetic nervous system in older adults may not respond as quickly, especially with antihypertensive drugs. The drug dose may need to be decreased or changed.
                        <br><br>
                        Older adults with hypertension should:
                        <ul>
                            <li>Restrict dietary sodium to 2400 mg daily.</li>
                            <li>Avoid tobacco.</li>
                            <li>Modify diet.</li>
                            <li>Exercise.</li>
                            <li>Decrease stress.</li>
                        </ul>` },
                    { id: 'nonpharm-control', title: 'Nonpharmacologic Control of Hypertension', type: 'text', content: `Nonpharmacologic methods can significantly decrease BP. If systolic pressure is greater than 140 mm Hg, antihypertensive drugs are generally ordered.
                        <br><br>
                        Nondrug methods to decrease BP include:
                        <ul>
                            <li>Stress-reduction techniques</li>
                            <li>Exercise</li>
                            <li>Salt restriction</li>
                            <li>Decreased alcohol ingestion</li>
                            <li>Smoking cessation</li>
                        </ul>
                        These methods should be combined with antihypertensive drugs for optimal control.` },
                    { id: 'pharmacologic-control', title: 'Pharmacologic Control of Hypertension', type: 'text', content: `Treatment of hypertension is individualized. Emphasis is placed on reducing other cardiovascular risk factors and using fewer drugs (substituting instead of adding) at the lowest effective doses. Often, more than one antihypertensive is used to control BP, which can also lead to fewer adverse effects.
                        <br><br>
                        Antihypertensive drugs are classified into seven categories:
                        <ol>
                            <li>Diuretics</li>
                            <li>Sympatholytics (sympathetic depressants)</li>
                            <li>Direct-acting arteriolar vasodilators</li>
                            <li>ACE inhibitors</li>
                            <li>Angiotensin II–receptor blockers (ARBs)</li>
                            <li>Direct renin inhibitors</li>
                            <li>Calcium channel blockers</li>
                        </ol>` },
                    { id: 'hypertension-intro-quiz', title: 'Intro to Hypertension Quiz', type: 'quiz',
                      questions: [
                          { question: "According to JNC 8 guidelines, what is considered Stage 1 hypertension?", options: ["Less than 120/80 mm Hg", "120-129/<80 mm Hg", "130/80 to 139/89 mm Hg", "140/90 mm Hg or greater"], correctAnswer: "130/80 to 139/89 mm Hg" },
                          { question: "Which of the following ethnic groups is more likely to develop hypertension at an earlier age and has a higher mortality rate from hypertension?", options: ["Asian Americans", "Native Americans", "Caucasians", "African Americans"], correctAnswer: "African Americans" },
                          { question: "What is a common troublesome side effect of antihypertensive agents in older adults, especially frail or institutionalized persons?", options: ["Hyperglycemia", "Orthostatic hypotension", "Tachycardia", "Weight gain"], correctAnswer: "Orthostatic hypotension" },
                          { question: "Which nonpharmacologic method is generally recommended to help control hypertension?", options: ["Increased alcohol consumption", "Strenuous daily exercise without prior consultation", "Significant salt restriction", "Smoking a few cigarettes daily"], correctAnswer: "Significant salt restriction" }
                      ]
                    },
                ]
            },
            'diuretics-antihypertensives': {
                title: 'Diuretics as Antihypertensives',
                color: 'from-green-500 to-lime-400',
                description: 'Understand the role of diuretics in managing hypertension.',
                steps: [
                    { id: 'diuretics-htn', title: 'Diuretics in Hypertension', type: 'text', content: `<strong>Diuretics</strong> promote sodium depletion, which decreases extracellular fluid volume (ECFV). They are effective as <strong>first-line drugs for treating mild hypertension</strong>.
                        <br><br>
                        <ul>
                            <li><strong>Hydrochlorothiazide</strong> is the most frequently prescribed diuretic for controlling mild hypertension by decreasing excess fluid volume. It can be used alone for recently diagnosed or mild hypertension, or with other antihypertensive drugs.</li>
                            <li>Many antihypertensive drugs can cause fluid retention, so diuretics are often administered concurrently.</li>
                            <li><strong>Thiazide diuretics</strong> are not recommended for patients with renal insufficiency (creatinine clearance <30 mL/min).</li>
                            <li><strong>Loop (high-ceiling) diuretics</strong> (e.g., furosemide) are usually recommended for renal insufficiency because they do not depress renal blood flow. However, they are not used if hypertension is due to RAAS involvement, as they tend to immediately elevate serum renin levels.</li>
                            <li>A combination of potassium-wasting and potassium-sparing diuretics may be used to minimize potassium excretion.</li>
                            <li>Thiazides can be combined with other antihypertensive drugs (beta blockers, ACE inhibitors, ARBs, centrally acting alpha2 agonists) to increase effectiveness. For example, ACE inhibitors increase serum potassium, so combining them with a thiazide minimizes potassium loss.</li>
                        </ul>` },
                    { id: 'diuretics-htn-quiz', title: 'Diuretics & HTN Quiz', type: 'quiz',
                      questions: [
                          { question: "Which diuretic is most commonly prescribed as a first-line agent for mild hypertension?", options: ["Furosemide", "Spironolactone", "Mannitol", "Hydrochlorothiazide"], correctAnswer: "Hydrochlorothiazide" },
                          { question: "For patients with renal insufficiency (creatinine clearance <30 mL/min), which type of diuretic is generally recommended for hypertension?", options: ["Thiazide diuretics", "Loop diuretics", "Potassium-sparing diuretics", "Carbonic anhydrase inhibitors"], correctAnswer: "Loop diuretics" }
                      ]
                    }
                ]
            },
            'sympatholytics': {
                title: 'Sympatholytics (Sympathetic Depressants)',
                color: 'from-red-500 to-orange-400',
                description: 'Explore beta blockers, alpha agonists, and other sympatholytic agents.',
                steps: [
                    { id: 'sympatholytics-intro', title: 'Introduction to Sympatholytics', type: 'text', content: `<strong>Sympatholytics (sympathetic depressants)</strong> decrease the effects of the sympathetic nervous system. They comprise five groups:
                        <ol>
                            <li>Beta-adrenergic blockers</li>
                            <li>Centrally acting alpha2 agonists</li>
                            <li>Alpha-adrenergic blockers</li>
                            <li>Adrenergic neuron blockers (peripherally acting sympatholytics)</li>
                            <li>Alpha1- and beta1-adrenergic blockers</li>
                        </ol>` },
                    { id: 'beta-blockers-htn', title: 'Beta-Adrenergic Blockers in Hypertension', type: 'text', content: `<strong>Beta-adrenergic blockers (beta blockers)</strong> are used as antihypertensive drugs, often combined with a diuretic. They also serve as antianginals and antidysrhythmics.
                        <br><br>
                        <strong>Mechanism:</strong> Reduce cardiac output by diminishing sympathetic nervous system response, decreasing basal sympathetic tone. With continued use, vascular resistance is diminished, and BP is lowered. They reduce heart rate, contractility, and renin release. The hypotensive response is greater in patients with higher renin levels.
                        <br><br>
                        <strong>Cultural Response:</strong> Less effective for hypertension in African Americans alone; effective when combined with diuretics.
                        <br><br>
                        <strong>Types:</strong>
                        <ul>
                            <li><strong>Nonselective:</strong> (e.g., propranolol, carvedilol) Inhibit beta1 (heart) and beta2 (bronchial) receptors. Slows heart rate, decreases BP, and causes bronchoconstriction.</li>
                            <li><strong>Cardioselective:</strong> (e.g., acebutolol, atenolol, betaxolol, bisoprolol, metoprolol) Primarily act on beta1 receptors, so bronchoconstriction is less likely. Atenolol has demonstrated true protection against bronchoconstriction. Cardioselectivity helps maintain renal blood flow and minimizes hypoglycemic effects.</li>
                        </ul>
                        <strong>Contraindications:</strong> Second- or third-degree AV block, sinus bradycardia. Noncardioselective beta blockers should not be given to patients with COPD.
                        <br><br>
                        <strong>Side Effects/Adverse Reactions:</strong> Decreased pulse rate, markedly decreased BP, bronchospasm (noncardioselective). Do not abruptly discontinue (rebound hypertension, angina, dysrhythmias, MI). Can cause dizziness, insomnia, depression, fatigue, nightmares, erectile dysfunction. Use with caution in diabetes mellitus (inhibit glycogen to glucose conversion, masking hypoglycemia). Bradycardia is common.` },
                    { id: 'beta-blockers-np', title: 'Beta Blockers: Nursing Process', type: 'text', content: `<strong>Concept: Perfusion</strong><br>
                        <strong>Recognize Cues (Assessment):</strong>
                        <ul>
                            <li>Obtain medication and herbal history; report probable interactions (e.g., Ma-huang, Ephedra, Black cohosh, Hawthorn, Licorice, Korean ginseng, Milk thistle, Goldenseal, Parsley, Cayenne, Chinese skullcap, St. John’s wort).</li>
                            <li>Obtain vital signs; report abnormal BP/bradycardia and compare to baseline.</li>
                            <li>Check renal and liver function labs (BUN, serum creatinine, AST, LDH).</li>
                        </ul>
                        <strong>Analyze Cues and Prioritize Hypothesis (Patient Problems):</strong> Hypertension, Fatigue.<br>
                        <strong>Generate Solutions (Planning):</strong> Patient’s BP will be 120/80 or below; patient will take medication as prescribed.<br>
                        <strong>Take Action (Nursing Interventions):</strong>
                        <ul>
                            <li>Monitor vital signs (BP and pulse).</li>
                            <li>Monitor lab results (BUN, serum creatinine, AST, LDH).</li>
                        </ul>
                        <strong>Patient Teaching:</strong>
                        <ul>
                            <li><strong>General:</strong> Adhere to regimen (abrupt discontinuation causes rebound hypertension); avoid OTC drugs without provider check; wear MedicAlert bracelet; inform healthcare providers in trauma situations (beta blockers block compensatory effects, may need glucagon).</li>
                            <li><strong>Self-Administration:</strong> Teach radial pulse and BP measurement, report abnormal findings.</li>
                            <li><strong>Side Effects:</strong> Rise slowly (orthostatic hypotension); report dizziness, slow pulse, BP changes, palpitations, confusion, GI upset; alert diabetics to hypoglycemic symptoms; inform males about sexual dysfunction.</li>
                            <li><strong>Diet:</strong> Teach nonpharmacologic methods (low-salt, relaxation, exercise, smoking cessation, limited alcohol); report constipation (fiber, stool softener, increased water).</li>
                        </ul>
                        <strong>Evaluate Outcomes (Evaluation):</strong> Evaluate drug effectiveness (decreased BP, absence of side effects) and patient adherence.` },
                    { id: 'central-alpha2-agonists', title: 'Centrally Acting Alpha2 Agonists', type: 'text', content: `<strong>Centrally acting alpha2 agonists</strong> (e.g., methyldopa, clonidine, guanfacine) decrease sympathetic response from the brainstem to peripheral vessels. They stimulate alpha2 receptors, decreasing sympathetic activity, increasing vagus activity, decreasing cardiac output, and reducing serum epinephrine, norepinephrine, and renin release. This results in reduced peripheral vascular resistance and increased vasodilation. They have minimal effects on cardiac output and renal blood flow.
                        <br><br>
                        <strong>Important:</strong> Not given with beta blockers (accentuate bradycardia, rebound hypertension on discontinuation).
                        <br><br>
                        <strong>Characteristics:</strong>
                        <ul>
                            <li>Methyldopa and clonidine can cause sodium and water retention in high doses; often given with diuretics.</li>
                            <li>Clonidine is available as a transdermal patch (7-day duration).</li>
                            <li>Guanfacine has a long half-life, usually taken once daily; less likely to cause rebound hypertension.</li>
                        </ul>
                        <strong>Side Effects/Adverse Reactions:</strong> Drowsiness, dry mouth, dizziness, slow heart rate (bradycardia). Methyldopa contraindicated in impaired liver function; monitor liver enzymes.
                        <br><br>
                        <strong>Critical:</strong> Must not be abruptly discontinued (risk of rebound hypertensive crisis: restlessness, tachycardia, tremors, headache, increased BP). If stopping, another antihypertensive is usually prescribed.
                        <br><br>
                        Can cause sodium and water retention (peripheral edema); diuretics may be ordered concurrently. Clonidine should be avoided in pregnancy; methyldopa is used for chronic or pregnancy-induced hypertension but crosses the placental barrier and enters breast milk.` },
                    { id: 'alpha-blockers-htn', title: 'Alpha-Adrenergic Blockers in Hypertension', type: 'text', content: `<strong>Alpha-adrenergic blockers (alpha blockers)</strong> block alpha-adrenergic receptors, causing vasodilation and decreased BP. They help maintain renal blood flow.
                        <br><br>
                        <strong>Benefits:</strong> Useful for patients with lipid abnormalities (decrease VLDL and LDL, increase HDL). Safe for diabetes (do not affect glucose metabolism). Do not affect respiratory function.
                        <br><br>
                        <strong>Types:</strong>
                        <ul>
                            <li><strong>Nonselective:</strong> (e.g., phenoxybenzamine, phentolamine) Should not be given to patients with coronary artery disease (stimulating effects, increased myocardial oxygen demand). More effective for acute hypertension.</li>
                            <li><strong>Selective alpha1-adrenergic blockers:</strong> (e.g., prazosin, terazosin, doxazosin) Used mainly to reduce BP and treat benign prostatic hypertrophy (BPH). Prazosin is common; terazosin and doxazosin have longer half-lives (once daily at bedtime).</li>
                        </ul>
                        Like centrally acting alpha2 agonists, they cause sodium and water retention with edema; diuretics are often given concurrently.
                        <br><br>
                        <strong>Pharmacokinetics:</strong> Prazosin absorbed via GI, but significant first-pass metabolism. Short half-life (twice daily). Highly protein bound.
                        <br><br>
                        <strong>Pharmacodynamics:</strong> Dilate arterioles and venules, decreasing peripheral resistance and BP. Prazosin causes slight increase in heart rate; nonselective alpha blockers cause greater BP reduction and reflex tachycardia. Selective alpha blockers are better for long-term essential hypertension.
                        <br><br>
                        <strong>Side Effects/Adverse Reactions:</strong>
                        <ul>
                            <li>Prazosin, doxazosin, terazosin: Orthostatic hypotension (dizziness, faintness, lightheadedness, increased heart rate, especially with first dose), nausea, headache, drowsiness, nasal congestion, edema, weight gain.</li>
                            <li>Phentolamine: Hypotension, reflex tachycardia, nasal congestion, GI disturbances.</li>
                        </ul>
                        <strong>Drug Interactions:</strong> Intensified peripheral edema with antiinflammatory drugs. Syncope with nitrates (e.g., nitroglycerin) due to decreased BP.` },
                    { id: 'alpha-blockers-np', title: 'Alpha-Adrenergic Blockers: Nursing Process', type: 'text', content: `<strong>Concept: Perfusion</strong><br>
                        <strong>Recognize Cues (Assessment):</strong>
                        <ul>
                            <li>Obtain medication history (including current drugs and herbals); report probable interactions (prazosin is highly protein bound).</li>
                            <li>Obtain baseline vital signs and weight.</li>
                            <li>Check urinary output; report if decreased (<600 mL/day) as contraindicated in renal disease.</li>
                        </ul>
                        <strong>Analyze Cues and Prioritize Hypothesis (Patient Problems):</strong> Hypertension, Fatigue.<br>
                        <strong>Generate Solutions (Planning):</strong> Patient’s BP will decrease to 120/80 or below; patient will follow proper drug regimen.<br>
                        <strong>Take Action (Nursing Interventions):</strong>
                        <ul>
                            <li>Monitor vital signs. Full therapeutic effect of prazosin may take 4 weeks. Report sudden marked decrease in BP and tachycardia.</li>
                            <li>Check daily for fluid retention in extremities and weight gain (prazosin may cause sodium and water retention).</li>
                        </ul>
                        <strong>Patient Teaching:</strong>
                        <ul>
                            <li><strong>General:</strong> Adhere to regimen (abrupt discontinuation causes rebound hypertension); explain orthostatic hypotension (sit/dangle feet before rising); drugs may be taken at bedtime to avoid orthostatic hypotension; self-monitor daily weights.</li>
                            <li><strong>Self-Administration:</strong> Teach how to take and record BP.</li>
                            <li><strong>Side Effects:</strong> Caution about dizziness, lightheadedness, drowsiness (especially initially); report to provider. Inform males about possible impotence with high doses. Report morning edema (water retention). Do not take OTC cold, cough, or allergy medications without provider contact.</li>
                            <li><strong>Diet:</strong> Encourage decreased salt intake (unless contraindicated).</li>
                        </ul>
                        <strong>Evaluate Outcomes (Evaluation):</strong> Evaluate drug effectiveness (BP control, absence of side effects), adherence, and patient knowledge.` },
                    { id: 'adrenergic-neuron-blockers', title: 'Adrenergic Neuron Blockers & Alpha1-/Beta1-Blockers', type: 'text', content: `<strong>Adrenergic Neuron Blockers (Peripherally Acting Sympatholytics):</strong>
                        <ul>
                            <li>Potent antihypertensive drugs that block norepinephrine release from sympathetic nerve endings, lowering BP.</li>
                            <li>Decrease cardiac output and peripheral vascular resistance.</li>
                            <li><strong>Reserpine</strong> (most potent) controls severe hypertension.</li>
                            <li><strong>Side Effects:</strong> Orthostatic hypotension (advise slow rising), pseudoparkinsonism, nightmares, suicidal ideation (use has declined).</li>
                            <li>Considered last choice for chronic hypertension due to orthostatic hypotension.</li>
                            <li>Can cause sodium and water retention; may be taken with a diuretic.</li>
                        </ul>
                        <br>
                        <strong>Alpha1- and Beta1-Adrenergic Blockers:</strong>
                        <ul>
                            <li>Block both alpha1 and beta1 receptors. <strong>Labetalol</strong> is an example.</li>
                            <li>Alpha1 blockade causes vasodilation, decreasing resistance and lowering BP.</li>
                            <li>Beta1 blockade decreases heart rate and AV contractility.</li>
                            <li>Effect on alpha receptor is stronger than beta.</li>
                            <li>Large doses can block beta2 receptors, increasing airway resistance; caution in severe asthma.</li>
                            <li><strong>Side Effects:</strong> Orthostatic hypotension, dizziness, paresthesia, nasal congestion, nausea, fatigue. Large doses may cause AV heart block.</li>
                        </ul>` },
                    { id: 'sympatholytics-quiz', title: 'Sympatholytics Quiz', type: 'quiz',
                      questions: [
                          { question: "Which of the following is a common side effect of nonselective beta blockers that is less likely with cardioselective beta blockers?", options: ["Bradycardia", "Hypotension", "Bronchoconstriction", "Dizziness"], correctAnswer: "Bronchoconstriction" },
                          { question: "A patient taking clonidine should be warned against abrupt discontinuation due to the risk of:", options: ["Severe bradycardia", "Rebound hypertensive crisis", "Hypoglycemic shock", "Angioedema"], correctAnswer: "Rebound hypertensive crisis" },
                          { question: "Which class of antihypertensive drugs is known to decrease VLDL and LDL, and increase HDL, making them useful in patients with lipid abnormalities?", options: ["Beta blockers", "Centrally acting alpha2 agonists", "Alpha-adrenergic blockers", "Direct-acting vasodilators"], correctAnswer: "Alpha-adrenergic blockers" },
                          { question: "Which of the following drugs is an alpha1- and beta1-adrenergic blocker?", options: ["Propranolol", "Clonidine", "Prazosin", "Labetalol"], correctAnswer: "Labetalol" }
                      ]
                    },
                ]
            },
            'vasodilators-acei-arbs-dri': {
                title: 'Vasodilators, ACEIs, ARBs, & DRIs',
                color: 'from-orange-400 to-red-500',
                description: 'Explore direct-acting vasodilators, angiotensin-converting enzyme inhibitors, angiotensin II-receptor blockers, and direct renin inhibitors.',
                steps: [
                    { id: 'direct-vasodilators', title: 'Direct-Acting Arteriolar Vasodilators', type: 'text', content: `<strong>Direct-acting vasodilators</strong> are potent antihypertensive drugs that relax the smooth muscles of blood vessels, mainly arteries, causing vasodilation. This increases blood flow to the brain and kidneys.
                        <br><br>
                        With vasodilation, BP decreases, and sodium and water are retained, leading to peripheral edema. Diuretics can be given concurrently to decrease edema.
                        <br><br>
                        <strong>Hydralazine</strong> and <strong>minoxidil</strong> are used for moderate to severe hypertension. They cause little orthostatic hypotension. However, reflex tachycardia and renin release can occur; beta blockers are often prescribed to counteract reflex tachycardia.
                        <br><br>
                        <strong>Nitroprusside</strong> is a very potent vasodilator prescribed for acute hypertensive emergency, rapidly decreasing BP by acting on both arterial and venous vessels.
                        <br><br>
                        <strong>Side Effects/Adverse Reactions:</strong>
                        <ul>
                            <li>Hydralazine: Reflex tachycardia, palpitations, edema, nasal congestion, headache, dizziness, lupus-like symptoms, neurologic symptoms.</li>
                            <li>Minoxidil: Similar to hydralazine, plus excess hair growth, and can precipitate anginal attack.</li>
                            <li>Nitroprusside: Reflex tachycardia, palpitations, restlessness, agitation, nausea, confusion.</li>
                        </ul>` },
                    { id: 'ace-inhibitors', title: 'Angiotensin-Converting Enzyme (ACE) Inhibitors', type: 'text', content: `<strong>ACE inhibitors</strong> (e.g., benazepril, captopril, enalapril, lisinopril) inhibit the formation of angiotensin II (a vasoconstrictor) and block aldosterone release.
                        <br><br>
                        <strong>Mechanism:</strong> When aldosterone is blocked, sodium and water are excreted, and potassium is retained. They cause little change in cardiac output or heart rate, and they lower peripheral resistance. Used primarily for hypertension; some also treat heart failure.
                        <br><br>
                        <strong>First-line therapy:</strong> Can be used, but thiazide diuretics are recommended by JNC 8.
                        <br><br>
                        <strong>Cultural/Age Response:</strong> Less effective in African Americans and older adults alone; effective when taken with a diuretic.
                        <br><br>
                        <strong>Contraindications:</strong> Pregnancy (reduce placental blood flow, harm to fetus). Do not take with potassium-sparing diuretics or salt substitutes containing potassium (risk of hyperkalemia).
                        <br><br>
                        <strong>Administration:</strong> Most can be taken with food, except moexipril (empty stomach). Dose reduction needed for renal insufficiency (except fosinopril).
                        <br><br>
                        <strong>Side Effects/Adverse Reactions:</strong>
                        <ul>
                            <li>Primary: Constant, irritated cough (may resolve upon discontinuance; ARB may be substituted).</li>
                            <li>Other: Nausea, vomiting, diarrhea, headache, dizziness, fatigue, insomnia, hyperkalemia, tachycardia.</li>
                            <li>Major adverse: First-dose hypotension (more common with diuretics), angioedema (rare, hypersensitivity, higher incidence in African Americans; can be reversed with drug discontinuance, may need epinephrine for laryngeal edema).</li>
                        </ul>` },
                    { id: 'ace-inhibitors-np', title: 'ACE Inhibitors: Nursing Process', type: 'text', content: `<strong>Concept: Perfusion</strong><br>
                        <strong>Recognize Cues (Assessment):</strong>
                        <ul>
                            <li>Obtain drug and herbal history; report probable interactions.</li>
                            <li>Obtain baseline vital signs.</li>
                            <li>Check lab values for serum protein, albumin, BUN, creatinine, potassium, WBC count.</li>
                        </ul>
                        <strong>Analyze Cues and Prioritize Hypothesis (Patient Problems):</strong> Hypertension, Anxiety, Fatigue.<br>
                        <strong>Generate Outcomes (Planning):</strong> Patient’s BP will decrease to 120/80 or below; patient will rise slowly to avoid orthostatic hypotension.<br>
                        <strong>Take Action (Nursing Interventions):</strong>
                        <ul>
                            <li>Monitor BP; report sudden drop.</li>
                            <li>Monitor renal function labs (BUN, creatinine, protein) and blood glucose (watch for hypoglycemia in diabetics). Check urine protein with dipstick.</li>
                            <li>Report bruising, petechiae, or bleeding (may indicate severe adverse reaction).</li>
                        </ul>
                        <strong>Patient Teaching:</strong>
                        <ul>
                            <li><strong>General:</strong> Do not abruptly discontinue (rebound hypertension); avoid OTC cold medications without provider check; avoid salt substitutes with potassium; pregnant/contemplating pregnancy patients should not take (harm to fetus); rise slowly (orthostatic hypotension).</li>
                            <li><strong>Self-Administration:</strong> Teach how to take and record BP.</li>
                            <li><strong>Side Effects:</strong> Explain dizziness/lightheadedness (especially initially); report if persistent. Monitor for angioedema, cough, dysgeusia, weakness, hyperkalemia, orthostatic hypotension, renal impairment. Report any bleeding.</li>
                            <li><strong>Diet:</strong> Take captopril 20 minutes to 1 hour before meal (food decreases absorption). Warn about diminished taste. Avoid high-potassium foods (hyperkalemia risk).</li>
                        </ul>
                        <strong>Evaluate Outcomes (Evaluation):</strong> Evaluate drug effectiveness (absence of severe side effects, BP in desired range) and renal function.` },
                    { id: 'arbs', title: 'Angiotensin II–Receptor Blockers (ARBs)', type: 'text', content: `<strong>Angiotensin II–Receptor Blockers (ARBs)</strong> (e.g., losartan, valsartan, irbesartan) are similar to ACE inhibitors in preventing aldosterone release and acting on the RAAS.
                        <br><br>
                        <strong>Difference from ACEIs:</strong> ARBs block angiotensin II from binding to angiotensin I (AT1) receptors in tissues, while ACE inhibitors prevent angiotensin II formation.
                        <br><br>
                        <strong>Effects:</strong> Cause vasodilation and decrease peripheral resistance. They do not cause the constant, irritated cough seen with ACE inhibitors.
                        <br><br>
                        <strong>Contraindications:</strong> Pregnancy (like ACE inhibitors).
                        <br><br>
                        <strong>Cultural Response:</strong> Less effective for hypertension in African American patients alone.
                        <br><br>
                        Can be used as first-line treatment for hypertension. Can be taken with or without food. Suitable for patients with mild hepatic insufficiency.
                        <br><br>
                        <strong>Side Effects/Adverse Reactions:</strong> Like ACE inhibitors, ARBs may cause angioedema. Other side effects include dizziness, drowsiness, cough, palpitations, blurred vision, headache, edema, nausea, diarrhea, abdominal and back pain, arthralgia, fatigue, muscle cramps, pharyngitis, erectile dysfunction. Life-threatening: Renal dysfunction, neutropenia.` },
                    { id: 'direct-renin-inhibitors', title: 'Direct Renin Inhibitors', type: 'text', content: `The first FDA-approved <strong>direct renin inhibitor</strong> for hypertension is <strong>aliskiren</strong>.
                        <br><br>
                        <strong>Mechanism:</strong> Binds with renin, reducing angiotensin I, angiotensin II, and aldosterone levels.
                        <br><br>
                        <strong>Uses:</strong> Effective for mild and moderate hypertension. Can be used alone or with another antihypertensive. Has an additive effect when combined with a thiazide diuretic or an ARB.
                        <br><br>
                        <strong>Cultural Response:</strong> As monotherapy, not as effective in reducing BP in the African American population.
                        <br><br>
                        <strong>Side Effects:</strong> Dizziness, hypotension, hyperkalemia, peripheral edema, diarrhea, hyperuricemia, gout, pharyngitis, cough.` },
                    { id: 'vasodilators-acei-arbs-dri-quiz', title: 'Vasodilators, ACEI, ARB, DRI Quiz', type: 'quiz',
                      questions: [
                          { question: "Which direct-acting vasodilator is primarily used for acute hypertensive emergencies due to its rapid action on both arterial and venous vessels?", options: ["Hydralazine", "Minoxidil", "Nitroprusside", "Amlodipine"], correctAnswer: "Nitroprusside" },
                          { question: "What is the most commonly occurring side effect of Angiotensin-Converting Enzyme (ACE) inhibitors?", options: ["Peripheral edema", "Reflex tachycardia", "Constant, irritated cough", "Hyperglycemia"], correctAnswer: "Constant, irritated cough" },
                          { question: "Which of the following is a key difference between Angiotensin II–Receptor Blockers (ARBs) and ACE inhibitors?", options: ["ARBs cause a persistent cough, while ACE inhibitors do not.", "ARBs are contraindicated in pregnancy, while ACE inhibitors are safe.", "ARBs block angiotensin II from receptors, while ACE inhibitors prevent its formation.", "ARBs lead to increased aldosterone release, while ACE inhibitors block it."], correctAnswer: "ARBs block angiotensin II from receptors, while ACE inhibitors prevent its formation." },
                          { question: "Aliskiren is the first FDA-approved drug in which class of antihypertensives?", options: ["Beta blockers", "Calcium channel blockers", "Direct renin inhibitors", "Alpha-adrenergic blockers"], correctAnswer: "Direct renin inhibitors" }
                      ]
                    },
                ]
            },
            'calcium-channel-blockers': {
                title: 'Calcium Channel Blockers',
                color: 'from-blue-600 to-indigo-800',
                description: 'Understand the actions, uses, and nursing considerations for calcium channel blockers in hypertension.',
                steps: [
                    { id: 'ccbs-actions-uses', title: 'CCBs: Actions and Uses', type: 'text', content: `<strong>Calcium Channel Blockers (CCBs)</strong>, also called calcium antagonists or calcium blockers, block calcium channels in vascular smooth muscle (VSM) cells. Free calcium increases muscle contractility, peripheral resistance, and BP.
                        <br><br>
                        <strong>Mechanism:</strong> Blocking calcium channels in VSM promotes vasodilation. Coronary and cerebral arteries and peripheral vessels are more sensitive to CCBs than large central arteries.
                        <br><br>
                        <strong>Characteristics:</strong> Highly protein bound but have a short half-life (slow-release preparations decrease administration frequency).
                        <br><br>
                        <strong>Types:</strong>
                        <ul>
                            <li><strong>Phenylalkylamines:</strong> (e.g., verapamil) Act on arterioles and the heart. Used for chronic hypertension, angina pectoris, cardiac dysrhythmias.</li>
                            <li><strong>Benzothiazepines:</strong> (e.g., diltiazem) Act on arterioles and the heart.</li>
                            <li><strong>Dihydropyridines:</strong> (e.g., amlodipine, nifedipine, felodipine) Largest group; most used to control hypertension.</li>
                        </ul>
                        Nifedipine decreases BP in older adults and those with low serum renin. Nifedipine and verapamil are potent. Immediate-release nifedipine (10- and 20-mg capsules) has been associated with increased incidence of profound hypotension, MI, and death, especially in older adults; therefore, only extended-release preparations are recommended for chronic hypertension. Immediate-release nifedipine is usually prescribed for acute BP rises in hospital settings only.
                        <br><br>
                        Like vasodilators, CCBs can cause reflex tachycardia (more prevalent with nifedipine).
                        <br><br>
                        <strong>Cultural Response:</strong> CCBs lower BP better in African Americans than drugs in other categories.
                        <br><br>
                        <strong>Combinations:</strong> Amlodipine may be combined with the ACE inhibitor benazepril. Normally, beta blockers are not prescribed with calcium blockers, as both decrease myocardial contractility.` },
                    { id: 'ccbs-pharmacokinetics-dynamics', title: 'CCBs: Pharmacokinetics & Pharmacodynamics', type: 'text', content: `<strong>Pharmacokinetics (Amlodipine example):</strong>
                        <ul>
                            <li>Well absorbed via GI tract.</li>
                            <li>Highly protein bound (93%).</li>
                            <li>Longer half-life (30-50 hours) than other CCBs, so taken once daily.</li>
                            <li>Excreted in urine.</li>
                        </ul>
                        <strong>Pharmacodynamics (Amlodipine example):</strong>
                        <ul>
                            <li>Inhibits influx of extracellular calcium across myocardial and vascular smooth muscle cell membranes, decreasing myocardial contractility.</li>
                            <li>May be used alone or with other antihypertensive drugs.</li>
                            <li>Peripheral edema may occur due to vasodilator effect.</li>
                            <li>Long duration of action (24 hours).</li>
                        </ul>` },
                    { id: 'ccbs-side-effects', title: 'CCBs: Side Effects & Adverse Reactions', type: 'text', content: `Side effects and adverse reactions of calcium channel blockers include:
                        <ul>
                            <li>Flushing</li>
                            <li>Headache</li>
                            <li>Dizziness</li>
                            <li>Ankle edema (peripheral edema)</li>
                            <li>Bradycardia</li>
                            <li>AV block</li>
                            <li>Drowsiness</li>
                            <li>Anxiety</li>
                            <li>Fatigue</li>
                            <li>Weakness</li>
                            <li>Syncope</li>
                            <li>Depression</li>
                            <li>Visual impairment</li>
                            <li>Paresthesia</li>
                            <li>Diaphoresis</li>
                            <li>Arthralgia, myalgia, muscle cramps</li>
                            <li>Nausea, anorexia, abdominal pain, vomiting, diarrhea, constipation</li>
                            <li>Nightmares, insomnia</li>
                            <li>Weight loss/gain</li>
                            <li>Rash, pruritus</li>
                            <li>Erectile dysfunction</li>
                            <li>Orthostatic hypotension</li>
                            <li>Chest pain, tachycardia, palpitations, dyspnea</li>
                            <li>Hyperglycemia</li>
                        </ul>
                        <strong>Life-threatening:</strong> Angioedema, dysrhythmia exacerbation, MI, thrombocytopenia.` },
                    { id: 'ccbs-quiz', title: 'Calcium Channel Blockers Quiz', type: 'quiz',
                      questions: [
                          { question: "What is the primary mechanism of action of calcium channel blockers in lowering blood pressure?", options: ["Blocking beta-adrenergic receptors", "Inhibiting angiotensin-converting enzyme", "Promoting vasodilation by blocking calcium channels in vascular smooth muscle", "Increasing sodium and water excretion"], correctAnswer: "Promoting vasodilation by blocking calcium channels in vascular smooth muscle" },
                          { question: "Which type of calcium channel blocker is most commonly used to control hypertension and includes drugs like amlodipine and nifedipine?", options: ["Phenylalkylamines", "Benzothiazepines", "Dihydropyridines", "Non-selective"], correctAnswer: "Dihydropyridines" },
                          { question: "Immediate-release nifedipine is generally not recommended for chronic hypertension due to an increased risk of:", options: ["Severe bradycardia", "Profound hypotension, MI, and death", "Hyperkalemia", "Persistent cough"], correctAnswer: "Profound hypotension, MI, and death" },
                          { question: "Which side effect is commonly associated with calcium channel blockers, particularly in the lower extremities?", options: ["Bronchospasm", "Ankle edema", "Dry mouth", "Pseudoparkinsonism"], correctAnswer: "Ankle edema" }
                      ]
                    },
                ]
            },
            'chapter-review': {
                title: 'Chapter Review & NCLEX Questions',
                color: 'from-gray-700 to-gray-900',
                description: 'Integrate knowledge and practice NCLEX-style review questions for Chapter 42.',
                steps: [
                    { id: 'critical-thinking-case-study', title: 'Critical Thinking Case Study', type: 'case_study', case: {
                        scenario: `A 72-year-old African American patient has heart failure and diabetes. Her vital signs are blood pressure 176/94, pulse 92, and respirations 30. Her medications include hydrochlorothiazide 50 mg/day, digoxin 0.125 mg/day, and atenolol 50 mg/day.`,
                        question: `
                        1. Why was hydrochlorothiazide prescribed for this patient? Explain the effects of hydrochlorothiazide on blood pressure.
                        <br><br>
                        2. Abnormal electrolytes and other laboratory test results may occur when taking hydrochlorothiazide. Would the following serum electrolyte and laboratory values be expected to increase or decrease?
                        <br>
                        a. Sodium
                        <br>
                        b. Potassium
                        <br>
                        c. Calcium
                        <br>
                        d. Magnesium
                        <br>
                        e. Glucose
                        <br>
                        f. Uric acid
                        <br><br>
                        3. Why should this patient’s blood glucose level be monitored while she is taking hydrochlorothiazide?
                        <br><br>
                        4. What response does a health care provider need to keep in mind when prescribing antihypertensive agents? Explain your answer.
                        <br><br>
                        5. Atenolol is what type of antihypertensive? Would atenolol be effective in lowering this patient’s blood pressure if given as the only antihypertensive drug? Explain your answer.
                        <br><br>
                        6. How effective is the combination of hydrochlorothiazide and atenolol for controlling this patient’s blood pressure? Explain your answer.
                        <br><br>
                        7. When using a combination drug therapy to correct hypertension, would the dosage for each drug be the same? Explain your answer.
                        <br><br>
                        8. When abruptly discontinuing beta blockers for hypertension without the patient taking another antihypertensive, what might occur? Explain how adverse effects can be avoided.
                        <br><br>
                        <em>After 1 month on hydrochlorothiazide therapy, the patient becomes weak and complains of nausea and vomiting. His muscles are “soft,” and his serum potassium level is 3.2 mEq/L. The patient’s diuretic is changed to triamterene and hydrochlorothiazide. Again, he is advised to eat foods rich in potassium.</em>
                        <br><br>
                        9. Why were this patient’s hydrochlorothiazide and atenolol discontinued? Explain your answer.
                        <br><br>
                        10. What type of antihypertensive is prazosin? Explain the physiologic action of prazosin for lowering the blood pressure.
                        <br><br>
                        11. Does prazosin have an effect on the blood glucose level? What effect could prazosin have on this patient’s abnormal lipid levels? Explain your answer.
                        <br><br>
                        <em>This patient’s ankles have become edematous. Hydrochlorothiazide is again prescribed.</em>
                        <br><br>
                        12. Why was hydrochlorothiazide again added to the drug regimen?
                        <br><br>
                        13. Is the daily prazosin dose within the safe therapeutic prescribed range for this patient? Explain your answer. (You may refer to Prototype Drug Chart: Prazosin Hydrochloride.)
                        <br><br>
                        14. List the groups of antihypertensive drugs that can cause sodium and water retention.
                        `,
                        options: [
                             "This is a discussion-based case study, not multiple choice."
                        ],
                        correctAnswer: ["This is a discussion-based case study, not multiple choice."],
                        explanation: `This is a multi-part, open-ended case study designed for critical thinking and discussion. Here are the rationales for each question based on Chapter 42 content:
                        <br><br>
                        <strong>1. Why was hydrochlorothiazide prescribed for this patient? Explain the effects of hydrochlorothiazide on blood pressure.</strong>
                        <br>
                        Hydrochlorothiazide is a thiazide diuretic, commonly prescribed as a first-line drug for mild to moderate hypertension. It works by acting on the distal convoluted renal tubule to promote the excretion of sodium, chloride, and water. This leads to a decrease in extracellular fluid volume (ECFV), which in turn reduces cardiac output and systemic arterial blood pressure. It also has a direct vasodilatory effect on arterioles, further contributing to BP lowering.
                        <br><br>
                        <strong>2. Abnormal electrolytes and other laboratory test results may occur when taking hydrochlorothiazide. Would the following serum electrolyte and laboratory values be expected to increase or decrease?</strong>
                        <br>
                        a. Sodium: **Decrease** (Hyponatremia) - Thiazides promote sodium excretion.
                        <br>
                        b. Potassium: **Decrease** (Hypokalemia) - Thiazides are potassium-wasting diuretics.
                        <br>
                        c. Calcium: **Increase** (Hypercalcemia) - Thiazides promote calcium reabsorption.
                        <br>
                        d. Magnesium: **Decrease** (Hypomagnesemia) - Thiazides cause magnesium loss.
                        <br>
                        e. Glucose: **Increase** (Hyperglycemia) - Thiazides can affect glucose tolerance.
                        <br>
                        f. Uric acid: **Increase** (Hyperuricemia) - Thiazides can block uric acid excretion.
                        <br><br>
                        <strong>3. Why should this patient’s blood glucose level be monitored while she is taking hydrochlorothiazide?</strong>
                        <br>
                        Thiazide diuretics like hydrochlorothiazide can cause **hyperglycemia** by affecting carbohydrate metabolism and increasing fasting blood glucose levels. This is particularly important for this patient who already has a diagnosis of diabetes, as it could worsen her glycemic control.
                        <br><br>
                        <strong>4. What response does a health care provider need to keep in mind when prescribing antihypertensive agents? Explain your answer.</strong>
                        <br>
                        When prescribing antihypertensive agents, healthcare providers must consider **cultural responses** to these drugs. For African American patients, beta blockers and ACE inhibitors are often less effective as monotherapy for hypertension because this group is susceptible to low-renin hypertension. They typically respond better to alpha1 blockers, calcium channel blockers, and diuretics as initial monotherapy or in combination. Therefore, the provider needs to tailor the drug choice and combination therapy based on the patient's ethnicity to ensure optimal BP control.
                        <br><br>
                        <strong>5. Atenolol is what type of antihypertensive? Would atenolol be effective in lowering this patient’s blood pressure if given as the only antihypertensive drug? Explain your answer.</strong>
                        <br>
                        Atenolol is a **cardioselective beta1-adrenergic blocker (beta blocker)**.
                        <br>
                        Given as the only antihypertensive drug, atenolol would likely **not be optimally effective** in lowering this patient's blood pressure. The text states that beta blockers are "less effective for the control of hypertension in African Americans unless the drug is combined or given with a diuretic." This patient is African American, and her current BP (176/94) is significantly elevated, indicating that atenolol alone would likely be insufficient.
                        <br><br>
                        <strong>6. How effective is the combination of hydrochlorothiazide and atenolol for controlling this patient’s blood pressure? Explain your answer.</strong>
                        <br>
                        The combination of hydrochlorothiazide (a diuretic) and atenolol (a beta blocker) is generally **more effective** for controlling hypertension in African American patients than either drug alone. The text specifically mentions that "hypertension in the African American population can be controlled by combining beta blockers with diuretics." The diuretic addresses the fluid volume component, and the combination helps overcome the reduced response to beta blockers seen in this population. However, despite this combination, the patient's BP is still 176/94, which indicates that this combination, at its current dosages, is not sufficient to achieve optimal control for this patient.
                        <br><br>
                        <strong>7. When using a combination drug therapy to correct hypertension, would the dosage for each drug be the same? Explain your answer.</strong>
                        <br>
                        No, the dosage for each drug in a combination therapy is **not necessarily the same**. Combination drugs often use **lower doses of each individual component** than if they were prescribed as monotherapy. This strategy aims to achieve an additive antihypertensive effect while minimizing the side effects associated with higher doses of a single agent. The specific dosages are determined based on the patient's individual response, comorbidities, and the drugs' pharmacokinetic and pharmacodynamic profiles.
                        <br><br>
                        <strong>8. When abruptly discontinuing beta blockers for hypertension without the patient taking another antihypertensive, what might occur? Explain how adverse effects can be avoided.</strong>
                        <br>
                        Abruptly discontinuing beta blockers can lead to a **rebound effect**, including:
                        <ul>
                            <li><strong>Rebound hypertension:</strong> A sudden and significant increase in blood pressure, potentially higher than before treatment.</li>
                            <li><strong>Angina:</strong> Worsening or new onset of chest pain.</li>
                            <li><strong>Dysrhythmias:</strong> Irregular heart rhythms.</li>
                            <li><strong>Myocardial Infarction (MI):</strong> In severe cases.</li>
                        </ul>
                        These adverse effects can be avoided by **gradually tapering the dose** of the beta blocker over a specified number of days (typically 1-2 weeks) rather than stopping it suddenly. If the drug needs to be stopped immediately, another antihypertensive drug is usually prescribed to prevent the rebound symptoms.
                        <br><br>
                        <strong>9. Why were this patient’s hydrochlorothiazide and atenolol discontinued? Explain your answer.</strong>
                        <br>
                        The patient's hydrochlorothiazide was likely discontinued due to signs of **hypokalemia** (weakness, nausea, vomiting, soft muscles, serum potassium 3.2 mEq/L), which is a common side effect of potassium-wasting diuretics like hydrochlorothiazide.
                        <br>
                        Atenolol was likely discontinued because it was not effectively controlling her hypertension, especially given her African American ethnicity (beta blockers are less effective alone in this population). Additionally, her blood glucose was elevated (229), and beta blockers can mask hypoglycemic symptoms in diabetic patients and may also contribute to hyperglycemia. The change to prazosin suggests a shift to an alpha blocker, which is known to be more effective in African American patients and does not adversely affect glucose metabolism.
                        <br><br>
                        <strong>10. What type of antihypertensive is prazosin? Explain the physiologic action of prazosin for lowering the blood pressure.</strong>
                        <br>
                        Prazosin is a **selective alpha1-adrenergic blocker (alpha blocker)**.
                        <br>
                        Its physiologic action for lowering blood pressure involves **blocking alpha1-adrenergic receptors**. These receptors are primarily located on vascular smooth muscle. When blocked, it causes **vasodilation** of both arterioles and venules. This vasodilation leads to a decrease in peripheral vascular resistance (afterload) and a reduction in venous return (preload), both of which contribute to a lowering of blood pressure. It also helps maintain renal blood flow.
                        <br><br>
                        <strong>11. Does prazosin have an effect on the blood glucose level? What effect could prazosin have on this patient’s abnormal lipid levels? Explain your answer.</strong>
                        <br>
                        * **Blood Glucose:** Prazosin (and other alpha blockers) generally **do not affect glucose metabolism**. This makes them a safer choice for patients with diabetes compared to some other antihypertensives like thiazides or beta blockers, which can increase blood glucose or mask hypoglycemia.
                        * **Lipid Levels:** Alpha blockers are useful in treating hypertension in patients with lipid abnormalities. They can **decrease very-low-density lipoprotein (VLDL) and low-density lipoprotein (LDL)** (the "bad" cholesterols) and **increase high-density lipoprotein (HDL)** (the "good" cholesterol). This would be a beneficial effect for this patient, whose cholesterol and LDL levels are elevated.
                        <br><br>
                        <strong>12. Why was hydrochlorothiazide again added to the drug regimen?</strong>
                        <br>
                        Hydrochlorothiazide was likely added back to the regimen because the patient developed **edema in her ankles**, indicating fluid retention. While prazosin helps lower BP, it can also cause sodium and water retention, leading to peripheral edema. Adding a diuretic like hydrochlorothiazide helps to counteract this fluid retention and further enhance BP control.
                        <br><br>
                        <strong>13. Is the daily prazosin dose within the safe therapeutic prescribed range for this patient? Explain your answer. (You may refer to Prototype Drug Chart: Prazosin Hydrochloride.)</strong>
                        <br>
                        According to the Prototype Drug Chart for Prazosin Hydrochloride:
                        * Adult (A): PO: Initially 1 mg bid/tid; maint: 6–15 mg/d; max: 20 mg/d in divided doses.
                        * Older A: PO: Initially 1 mg qd/bid; max: 20 mg/d.
                        <br>
                        The patient is 72 years old, making her an "Older A." Her prescribed dose is 10 mg three times daily (tid), which equals 30 mg/day. This dose is **above the maximum recommended daily dose of 20 mg/d for older adults**. Therefore, the daily prazosin dose of 30 mg is **not within the safe therapeutic prescribed range** for this patient. This could increase the risk of side effects, particularly orthostatic hypotension.
                        <br><br>
                        <strong>14. List the groups of antihypertensive drugs that can cause sodium and water retention.</strong>
                        <br>
                        The groups of antihypertensive drugs that can cause sodium and water retention include:
                        <ul>
                            <li><strong>Centrally Acting Alpha2 Agonists</strong> (e.g., methyldopa, clonidine)</li>
                            <li><strong>Alpha-Adrenergic Blockers</strong> (e.g., prazosin, terazosin, doxazosin)</li>
                            <li><strong>Adrenergic Neuron Blockers</strong> (e.g., reserpine)</li>
                            <li><strong>Direct-Acting Arteriolar Vasodilators</strong> (e.g., hydralazine, minoxidil)</li>
                            <li><strong>Calcium Channel Blockers</strong> (some, e.g., amlodipine, can cause peripheral edema due to vasodilation leading to fluid shift and retention)</li>
                        </ul>
                        (Note: While not causing *retention* in the same way, some other antihypertensives like beta blockers can lead to fluid retention if they cause heart failure exacerbation, but the primary mechanism of causing retention is more direct for the listed classes.)`
                    }},
                    { id: 'review-quiz', title: 'Review Questions', type: 'quiz',
                      questions: [
                          { question: "A patient’s blood pressure is 130/84. The health care provider plans to suggest nonpharmacologic methods to lower blood pressure. Which should the nurse include in teaching? (Select all that apply.)", options: ["Stress-reduction techniques", "An exercise program", "Salt restriction", "Smoking cessation", "A diet with increased protein"], correctAnswer: ["Stress-reduction techniques", "An exercise program", "Salt restriction", "Smoking cessation"] },
                          { question: "A patient has developed mild hypertension. The nurse acknowledges that the first-line drug for treating this patient’s blood pressure might be which drug?", options: ["Diuretic", "Alpha blocker", "Angiotensin-converting enzyme inhibitor", "Alpha/beta blocker"], correctAnswer: "Diuretic" },
                          { question: "An African American patient has developed hypertension. The nurse is aware that which group(s) of antihypertensive drugs are less effective in African American patients?", options: ["Diuretics", "Calcium channel blockers and vasodilators", "Beta blockers and angiotensin-converting enzyme inhibitors", "Alpha blockers"], correctAnswer: "Beta blockers and angiotensin-converting enzyme inhibitors" },
                          { question: "The nurse knows that which diuretic is most frequently combined with an antihypertensive drug?", options: ["Chlorthalidone", "Hydrochlorothiazide", "Bendroflumethiazide", "A potassium-sparing diuretic"], correctAnswer: "Hydrochlorothiazide" },
                          { question: "The nurse is administering a beta blocker to a patient. Which is the most important assessment to perform before administration?", options: ["Urine output", "Apical pulse", "Potassium level", "Serum level of medication"], correctAnswer: "Apical pulse" },
                          { question: "Captopril has been prescribed for a patient. The nurse should teach the patient that the most commonly occurring side effect of an angiotensin-converting enzyme drug is which of the following?", options: ["Nausea and vomiting", "Dizziness and headaches", "Upset stomach", "Constant, irritating cough"], correctAnswer: "Constant, irritating cough" },
                          { question: "A patient is prescribed losartan. The nurse teaches the patient that an angiotensin II-receptor blocker acts by doing what?", options: ["Inhibiting angiotensin-converting enzyme", "Blocking angiotensin II from angiotensin I receptors", "Preventing the release of angiotensin I", "Promoting the release of aldosterone"], correctAnswer: "Blocking angiotensin II from angiotensin I receptors" },
                          { question: "During an admission assessment, a patient states that she takes amlodipine. The nurse should inquire about which signs and symptoms to determine whether the patient has any common side effects of amlodipine? (Select all that apply.)", options: ["Insomnia", "Dizziness", "Headache", "Angioedema", "Ankle edema", "Hacking cough"], correctAnswer: ["Dizziness", "Headache", "Ankle edema"] }
                      ]
                    },
                ]
            }
        };

        // The pre-assessment quiz data now includes questions for all new modules.
        const preAssessmentQuizData = [
            // Questions for Module: Introduction to Hypertension
            { moduleId: 'intro-hypertension', question: "According to JNC 8 guidelines, what is considered Stage 1 hypertension?", options: ["Less than 120/80 mm Hg", "120-129/<80 mm Hg", "130/80 to 139/89 mm Hg", "140/90 mm Hg or greater"], correctAnswer: "130/80 to 139/89 mm Hg" },
            { moduleId: 'intro-hypertension', question: "Which of the following ethnic groups is more likely to develop hypertension at an earlier age and has a higher mortality rate from hypertension?", options: ["Asian Americans", "Native Americans", "Caucasians", "African Americans"], correctAnswer: "African Americans" },
            { moduleId: 'intro-hypertension', question: "What is a common troublesome side effect of antihypertensive agents in older adults, especially frail or institutionalized persons?", options: ["Hyperglycemia", "Orthostatic hypotension", "Tachycardia", "Weight gain"], correctAnswer: "Orthostatic hypotension" },
            { moduleId: 'intro-hypertension', question: "Which nonpharmacologic method is generally recommended to help control hypertension?", options: ["Increased alcohol consumption", "Strenuous daily exercise without prior consultation", "Significant salt restriction", "Smoking a few cigarettes daily"], correctAnswer: "Significant salt restriction" },

            // Questions for Module: Diuretics as Antihypertensives
            { moduleId: 'diuretics-antihypertensives', question: "Which diuretic is most commonly prescribed as a first-line agent for mild hypertension?", options: ["Furosemide", "Spironolactone", "Mannitol", "Hydrochlorothiazide"], correctAnswer: "Hydrochlorothiazide" },
            { moduleId: 'diuretics-antihypertensives', question: "For patients with renal insufficiency (creatinine clearance <30 mL/min), which type of diuretic is generally recommended for hypertension?", options: ["Thiazide diuretics", "Loop diuretics", "Potassium-sparing diuretics", "Carbonic anhydrase inhibitors"], correctAnswer: "Loop diuretics" },

            // Questions for Module: Sympatholytics (Sympathetic Depressants)
            { moduleId: 'sympatholytics', question: "Which of the following is a common side effect of nonselective beta blockers that is less likely with cardioselective beta blockers?", options: ["Bradycardia", "Hypotension", "Bronchoconstriction", "Dizziness"], correctAnswer: "Bronchoconstriction" },
            { moduleId: 'sympatholytics', question: "A patient taking clonidine should be warned against abrupt discontinuation due to the risk of:", options: ["Severe bradycardia", "Rebound hypertensive crisis", "Hypoglycemic shock", "Angioedema"], correctAnswer: "Rebound hypertensive crisis" },
            { moduleId: 'sympatholytics', question: "Which class of antihypertensive drugs is known to decrease VLDL and LDL, and increase HDL, making them useful in patients with lipid abnormalities?", options: ["Beta blockers", "Centrally acting alpha2 agonists", "Alpha-adrenergic blockers", "Direct-acting vasodilators"], correctAnswer: "Alpha-adrenergic blockers" },
            { moduleId: 'sympatholytics', question: "Which of the following drugs is an alpha1- and beta1-adrenergic blocker?", options: ["Propranolol", "Clonidine", "Prazosin", "Labetalol"], correctAnswer: "Labetalol" },

            // Questions for Module: Vasodilators, ACEIs, ARBs, & DRIs
            { moduleId: 'vasodilators-acei-arbs-dri', question: "Which direct-acting vasodilator is primarily used for acute hypertensive emergencies due to its rapid action on both arterial and venous vessels?", options: ["Hydralazine", "Minoxidil", "Nitroprusside", "Amlodipine"], correctAnswer: "Nitroprusside" },
            { moduleId: 'vasodilators-acei-arbs-dri', question: "What is the most commonly occurring side effect of Angiotensin-Converting Enzyme (ACE) inhibitors?", options: ["Peripheral edema", "Reflex tachycardia", "Constant, irritated cough", "Hyperglycemia"], correctAnswer: "Constant, irritated cough" },
            { moduleId: 'vasodilators-acei-arbs-dri', question: "Which of the following is a key difference between Angiotensin II–Receptor Blockers (ARBs) and ACE inhibitors?", options: ["ARBs cause a persistent cough, while ACE inhibitors do not.", "ARBs are contraindicated in pregnancy, while ACE inhibitors are safe.", "ARBs block angiotensin II from receptors, while ACE inhibitors prevent its formation.", "ARBs lead to increased aldosterone release, while ACE inhibitors block it."], correctAnswer: "ARBs block angiotensin II from receptors, while ACE inhibitors prevent its formation." },
            { moduleId: 'vasodilators-acei-arbs-dri', question: "Aliskiren is the first FDA-approved drug in which class of antihypertensives?", options: ["Beta blockers", "Calcium channel blockers", "Direct renin inhibitors", "Alpha-adrenergic blockers"], correctAnswer: "Direct renin inhibitors" },

            // Questions for Module: Calcium Channel Blockers
            { moduleId: 'calcium-channel-blockers', question: "What is the primary mechanism of action of calcium channel blockers in lowering blood pressure?", options: ["Blocking beta-adrenergic receptors", "Inhibiting angiotensin-converting enzyme", "Promoting vasodilation by blocking calcium channels in vascular smooth muscle", "Increasing sodium and water excretion"], correctAnswer: "Promoting vasodilation by blocking calcium channels in vascular smooth muscle" },
            { moduleId: 'calcium-channel-blockers', question: "Which type of calcium channel blocker is most commonly used to control hypertension and includes drugs like amlodipine and nifedipine?", options: ["Phenylalkylamines", "Benzothiazepines", "Dihydropyridines", "Non-selective"], correctAnswer: "Dihydropyridines" },
            { moduleId: 'calcium-channel-blockers', question: "Immediate-release nifedipine is generally not recommended for chronic hypertension due to an increased risk of:", options: ["Severe bradycardia", "Profound hypotension, MI, and death", "Hyperkalemia", "Persistent cough"], correctAnswer: "Profound hypotension, MI, and death" },
            { moduleId: 'calcium-channel-blockers', question: "Which side effect is commonly associated with calcium channel blockers, particularly in the lower extremities?", options: ["Bronchospasm", "Ankle edema", "Dry mouth", "Pseudoparkinsonism"], correctAnswer: "Ankle edema" },

            // Questions for Chapter Review & NCLEX Questions
            { moduleId: 'chapter-review', question: "A patient’s blood pressure is 130/84. The health care provider plans to suggest nonpharmacologic methods to lower blood pressure. Which should the nurse include in teaching? (Select all that apply.)", options: ["Stress-reduction techniques", "An exercise program", "Salt restriction", "Smoking cessation", "A diet with increased protein"], correctAnswer: ["Stress-reduction techniques", "An exercise program", "Salt restriction", "Smoking cessation"] },
            { moduleId: 'chapter-review', question: "A patient has developed mild hypertension. The nurse acknowledges that the first-line drug for treating this patient’s blood pressure might be which drug?", options: ["Diuretic", "Alpha blocker", "Angiotensin-converting enzyme inhibitor", "Alpha/beta blocker"], correctAnswer: "Diuretic" },
            { moduleId: 'chapter-review', question: "An African American patient has developed hypertension. The nurse is aware that which group(s) of antihypertensive drugs are less effective in African American patients?", options: ["Diuretics", "Calcium channel blockers and vasodilators", "Beta blockers and angiotensin-converting enzyme inhibitors", "Alpha blockers"], correctAnswer: "Beta blockers and angiotensin-converting enzyme inhibitors" },
            { moduleId: 'chapter-review', question: "The nurse knows that which diuretic is most frequently combined with an antihypertensive drug?", options: ["Chlorthalidone", "Hydrochlorothiazide", "Bendroflumethiazide", "A potassium-sparing diuretic"], correctAnswer: "Hydrochlorothiazide" },
            { moduleId: 'chapter-review', question: "The nurse is administering a beta blocker to a patient. Which is the most important assessment to perform before administration?", options: ["Urine output", "Apical pulse", "Potassium level", "Serum level of medication"], correctAnswer: "Apical pulse" },
            { moduleId: 'chapter-review', question: "Captopril has been prescribed for a patient. The nurse should teach the patient that the most commonly occurring side effect of an angiotensin-converting enzyme drug is which of the following?", options: ["Nausea and vomiting", "Dizziness and headaches", "Upset stomach", "Constant, irritating cough"], correctAnswer: "Constant, irritating cough" },
            { moduleId: 'chapter-review', question: "A patient is prescribed losartan. The nurse teaches the patient that an angiotensin II-receptor blocker acts by doing what?", options: ["Inhibiting angiotensin-converting enzyme", "Blocking angiotensin II from angiotensin I receptors", "Preventing the release of angiotensin I", "Promoting the release of aldosterone"], correctAnswer: "Blocking angiotensin II from angiotensin I receptors" },
            { moduleId: 'chapter-review', question: "During an admission assessment, a patient states that she takes amlodipine. The nurse should inquire about which signs and symptoms to determine whether the patient has any common side effects of amlodipine? (Select all that apply.)", options: ["Insomnia", "Dizziness", "Headache", "Angioedema", "Ankle edema", "Hacking cough"], correctAnswer: ["Dizziness", "Headache", "Ankle edema"] }
        ];

        // --- Helper Functions ---
        const cn = (...classes) => classes.filter(Boolean).join(' ');


        // --- Child Components ---

        /**
         * Quiz component for interactive multiple-choice questions.
         * Users answer questions and receive immediate feedback.
         */
        const Quiz = ({ questions, onComplete, isPreAssessment = false }) => {
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [selectedOption, setSelectedOption] = useState([]);
            const [feedback, setFeedback] = useState(null);
            const [answers, setAnswers] = useState([]);

            const currentQuestion = questions[currentQuestionIndex];

            const handleOptionSelect = (option) => {
                if (feedback && !isPreAssessment) return;

                if (Array.isArray(currentQuestion.correctAnswer)) {
                    setSelectedOption(prevSelected => {
                        if (prevSelected.includes(option)) {
                            return prevSelected.filter(item => item !== option);
                        } else {
                            return [...prevSelected, option];
                        }
                    });
                } else {
                    setSelectedOption(option);
                }
            };

            const handlePreAssessmentNext = () => {
                if (selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)) return;
                
                const isCorrect = Array.isArray(currentQuestion.correctAnswer)
                    ? currentQuestion.correctAnswer.every(ans => selectedOption.includes(ans)) && selectedOption.length === currentQuestion.correctAnswer.length
                    : selectedOption.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                
                const updatedAnswers = [...answers, { question: currentQuestion, isCorrect }];
                setAnswers(updatedAnswers);

                if (currentQuestionIndex < questions.length - 1) {
                    setCurrentQuestionIndex(currentQuestionIndex + 1);
                    setSelectedOption([]);
                    setFeedback(null);
                } else {
                    onComplete(updatedAnswers);
                }
            };
            
            const handleRegularQuizSubmit = () => {
                if (selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)) return;
                
                const isCorrect = Array.isArray(currentQuestion.correctAnswer)
                    ? currentQuestion.correctAnswer.every(ans => selectedOption.includes(ans)) && selectedOption.length === currentQuestion.correctAnswer.length
                    : selectedOption.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                
                setFeedback(isCorrect ? 'correct' : 'incorrect');
            };

            const handleRegularQuizNext = () => {
                const isCorrect = Array.isArray(currentQuestion.correctAnswer)
                    ? currentQuestion.correctAnswer.every(ans => selectedOption.includes(ans)) && selectedOption.length === currentQuestion.correctAnswer.length
                    : selectedOption.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                const finalAnswers = [...answers, { question: currentQuestion, isCorrect }];
                
                if (currentQuestionIndex < questions.length - 1) {
                    setAnswers(finalAnswers);
                    setCurrentQuestionIndex(currentQuestionIndex + 1);
                    setSelectedOption([]);
                    setFeedback(null);
                } else {
                    const finalScore = finalAnswers.reduce((acc, ans) => acc + (ans.isCorrect ? 1 : 0), 0);
                    onComplete({ score: finalScore, total: questions.length });
                }
            };

            return (
                <div className="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h4 className="font-bold text-lg text-gray-800 mb-2">Quiz: {currentQuestionIndex + 1} of {questions.length}</h4>
                    <p className="font-semibold text-gray-700 mb-3">{currentQuestion.question}</p>
                    <div className="space-y-2">
                        {currentQuestion.options.map((option, index) => {
                            const isSelected = Array.isArray(selectedOption) ? selectedOption.includes(option) : selectedOption === option;
                            const isCorrectOption = Array.isArray(currentQuestion.correctAnswer)
                                ? currentQuestion.correctAnswer.includes(option)
                                : option.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                            let optionClass = 'bg-white hover:bg-gray-100 border-gray-200';

                            if (feedback && !isPreAssessment) {
                                if (isCorrectOption) {
                                    optionClass = 'bg-green-100 border-green-500 text-green-800';
                                } else if (isSelected && !isCorrectOption) {
                                    optionClass = 'bg-red-100 border-red-500 text-red-800';
                                }
                            } else if (isSelected) {
                                optionClass = 'bg-indigo-100 border-indigo-500 text-indigo-800';
                            }

                            return (
                                <div
                                    key={index}
                                    onClick={() => handleOptionSelect(option)}
                                    className={cn('p-3 rounded-lg border-2 cursor-pointer transition-colors', optionClass)}
                                >
                                    <div className="flex items-center">
                                        {feedback && !isPreAssessment && (isCorrectOption || (isSelected && !isCorrectOption)) && (
                                            isCorrectOption ? <span className="text-green-600 mr-2">✓</span> : <span className="text-red-600 mr-2">✗</span>
                                        )}
                                        <span className="flex-1">{option}</span>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    <div className="mt-4 text-center">
                        {isPreAssessment ? (
                             <button
                                 onClick={handlePreAssessmentNext}
                                 disabled={selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)}
                                 className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                            >
                                {currentQuestionIndex < questions.length - 1 ? 'Next Question' : 'Finish Assessment'}
                            </button>
                        ) : (
                            <>
                            {!feedback ? (
                                <button
                                    onClick={handleRegularQuizSubmit}
                                    disabled={selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                >
                                    Submit Answer
                                </button>
                            ) : (
                                <button
                                    onClick={handleRegularQuizNext}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors"
                                >
                                    Next Question
                                </button>
                            )}
                            </>
                        )}
                    </div>
                </div>
            );
        };
        
        /**
         * PreAssessmentQuiz component to handle the initial diagnostic quiz.
         * Displays quiz questions and then results, allowing users to "test out" of modules.
         */
        const PreAssessmentQuiz = ({ onComplete, onExit }) => {
            const [results, setResults] = useState(null);

            const handleQuizComplete = (finalAnswers) => {
                const moduleResults = {};
                finalAnswers.forEach(answer => {
                    const { moduleId } = answer.question;
                    if (!moduleResults[moduleId]) {
                        moduleResults[moduleId] = { correct: 0, total: 0 };
                    }
                    if (answer.isCorrect) {
                        moduleResults[moduleId].correct++;
                    }
                    moduleResults[moduleId].total++;
                });

                const completedModules = [];
                for (const moduleId in moduleResults) {
                    if (moduleResults[moduleId].correct === moduleResults[moduleId].total) {
                        completedModules.push(moduleId);
                    }
                }
                setResults({ completedModules, total: finalAnswers.length, correct: finalAnswers.filter(a => a.isCorrect).length });
                onComplete(completedModules);
            };

            if (results) {
                return (
                    <div className="fixed inset-0 bg-gray-100 flex items-center justify-center z-40 p-4 animate-fade-in">
                        <div className="bg-white rounded-2xl shadow-xl p-8 max-w-2xl w-full text-center">
                            <h2 className="text-3xl font-bold text-gray-800 mb-4">Assessment Complete!</h2>
                            <p className="text-lg text-gray-600 mb-6">
                                You correctly answered {results.correct} out of {results.total} questions.
                            </p>
                            {results.completedModules.length > 0 ? (
                                <>
                                    <p className="text-green-600 font-semibold mb-4">You've tested out of the following modules:</p>
                                    <ul className="list-disc list-inside text-left mb-6 bg-green-50 p-4 rounded-lg">
                                        {results.completedModules.map(id => <li key={id}>{contentData[id].title}</li>)}
                                    </ul>
                                </>
                            ) : (
                                <p className="text-yellow-600 font-semibold mb-6">You haven't tested out of any modules. You can proceed to the main modules for learning.</p>
                            )}
                            <button
                                onClick={onExit}
                                className="px-8 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors"
                            >
                                Return to Dashboard
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="fixed inset-0 bg-gray-100 flex items-center justify-center z-40 p-4">
                    <div className="bg-white rounded-2xl shadow-xl p-8 max-w-2xl w-full">
                        <h2 className="text-2xl font-bold text-center text-gray-800 mb-6">Diagnostic Quiz</h2>
                        <Quiz questions={preAssessmentQuizData} onComplete={handleQuizComplete} isPreAssessment={true} />
                    </div>
                </div>
            );
        };


        /**
         * Dashboard component to display the available learning modules.
         * It allows users to select a module to start learning.
         * Shows progress for each module using a circular progress bar and status.
         */
        const Dashboard = ({ onSelectModule, progress, onResetProgress, onStartPreAssessment }) => {
            let totalCompletedSteps = 0;
            let totalPossibleSteps = 0;
            let totalQuizCorrect = 0;
            let totalQuizQuestions = 0;

            // Calculate overall progress and gather quiz scores
            Object.entries(contentData).forEach(([moduleId, module]) => {
                totalPossibleSteps += module.steps.length;
                const moduleProgress = progress[moduleId] || {};
                
                Object.values(moduleProgress).forEach(stepProgress => {
                    if (stepProgress.completed) {
                        totalCompletedSteps++;
                    }
                    if (stepProgress.score !== undefined) {
                        totalQuizCorrect += stepProgress.score;
                    }
                });

                module.steps.forEach(step => {
                    if (step.type === 'quiz') {
                        totalQuizQuestions += step.questions.length;
                    }
                });
            });


            const overallPercentage = totalPossibleSteps > 0 ? (totalCompletedSteps / totalPossibleSteps) * 100 : 0;

            return (
                <div className="p-4 sm:p-6 md:p-8 min-h-screen w-full flex flex-col">
                    <div className="w-full">
                        <header className="mb-8 text-center">
                            <div className="flex items-center justify-center gap-3 mb-2">
                                {/* Text placeholder for the main application identifier */}
                                <span className="w-10 h-10 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold text-xl shadow-lg">AHT</span>
                                <h1 className="text-3xl sm:text-4xl font-extrabold text-gray-800">Antihypertensives Learning Module</h1>
                                <span className="bg-gray-200 text-gray-600 text-xs font-mono px-2.5 py-1 rounded-full">V:1.0</span>
                            </div>
                            <p className="text-lg text-gray-500 max-w-2xl mx-auto">Master the pharmacology of antihypertensive drugs through interactive modules and NCLEX-style assessments.</p>
                        </header>

                        {/* Skip Ahead Button */}
                        <div className="mb-8 text-center">
                            <button
                                onClick={onStartPreAssessment}
                                className="w-full max-w-md mx-auto px-6 py-4 bg-teal-500 text-white font-bold rounded-lg shadow-lg hover:bg-teal-600 transition-all duration-300 transform hover:scale-105"
                            >
                                <div className="text-xl">Skip Ahead: Take Diagnostic Quiz</div>
                                <div className="text-sm font-normal">Test your knowledge and potentially skip modules.</div>
                            </button>
                        </div>

                        {/* Overall Progress Bar & Reset Button */}
                        <div className="mb-8 bg-white rounded-2xl shadow-lg p-6 w-full">
                           <div className="flex justify-between items-center mb-3">
                             <h3 className="text-xl font-bold text-gray-800">Overall Progress</h3>
                             <button 
                                 onClick={onResetProgress}
                                 className="px-4 py-2 text-sm bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 transition-colors flex items-center gap-2"
                             >
                                 <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                     <path fillRule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V4a1 1 0 112 0v1.001A7.002 7.002 0 0112.292 4.293a1 1 0 111.414 1.414A9.002 9.002 0 004 9.899V11a1 1 0 11-2 0V3a1 1 0 011-1z" clipRule="evenodd" />
                                 </svg>
                                 Reset Progress
                             </button>
                           </div>
                            <div className="w-full bg-gray-200 rounded-full h-4">
                                <div
                                    className="bg-indigo-600 h-4 rounded-full transition-all duration-500 ease-out"
                                    style={{ width: `${overallPercentage}%` }}
                                ></div>
                            </div>
                            <div className="flex justify-between items-center">
                                <p className="text-left text-sm text-gray-600 mt-2">
                                    {totalQuizQuestions > 0 && `Quiz Performance: ${totalQuizCorrect} / ${totalQuizQuestions} correct`}
                                </p>
                                <p className="text-right text-sm text-gray-600 mt-2">{Math.round(overallPercentage)}% Completed</p>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 w-full">
                            {/* Iterate over all modules defined in contentData */}
                            {Object.entries(contentData).map(([id, module]) => {
                                const moduleProgress = progress[id] || {};
                                // Calculate completion count for steps within the module.
                                const completedCount = Object.values(moduleProgress).filter(p => p.completed).length;
                                const totalSteps = module.steps.length;
                                const percentage = totalSteps > 0 ? (completedCount / totalSteps) * 100 : 0;

                                let statusText = "Not Started";
                                let statusColor = "text-gray-500";
                                if (completedCount === totalSteps) {
                                    statusText = "Completed";
                                    statusColor = "text-green-600";
                                } else if (completedCount > 0) {
                                    statusText = "In Progress";
                                    statusColor = "text-yellow-600";
                                }

                                // Get quiz score for this module if available
                                const quizStep = module.steps.find(step => step.type === 'quiz');
                                const quizProgress = quizStep ? moduleProgress[quizStep.id] : null;

                                return (
                                    <div
                                        key={id}
                                        onClick={() => onSelectModule(id)}
                                        // Styling for module cards, including hover effects.
                                        className="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 cursor-pointer transition-all duration-300 hover:shadow-xl hover:-translate-y-1 group flex flex-col"
                                    >
                                        <div className="flex justify-between items-start mb-4">
                                            {/* Placeholder for module icon: Displays the first letter of the module title. */}
                                            <div className={cn("p-3 rounded-full bg-gradient-to-br", module.color, "w-10 h-10 flex items-center justify-center text-white text-lg font-bold shadow-md flex-shrink-0")}>
                                                {module.title.split(' ').map(word => word.charAt(0)).join('')}
                                            </div>
                                            {/* Progress Circle */}
                                            <div className="relative w-12 h-12 flex-shrink-0">
                                                <svg className="w-full h-full" viewBox="0 0 36 36">
                                                    {/* Background circle for the progress bar. */}
                                                    <path
                                                        className="text-gray-200"
                                                        d="M18 2.0845
                                                            a 15.9155 15.9155 0 0 1 0 31.831
                                                            a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="currentColor"
                                                        strokeWidth="3"
                                                    />
                                                    {/* Foreground arc representing the completion percentage. */}
                                                    <path
                                                        className="text-indigo-500"
                                                        d="M18 2.0845
                                                            a 15.9155 15.9155 0 0 1 0 31.831
                                                            a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="currentColor"
                                                        strokeWidth="3"
                                                        strokeDasharray={`${percentage}, 100`}
                                                        strokeLinecap="round"
                                                        transform="rotate(-90 18 18)"
                                                    />
                                                </svg>
                                                <span className="absolute inset-0 flex items-center justify-center text-xs font-bold text-gray-600">{Math.round(percentage)}%</span>
                                            </div>
                                        </div>
                                        <h3 className="text-xl font-bold text-gray-800 mb-2">{module.title}</h3>
                                        <p className="text-gray-500 text-sm mb-2 h-10">{module.description}</p>
                                        <div className="mt-auto">
                                            <p className={cn("text-sm font-semibold", statusColor)}>{statusText}</p>
                                            {quizProgress && quizProgress.score !== undefined && (
                                                <p className="text-sm text-gray-600 mt-1">Quiz Score: {quizProgress.score} / {quizStep.questions.length}</p>
                                            )}
                                            <div className="flex items-center justify-end text-sm font-medium text-indigo-600 group-hover:text-indigo-700 mt-2">
                                                Start Learning <span className="ml-1 transition-transform group-hover:translate-x-1">&rarr;</span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };
        
        /**
         * CaseStudy component for a multiple-choice case study challenge.
         * Presents a scenario and a question with multiple options.
         */
        const CaseStudy = ({ caseData, onComplete }) => {
            // State to store the user's selected answer.
            const [selectedAnswer, setSelectedAnswer] = useState(null);

            // Handles the selection of an answer option.
            const handleSelect = (option) => {
                if (selectedAnswer) return; // Prevents changing the answer once selected.
                setSelectedAnswer(option);
                // Case-insensitive comparison needs to check if the 'option' matches any of the correct answers.
                // For the case study, the correct answers are an array in the data.
                const isCorrect = Array.isArray(caseData.correctAnswer)
                    ? caseData.correctAnswer.includes(option)
                    : option.toLowerCase() === caseData.correctAnswer.toLowerCase();
                
                if (isCorrect) {
                    onComplete(); // Marks the step as complete if the correct answer is chosen.
                }
            };

            return (
                <div className="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h4 className="font-bold text-lg text-gray-800 mb-2">Critical Thinking Case Study</h4>
                    {/* Scenario description, using dangerouslySetInnerHTML to render HTML bold tags */}
                    <p className="bg-blue-100 text-blue-800 p-3 rounded-md mb-4 text-sm" dangerouslySetInnerHTML={{ __html: caseData.scenario }}></p>
                    <p className="font-semibold text-gray-700 mb-3" dangerouslySetInnerHTML={{ __html: caseData.question }}></p>
                    <div className="space-y-2">
                        {caseData.options.map(option => {
                            const isSelected = selectedAnswer === option;
                            // Case-insensitive comparison for correct answer highlight
                            const isCorrectOption = Array.isArray(caseData.correctAnswer)
                                ? caseData.correctAnswer.includes(option)
                                : option.toLowerCase() === caseData.correctAnswer.toLowerCase();
                            const showFeedback = selectedAnswer !== null; // Show feedback once any answer is selected 

                            let optionClass = 'bg-white hover:bg-gray-100 border-gray-200'; // Default styling for options.
                            if (showFeedback) {
                                if (isCorrectOption) {
                                    optionClass = 'bg-green-100 border-green-500 text-green-800'; // Correct answer always green when feedback is shown 
                                } else if (isSelected && !isCorrectOption) {
                                    optionClass = 'bg-red-100 border-red-500 text-red-800'; // Incorrect selected answer is red 
                                }
                            } else if (isSelected) {
                                optionClass = 'bg-indigo-100 border-indigo-500 text-indigo-800'; // Highlight selected before submission 
                            } 

                            return (
                                <div
                                    key={option}
                                    onClick={() => handleSelect(option)}
                                    className={cn('p-3 rounded-lg border-2 cursor-pointer transition-colors', optionClass)}
                                >
                                    <div className="flex items-center">
                                        {showFeedback && ( // Display a checkmark or cross icon if feedback is active 
                                            isCorrectOption ? <span className="text-green-600 mr-2">✓</span> : (isSelected && <span className="text-red-600 mr-2">✗</span>)
                                        )}
                                        <span className="flex-1">{option}</span>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    {selectedAnswer && ( // Display the explanation after an answer has been selected.
                        <div className="mt-4 p-3 bg-indigo-50 rounded-lg border-l-4 border-indigo-500">
                            <h5 className="font-bold text-indigo-800">Explanation</h5>
                            <p className="text-sm text-indigo-700" dangerouslySetInnerHTML={{ __html: caseData.explanation }}></p>
                        </div>
                    )}
                </div>
            );
        };
        
        /**
         * VitalsCheck component for an interactive question about vital signs.
         * This component is not used in this module, but kept for completeness if needed in other modules.
         */
        const VitalsCheck = ({ onComplete }) => {
            // State to store the user's selected vital sign.
            const [selectedVital, setSelectedVital] = useState(null);
            const vitals = { "BP": "100/68 mmHg", "HR": "110 bpm", "RR": "24/min", "Temp": "99°F" };
            const mostConcerning = "HR"; // The correct answer.
            const explanation = "A heart rate of 110 bpm (tachycardia) is a significant sign of distress. It indicates the heart is working hard to compensate for poor perfusion, which is common during an acute myocardial infarction.";

            // Handles the selection of a vital sign option.
            const handleSelect = (vital) => {
                if(selectedVital) return; // Prevents changing the selection once made.
                setSelectedVital(vital);
                // Case-insensitive comparison (though keys are already consistent)
                if (vital.toLowerCase() === mostConcerning.toLowerCase()) {
                    onComplete(); // Mark step as complete if correct answer is chosen 
                }
            };

            return (
                <div className="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h4 className="font-bold text-lg text-gray-800 mb-2">Vitals Check</h4>
                    <p className="text-sm text-gray-600 mb-4">A patient presents with chest pain. Based on these vital signs, which one is the MOST concerning indicator of impaired central perfusion?</p>
                    <div className="grid grid-cols-2 sm:grid-cols-4 gap-4">
                        {Object.entries(vitals).map(([key, value]) => {
                            const isSelected = selectedVital === key;
                            // Case-insensitive comparison for correct answer highlight
                            const isCorrect = key.toLowerCase() === mostConcerning.toLowerCase();
                            const showFeedback = selectedVital !== null; // Show feedback once any vital is selected 

                            let optionClass = 'bg-white hover:bg-gray-100 border-gray-200'; // Default styling.
                            if (showFeedback) {
                                if (isCorrect) {
                                    optionClass = 'bg-green-100 border-green-500 text-green-800'; // Correct answer always green when feedback is shown 
                                } else if (isSelected && !isCorrect) {
                                    optionClass = 'bg-red-100 border-red-500 text-red-800'; // Incorrect selected answer is red 
                                }
                            } else if (isSelected) {
                                optionClass = 'bg-indigo-100 border-indigo-500 text-indigo-800'; // Highlight selected before submission 
                            } 
                            return (
                                <div key={key} onClick={() => handleSelect(key)} className={cn('p-4 rounded-lg border-2 cursor-pointer text-center', optionClass)}>
                                    <div className="text-sm font-bold text-gray-500">{key}</div>
                                    <div className="text-xl font-semibold text-gray-800">{value}</div>
                                </div>
                            );
                        })}
                    </div>
                   {selectedVital && ( // Display the rationale after a selection is made.
                        <div className="mt-4 p-3 bg-indigo-50 rounded-lg border-l-4 border-indigo-500">
                            <h5 className="font-bold text-indigo-800">Rationale</h5>
                            <p className="text-sm text-indigo-700" dangerouslySetInnerHTML={{ __html: explanation }}></p>
                        </div>
                    )}
                </div>
            );
        };
        
        /**
         * StaticContentStep component for displaying basic text content.
         * Marks itself as complete immediately on render.
         */
        const StaticContentStep = ({ step, onComplete }) => {
            // For 'text' type steps, mark them as complete immediately upon rendering.
            // The effect should only run once when the component mounts to prevent an infinite loop.
            useEffect(() => {
                onComplete();
            }, []); // Empty dependency array ensures this runs only once.

            // Using dangerouslySetInnerHTML to render HTML content (e.g., <strong> tags).
            return (
                <div className="prose max-w-none text-gray-700 leading-relaxed p-4 bg-gray-50 rounded-lg shadow-inner space-y-4" dangerouslySetInnerHTML={{ __html: step.content }}>
                </div>
            );
        };

        /**
         * CompletionModal component displayed when a module is completed.
         */
        const CompletionModal = ({ isOpen, onClose, onNextModule, hasNextModule }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center transform animate-fade-in">
                        <h3 className="text-2xl font-bold text-indigo-700 mb-4">Module Completed! 🎉</h3>
                        <p className="text-gray-700 mb-6">You've successfully completed all steps in this module. Great job!</p>
                        <div className="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                            <button
                                onClick={onClose}
                                className="px-6 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 transition-colors shadow-sm"
                            >
                                Back to Dashboard
                            </button>
                            {hasNextModule && (
                                <button
                                    onClick={onNextModule}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors"
                                >
                                    Continue to Next Module
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        /**
         * LearningModule component to manage steps within the selected module.
         * Provides navigation between steps and renders the appropriate content for each.
         */
        const LearningModule = ({ module, onBack, progress, onProgressUpdate, onNextModule, hasNextModule }) => {
            const [activeStep, setActiveStep] = useState(0); // Manages the index of the currently active step.
            const [isSidebarOpen, setIsSidebarOpen] = useState(false); // Controls the visibility of the sidebar on mobile.
            const [isCompletionModalOpen, setIsCompletionModalOpen] = useState(false); // State for completion modal 

            // Callback function to update the completion status of a specific step.
            const handleStepComplete = useCallback((stepId, data = {}) => {
                onProgressUpdate(module.id, stepId, { completed: true, ...data });
            }, [onProgressUpdate, module.id]);

            const moduleProgress = progress[module.id] || {};
            
            // Check if all steps in the current module are completed
            const allStepsCompletedInModule = module.steps.every(step =>
                moduleProgress[step.id] && moduleProgress[step.id].completed
            );

            // Navigates to the next step, if available.
            const handleNextStep = () => {
                // If it's the last step and all steps in the module are completed, open the modal 
                if (activeStep === module.steps.length - 1 && allStepsCompletedInModule) {
                    setIsCompletionModalOpen(true);
                } else if (activeStep < module.steps.length - 1) {
                    setActiveStep(activeStep + 1);
                }
            };

            // Navigates to the previous step, if available.
            const handlePrevStep = () => {
                if (activeStep > 0) {
                    setActiveStep(activeStep - 1);
                }
            };
            
            // Ensure module and its steps are defined before accessing properties 
            if (!module || !module.steps) {
                console.error("LearningModule received invalid module prop:", module);
                return <div className="fixed inset-0 flex items-center justify-center bg-gray-100 text-gray-700">Loading module...</div>;
            }

            const currentStep = module.steps[activeStep];
            
            // Renders the appropriate content component based on the current step's type.
            // This function acts as a router for different interactive and static content types.
            const renderStepContent = (step) => {
                if (!step) return <p>Please select a step.</p>;

                const onCompleteForStep = (data) => handleStepComplete(step.id, data);

                switch (step.type) {
                    case 'text':
                        return <StaticContentStep key={step.id} step={step} onComplete={onCompleteForStep} />;
                    case 'interactive_vitals':
                        return <VitalsCheck key={step.id} onComplete={onCompleteForStep} />;
                    case 'case_study':
                        return <CaseStudy key={step.id} caseData={step.case} onComplete={onCompleteForStep} />;
                    case 'quiz':
                        return <Quiz key={step.id} questions={step.questions} onComplete={onCompleteForStep} />;
                    default:
                        // Fallback for unrecognized step types, ensuring robust error handling.
                        return <p key={step.id} className="text-red-600">Error: Content for this step type is not available.</p>;
                }
            };

            const handleModalClose = () => {
                setIsCompletionModalOpen(false);
                onBack(); // Go back to dashboard when modal is closed 
            };

            const handleModalNextModule = () => {
                setIsCompletionModalOpen(false);
                onNextModule(); // Proceed to next module 
            };


            return (
                <div className="fixed inset-0 bg-gray-100 flex flex-col z-20">
                    {/* Header for the learning module, including back button and module title. */}
                    <header className="bg-white shadow-md p-4 flex items-center justify-between z-30 flex-shrink-0">
                        <button onClick={onBack} className="flex items-center gap-2 text-indigo-600 font-semibold hover:text-indigo-800 transition-colors p-2 rounded-lg -ml-2">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clipRule="evenodd" /></svg>
                            <span className="hidden sm:inline">Dashboard</span>
                        </button>
                        <div className="flex items-center gap-3">
                            <h2 className="text-xl font-bold text-gray-800 text-center flex-1 sm:flex-initial truncate px-2">{module.title}</h2>
                        </div>
                        {/* Mobile sidebar toggle button using text/emoji placeholders. */}
                        <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors">
                           <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        </button>
                    </header>
                    {isSidebarOpen && <div onClick={() => setIsSidebarOpen(false)} className="fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden"></div>}
                    <div className="flex flex-1 overflow-hidden">
                        {/* Sidebar for navigation steps within the module. */}
                        <aside className={cn(
                            "bg-white border-r border-gray-200 p-4 w-72 lg:w-80 flex-shrink-0 flex flex-col transition-transform duration-300 ease-in-out md:translate-x-0 absolute md:static h-full z-20",
                            isSidebarOpen ? 'translate-x-0' : '-translate-x-full'
                        )}>
                            <h3 className="text-lg font-semibold mb-4 text-gray-700 px-3">Module Steps</h3>
                            <nav className="space-y-1 overflow-y-auto flex-1 pr-1">
                                {module.steps.map((step, index) => (
                                    <button
                                        key={step.id}
                                        onClick={() => {
                                            setActiveStep(index);
                                            setIsSidebarOpen(false); // Close sidebar on mobile after a step is selected.
                                        }}
                                        className={cn(
                                            'w-full text-left p-3 rounded-lg flex items-center gap-3 transition-colors',
                                            activeStep === index ? 'bg-indigo-100 text-indigo-700 font-semibold' : 'hover:bg-gray-100 text-gray-700'
                                        )}
                                    >
                                        {/* Step completion indicator */}
                                        <div className="w-5 h-5 flex-shrink-0 flex items-center justify-center">
                                            {moduleProgress[step.id]?.completed ? (
                                                <svg className="w-5 h-5 text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" /></svg>
                                            ) : (
                                                <div className={cn("w-3 h-3 rounded-full border-2", activeStep === index ? "border-indigo-500 bg-indigo-500" : "border-gray-400 bg-white")}></div>
                                            )}
                                        </div>
                                        <span className="flex-1 text-sm">{step.title}</span>
                                    </button>
                                ))}
                            </nav>
                        </aside>

                        {/* Main content area for the current step. */}
                        <main className="flex-1 overflow-y-auto p-4 sm:p-6 md:p-8">
                            <div className="max-w-5xl mx-auto">
                                <h3 className="text-2xl font-bold text-gray-800 mb-4">{currentStep.title}</h3>
                                {renderStepContent(currentStep)}

                                {/* Navigation buttons for moving between steps. */}
                                <div className="flex justify-between mt-8">
                                    <button
                                        onClick={handlePrevStep}
                                        disabled={activeStep === 0}
                                        className="px-6 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm"
                                    >
                                        Previous
                                    </button>

                                    <button
                                        onClick={handleNextStep}
                                        disabled={activeStep === module.steps.length - 1 && !allStepsCompletedInModule}
                                        className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md"
                                    >
                                        {activeStep === module.steps.length - 1 ? 'Finish Module' : 'Next'}
                                    </button>
                                </div>
                            </div>
                        </main>
                    </div>
                    <CompletionModal
                        isOpen={isCompletionModalOpen}
                        onClose={handleModalClose}
                        onNextModule={handleModalNextModule}
                        hasNextModule={hasNextModule}
                    />
                </div>
            );
        };
        
        // --- Main App Component ---
        /**
         * The root component of the Antihypertensives Learning Module application.
         * Manages overall application state, including module selection, user ID, and progress.
         */
        function App() {
            // State for the currently selected learning module's ID. Null means Dashboard is active.
            const [currentModuleId, setCurrentModuleId] = useState(null);
            const [isPreAssessmentActive, setIsPreAssessmentActive] = useState(false);
            // State for the authenticated user's ID, used for local storage progress tracking.
            const [userId, setUserId] = useState(null);
            // State for storing the user's progress across all modules and steps.
            const [progress, setProgress] = useState({});
            // State to indicate if authentication is complete and user ID is available.
            const [isAuthReady, setIsAuthReady] = useState(false);

            // Effect hook for handling initial authentication and setting the user ID.
            useEffect(() => {
                const unsubscribe = mockAuth.onAuthStateChanged((user) => {
                    if (user) setUserId(user.uid);
                    setIsAuthReady(true); // Mark authentication as ready once user is determined.
                });
                return () => unsubscribe(); // Cleanup the auth state listener on component unmount.
            }, []); // Empty dependency array ensures this runs only once on mount.

            // Effect hook for loading user progress from localStorage after authentication is ready.
            useEffect(() => {
                if (!isAuthReady || !userId) return; // Only proceed if auth is ready and userId is available.
                const storedProgress = localStorage.getItem(`antihypertensives-module-progress-${userId}`);
                if (storedProgress) {
                    try {
                        setProgress(JSON.parse(storedProgress)); // Attempt to parse and set stored progress.
                    } catch (e) {
                        console.error("Failed to parse stored progress, resetting.", e);
                        setProgress({}); // Reset progress if parsing fails (e.g., corrupted data).
                    }
                }
            }, [isAuthReady, userId]); // Reruns when auth status or userId changes.

            // Callback function to update and persist the user's progress for a specific step.
            const handleProgressUpdate = useCallback((moduleId, stepId, data = {}) => {
                if (!isAuthReady || !userId) return;

                setProgress(currentProgress => {
                    const currentStepProgress = currentProgress[moduleId]?.[stepId] || {};
                    const newStepProgress = { ...currentStepProgress, ...data };

                    // If the old and new step data are identical, do not update state.
                    // This prevents the infinite re-render loop.
                    if (JSON.stringify(currentStepProgress) === JSON.stringify(newStepProgress)) {
                        return currentProgress;
                    }

                    // Otherwise, proceed with the update.
                    const newProgress = {
                        ...currentProgress,
                        [moduleId]: {
                            ...(currentProgress[moduleId] || {}),
                            [stepId]: newStepProgress
                        }
                    };

                    localStorage.setItem(`antihypertensives-module-progress-${userId}`, JSON.stringify(newProgress));
                    return newProgress;
                });
            }, [isAuthReady, userId]);

            const handlePreAssessmentComplete = (completedModuleIds) => {
                const newProgress = { ...progress };
                completedModuleIds.forEach(moduleId => {
                    const module = contentData[moduleId];
                    if (module) {
                        newProgress[moduleId] = {};
                        module.steps.forEach(step => {
                            newProgress[moduleId][step.id] = { completed: true };
                        });
                    }
                });
                setProgress(newProgress);
                localStorage.setItem(`antihypertensives-module-progress-${userId}`, JSON.stringify(newProgress));
                // The results screen is now part of the PreAssessmentQuiz component.
                // We just need to handle exiting it.
            };
            
            // Callback to reset all progress
            const handleResetProgress = useCallback(() => {
                if (!isAuthReady || !userId) return;
                // Clear from state
                setProgress({});
                // Clear from localStorage
                localStorage.removeItem(`antihypertensives-module-progress-${userId}`);
            }, [isAuthReady, userId]);

            // Function to navigate to the next module in the sequence
            const handleNextModule = useCallback(() => {
                const moduleIds = Object.keys(contentData);
                const currentIndex = moduleIds.indexOf(currentModuleId);
                if (currentIndex !== -1 && currentIndex < moduleIds.length - 1) {
                    setCurrentModuleId(moduleIds[currentIndex + 1]);
                } else {
                    // If it's the last module, go back to the dashboard.
                    setCurrentModuleId(null);
                }
            }, [currentModuleId]);

            // Determine which module is currently selected based on `currentModuleId`.
            const selectedModule = currentModuleId && contentData[currentModuleId]
                                             ? { ...contentData[currentModuleId], id: currentModuleId }
                                             : null;

            const moduleIds = Object.keys(contentData);
            const currentIndex = selectedModule ? moduleIds.indexOf(selectedModule.id) : -1;
            const hasNextModule = currentIndex !== -1 && currentIndex < moduleIds.length - 1;


            return (
                <div className="bg-gray-100 min-h-screen font-sans text-gray-900">
                    {isPreAssessmentActive ? (
                        <PreAssessmentQuiz 
                            onComplete={handlePreAssessmentComplete} 
                            onExit={() => setIsPreAssessmentActive(false)}
                        />
                    ) : selectedModule ? (
                        <LearningModule
                            key={selectedModule.id}
                            module={selectedModule}
                            onBack={() => setCurrentModuleId(null)}
                            progress={progress}
                            onProgressUpdate={handleProgressUpdate}
                            onNextModule={handleNextModule}
                            hasNextModule={hasNextModule}
                        />
                    ) : (
                        <Dashboard 
                            onSelectModule={setCurrentModuleId} 
                            progress={progress} 
                            onResetProgress={handleResetProgress}
                            onStartPreAssessment={() => setIsPreAssessmentActive(true)}
                        />
                    )}
                </div>
            );
        }

        // --- Render the App into the DOM ---
        // Get the DOM element where the React application will be mounted.
        const container = document.getElementById('root');
        // Create a React root, which is the entry point for React 18+ applications.
        const root = ReactDOM.createRoot(container);
        // Render the main App component into the root.
        root.render(<App />);
    </script>
</body>
</html>
