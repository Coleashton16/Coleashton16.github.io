<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anticoagulants, Antiplatelets, and Thrombolytics Learning Module</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CSS configuration to use the Inter font.
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    keyframes: {
                        'fade-in': {
                            '0%': { opacity: '0', transform: 'scale(0.95)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                    },
                    animation: {
                        'fade-in': 'fade-in 0.3s ease-out forwards',
                    },
                },
            },
        };
    </script>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="font-sans antialiased text-gray-900 bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        // --- React and Library Setup ---
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- Mock Authentication Setup for Standalone Demo ---
        // This mock object simulates basic user authentication to allow progress tracking via localStorage.
        // In a real application, this would be replaced with actual Firebase authentication.
        const mockAuth = {
            onAuthStateChanged: (callback) => {
                // Simulate an asynchronous authentication check, providing a unique user ID.
                setTimeout(() => callback({ uid: 'standalone-anticoagulants-user' }), 100);
                return () => {}; // Returns an empty function as a cleanup/unsubscribe placeholder.
            },
            signInAnonymously: () => Promise.resolve({ user: { uid: 'standalone-anticoagulants-user' } }), // Mock anonymous sign-in.
        };

        // --- Content & Data Structure for the Learning Modules ---
        // The main content is broken down into smaller, focused modules based on concepts.
        const contentData = {
            'intro-thrombus': {
                title: 'Introduction to Thrombus Formation',
                color: 'from-sky-500 to-cyan-400',
                description: 'Understand blood clot formation and the types of drugs that affect it.',
                steps: [
                    { id: 'drug-groups-intro', title: 'Drug Groups for Circulation', type: 'text', content: `Various drugs are used to maintain or restore circulation. The three major groups are:
                        <ol>
                            <li><strong>Anticoagulants:</strong> Prevent the formation of clots that inhibit circulation.</li>
                            <li><strong>Antiplatelets (Antithrombotics):</strong> Prevent platelet aggregation (clumping together of platelets to form a clot).</li>
                            <li><strong>Thrombolytics:</strong> Appropriately called "clot busters," they attack and dissolve blood clots that have already formed.</li>
                        </ol>
                        Each of these three drug groups will be discussed separately.` },
                    { id: 'thrombus-pathophysiology', title: 'Pathophysiology: Thrombus Formation', type: 'text', content: `<strong>Thrombosis</strong> is the formation of a clot in an arterial or venous vessel.
                        <br><br>
                        <strong>Arterial Thrombus:</strong>
                        <ul>
                            <li>Caused by blood stasis (decreased circulation), platelet aggregation on the blood vessel wall, or blood coagulation.</li>
                            <li>Usually made up of both white (platelets) and red clots. Platelets initiate the process, followed by fibrin formation and trapping of red blood cells.</li>
                            <li>Platelets do not usually stick together unless there is a break in the endothelial lining of a blood vessel.</li>
                            <li>When platelets adhere to a broken surface, they synthesize <strong>thromboxane A2 (TxA2)</strong>, a potent stimulus for platelet aggregation.</li>
                            <li>The platelet receptor protein that binds fibrinogen, <strong>glycoprotein IIb/IIIa (GP IIb/IIIa)</strong>, also promotes platelet aggregation. TxA2 and adenosine diphosphate (ADP) increase the activation of this receptor.</li>
                            <li>As the clot occludes the blood vessel, tissue ischemia occurs.</li>
                        </ul>
                        <br>
                        <strong>Venous Thrombus:</strong>
                        <ul>
                            <li>Usually develops due to slow blood flow.</li>
                            <li>Formed from platelet aggregation with fibrin that attaches to red blood cells.</li>
                            <li>Small pieces can detach and travel to the pulmonary artery and then to the lung, leading to inadequate oxygenation and gas exchange.</li>
                        </ul>
                        Both arterial and venous thrombi can dislodge and become an <strong>embolus</strong> (a blood clot moving through the bloodstream).
                        <br><br>
                        Oral and parenteral anticoagulants (e.g., warfarin, heparin) primarily prevent venous thrombosis, while antiplatelet drugs prevent arterial thrombosis. However, both groups generally suppress thrombosis.` },
                    { id: 'thrombus-intro-quiz', title: 'Thrombus Formation Quiz', type: 'quiz',
                      questions: [
                          { question: "Which type of drug is known for attacking and dissolving blood clots that have already formed?", options: ["Anticoagulants", "Antiplatelets", "Thrombolytics", "Antithrombotics"], correctAnswer: "Thrombolytics" },
                          { question: "What is the primary initiating factor in the formation of an arterial thrombus?", options: ["Slow blood flow", "Fibrin formation", "Platelet aggregation", "Red blood cell clumping"], correctAnswer: "Platelet aggregation" },
                          { question: "Which substance is a potent stimulus for platelet aggregation, synthesized by platelets when they adhere to a broken endothelial lining?", options: ["Fibrinogen", "Thrombin", "Thromboxane A2", "Adenosine diphosphate (ADP)"], correctAnswer: "Thromboxane A2" }
                      ]
                    },
                ]
            },
            'anticoagulants': {
                title: 'Anticoagulants: Heparin, Warfarin & Others',
                color: 'from-red-500 to-orange-400',
                description: 'Learn about the mechanisms, uses, and nursing considerations for various anticoagulant medications.',
                steps: [
                    { id: 'anticoagulants-overview', title: 'Anticoagulants: Overview', type: 'text', content: `<strong>Anticoagulants</strong> inhibit clot formation; they do not dissolve existing clots but act prophylactically to prevent new ones.
                        <br><br>
                        Used in patients at high risk for clot formation due to:
                        <ul>
                            <li><strong>Venous disorders:</strong> Deep venous thrombosis (DVT), pulmonary embolism (PE).</li>
                            <li><strong>Arterial problems:</strong> Coronary thrombosis (MI), artificial heart valves, cerebrovascular accident (CVA/stroke).</li>
                        </ul>
                        Administered orally or parenterally (subcutaneously, intravenously).` },
                    { id: 'heparin', title: 'Heparin', type: 'text', content: `<strong>Heparin</strong> is a natural substance in the liver that prevents clot formation.
                        <br><br>
                        <strong>Uses:</strong>
                        <ul>
                            <li>Rapid anticoagulant effect for DVT, PE, evolving stroke.</li>
                            <li>Open-heart surgery (prevent clotting).</li>
                            <li>Disseminated intravascular coagulation (DIC).</li>
                            <li>Primary use: Prevent venous thrombosis (leading to PE or stroke).</li>
                        </ul>
                        <strong>Mechanism:</strong> Combines with <strong>antithrombin III</strong>, accelerating the anticoagulant cascade to prevent thrombosis. Inhibits thrombin action, preventing fibrinogen conversion to fibrin and fibrin clot formation.
                        <br><br>
                        <strong>Administration:</strong> Poorly absorbed orally (destroyed by heparinase). Given subcutaneously for prophylaxis or IV for acute thrombosis (bolus or continuous infusion).
                        <br><br>
                        <strong>Monitoring:</strong> Prolongs clotting time. Monitored by <strong>partial thromboplastin time (PTT)</strong> and <strong>activated partial thromboplastin time (aPTT)</strong>. Can decrease platelet count (thrombocytopenia).
                        <br><br>
                        <strong>Antidote:</strong> <strong>Protamine sulfate</strong> (given IV) reverses heparin action if hemorrhage occurs.
                        <br><br>
                        Before discontinuing heparin, oral warfarin therapy is usually initiated.` },
                    { id: 'lmwhs', title: 'Low-Molecular-Weight Heparins (LMWHs)', type: 'text', content: `<strong>Low-Molecular-Weight Heparins (LMWHs)</strong> (e.g., enoxaparin, dalteparin, fondaparinux) are derivatives of standard heparin designed to prevent venous thromboembolism with a lower risk of bleeding.
                        <br><br>
                        <strong>Mechanism:</strong> Inactivate factor Xa, but are less able to inactivate thrombin compared to standard heparin.
                        <br><br>
                        <strong>Advantages:</strong> Produce more stable responses; frequent aPTT monitoring is not required.
                        <br><br>
                        <strong>Uses:</strong> Most commonly prescribed to prevent DVT and acute PE after orthopedic or abdominal surgery (e.g., enoxaparin for hip/knee replacement, dalteparin for abdominal surgery). Fondaparinux is a selective factor Xa inhibitor used for similar purposes.
                        <br><br>
                        <strong>Administration:</strong> Can be administered at home (subcutaneously once or twice daily) in prefilled syringes. Injection sites should be alternated. Average treatment: 7-10 days. Started within 24 hours after surgery.
                        <br><br>
                        <strong>Half-life:</strong> Two to four times longer than heparin.
                        <br><br>
                        <strong>Caution:</strong> Patients should not take antiplatelet drugs (e.g., aspirin) concurrently. Bleeding is less likely than with heparin.
                        <br><br>
                        <strong>Antidote for LMWH overdose:</strong> Protamine sulfate (1 mg for every 100 units of LMWH).
                        <br><br>
                        <strong>Contraindications:</strong> Strokes, peptic ulcers, blood anomalies, eye/brain/spinal surgery.` },
                    { id: 'direct-thrombin-inhibitors', title: 'Direct Thrombin Inhibitors (Parenteral)', type: 'text', content: `<strong>Direct Thrombin Inhibitors</strong> (e.g., argatroban, bivalirudin, desirudin, dabigatran - oral) directly inhibit thrombin from converting fibrinogen to fibrin. They differ from heparin-like anticoagulants.
                        <br><br>
                        <strong>Administration:</strong> Argatroban and bivalirudin are given intravenously. Desirudin is administered subcutaneously. Dabigatran is an oral anticoagulant.
                        <br><br>
                        <strong>Monitoring:</strong> Dabigatran does not require routine coagulation monitoring.
                        <br><br>
                        These drugs are generally more expensive than other anticoagulants.` },
                    { id: 'oral-anticoagulants', title: 'Oral Anticoagulants: Warfarin', type: 'text', content: `<strong>Warfarin</strong> is an oral anticoagulant synthesized from dicumarol.
                        <br><br>
                        <strong>Mechanism:</strong> Inhibits hepatic synthesis of <strong>vitamin K</strong>, thus affecting clotting factors II, VII, IX, and X.
                        <br><br>
                        <strong>Uses:</strong> Mainly to prevent thromboembolic conditions (thrombophlebitis, PE, embolism from atrial fibrillation leading to stroke).
                        <br><br>
                        <strong>Monitoring:</strong> Prolongs clotting time. Monitored by <strong>prothrombin time (PT)</strong> and, more frequently, by the <strong>international normalized ratio (INR)</strong>.
                        <ul>
                            <li>Normal INR: 1.3 to 2.</li>
                            <li>Target INR for warfarin therapy: 2 to 3.</li>
                            <li>Desired INR for mechanical heart valves or recurrent systemic embolism: 2.5 to 3.5 (can be up to 4.5).</li>
                        </ul>
                        INR monitoring is required regularly.
                        <br><br>
                        <strong>Half-life:</strong> Long (20-60 hours), with very long duration. Drug accumulation can occur, leading to external or internal bleeding.
                        <br><br>
                        <strong>Observation:</strong> Nurse must observe for petechiae, ecchymosis, tarry stools, hematemesis, and teach patient to do the same.
                        <br><br>
                        <strong>Antidote for overdose:</strong> <strong>Vitamin K</strong> (phytonadione) takes 24-48 hours to be effective (low oral dose for INR 5.5). Excessive vitamin K can inhibit warfarin for 1-2 weeks. For acute bleeding, fresh frozen plasma is indicated.
                        <br><br>
                        <strong>Pharmacokinetics:</strong> Well absorbed orally; food delays but doesn't inhibit absorption. Highly protein bound (97%). Metabolized to inactive metabolites, excreted in urine and bile. Kidney/liver disease prolong half-life.
                        <br><br>
                        <strong>Pharmacodynamics:</strong> Effective for long-term anticoagulant therapy. Does not cross placental barrier (not recommended in pregnancy).
                        <br><br>
                        <strong>Side Effects/Adverse Reactions:</strong> Major adverse effect is <strong>bleeding (hemorrhage)</strong>. Monitor for petechiae, ecchymosis, GI bleeding, ocular hemorrhage, hematuria.
                        <br><br>
                        <strong>Drug Interactions:</strong> Highly protein bound, affected by many drugs (e.g., aspirin, NSAIDs, sulfonamides, phenytoin, cimetidine, allopurinol, oral hypoglycemics – displace warfarin, increase free drug, risk bleeding). Acetaminophen should be used instead of aspirin. Parenteral vitamin K for frank bleeding.
                        <br><br>
                        <strong>Herbal Interactions:</strong> Dong quai, feverfew, garlic, ginger, meadowsweet, willow bark, chamomile tea, ginkgo, bilberry, excessive anise, cranberry (increase bleeding/INR). Ginseng, alfalfa, goldenseal, valerian, green tea (decrease warfarin effects). Hawthorn (increases action).` },
                    { id: 'factor-xa-inhibitors', title: 'Factor Xa Inhibitors', type: 'text', content: `<strong>Factor Xa Inhibitors</strong> include fondaparinux (subcutaneous) and oral agents like rivaroxaban, apixaban, edoxaban, and betrixaban.
                        <br><br>
                        <strong>Mechanism:</strong> Selectively block activity of clotting factor Xa to prevent clot formation.
                        <br><br>
                        <strong>Advantages:</strong> Do not require routine coagulation monitoring. Given once or twice daily.
                        <br><br>
                        <strong>Uses:</strong> Approved for prevention of DVT and PE.
                        <br><br>
                        <strong>Major Adverse Effect:</strong> Bleeding.
                        <br><br>
                        <strong>Caution:</strong> Not recommended for patients weighing less than 50 kg due to increased bleeding risk.` },
                    { id: 'anticoagulants-np', title: 'Anticoagulants: Nursing Process (Warfarin & Heparin)', type: 'text', content: `<strong>Concept: Clotting</strong><br>
                        <strong>Recognize Cues (Assessment):</strong>
                        <ul>
                            <li>Obtain history of abnormal clotting or health problems affecting clotting (alcoholism, liver/renal disease).</li>
                            <li>Warfarin contraindicated for blood dyscrasias, peptic ulcer, CVA, hemophilia, severe hypertension; use cautiously with acute traumatic injury.</li>
                            <li>Gather drug and herbal history for interactions (warfarin is highly protein bound).</li>
                            <li>Obtain baseline PT/INR for warfarin and aPTT for heparin.</li>
                        </ul>
                        <strong>Analyze Cues and Prioritize Hypothesis (Patient Problems):</strong> Bleeding, Tissue injury, Dehydration.<br>
                        <strong>Generate Solutions (Planning):</strong> Patient will not have excessive bleeding.<br>
                        <strong>Take Action (Nursing Interventions):</strong>
                        <ul>
                            <li>Monitor vital signs (increased pulse, decreased systolic BP can indicate fluid volume deficit/bleeding).</li>
                            <li>Monitor PT/INR for warfarin (target 2-3, up to 3.5 for mechanical valves) and aPTT for heparin (target 1.5-2x control) before administering. Monitor platelet count.</li>
                            <li>Examine for bleeding (mouth, nose/epistaxis, urine/hematuria, skin/petechiae, purpura). Watch older adults closely.</li>
                            <li>Check stools for occult blood.</li>
                            <li>Keep antagonists available: protamine sulfate for heparin, vitamin K for warfarin. Fresh frozen plasma for acute bleeding.</li>
                        </ul>
                        <strong>Patient Teaching:</strong>
                        <ul>
                            <li><strong>General:</strong> Inform dentist; use soft toothbrush, electric razor; have labs done as ordered; carry medical ID card/MedicAlert bracelet.</li>
                            <li><strong>Smoking:</strong> Increases drug metabolism (warfarin dose may need increase).</li>
                            <li><strong>OTC drugs:</strong> Check with provider (aspirin intensifies warfarin, use acetaminophen).</li>
                            <li><strong>Herbal products:</strong> Many interact, increasing bleeding risk; monitor INR/PT closely.</li>
                            <li><strong>Hemorrhage:</strong> Control external bleeding by applying firm, direct pressure for 5-10 minutes.</li>
                            <li><strong>Side Effects:</strong> Report frank or occult bleeding (petechiae, ecchymosis, purpura, tarry stools, bleeding gums, epistaxis, expectoration of blood).</li>
                            <li><strong>Diet:</strong> Avoid large amounts of green, leafy vegetables, broccoli, legumes, soybean oil (rich in vitamin K), coffee, tea, cola (caffeine), excessive alcohol, certain herbs/supplements (coenzyme Q10, fish oils, St. John’s wort, ginseng, vitamin C, garlic, ginger, kava kava, green tea, chamomile tea, ginkgo biloba, acute alcohol intoxication). Be consistent with intake.</li>
                        </ul>
                        <strong>Evaluate Outcomes (Evaluation):</strong> Evaluate effectiveness (PT/INR in range, no significant side effects).` },
                    { id: 'anticoagulants-quiz', title: 'Anticoagulants Quiz', type: 'quiz',
                      questions: [
                          { question: "Which laboratory test is primarily used to monitor heparin therapy?", options: ["Prothrombin Time (PT)", "International Normalized Ratio (INR)", "Activated Partial Thromboplastin Time (aPTT)", "Bleeding Time"], correctAnswer: "Activated Partial Thromboplastin Time (aPTT)" },
                          { question: "What is the antidote for a warfarin overdose?", options: ["Protamine sulfate", "Vitamin K", "Aminocaproic acid", "Fresh frozen plasma"], correctAnswer: "Vitamin K" },
                          { question: "A nurse is preparing to administer enoxaparin. Which statement about low-molecular-weight heparins (LMWHs) is correct?", options: ["LMWHs require frequent aPTT monitoring.", "LMWHs have a shorter half-life than unfractionated heparin.", "LMWHs are typically administered orally.", "LMWHs can be administered at home."], correctAnswer: "LMWHs can be administered at home." },
                          { question: "Which of the following foods should a patient taking warfarin be advised to consume consistently, rather than in large, varying amounts?", options: ["Citrus fruits", "Lean meats", "Green, leafy vegetables", "Dairy products"], correctAnswer: "Green, leafy vegetables" },
                          { question: "Factor Xa inhibitors like rivaroxaban are advantageous because they:", options: ["Require daily PT/INR monitoring.", "Are administered intravenously only.", "Do not require routine coagulation monitoring.", "Are the antidote for heparin overdose."], correctAnswer: "Do not require routine coagulation monitoring." }
                      ]
                    },
                ]
            },
            'antiplatelet-drugs': {
                title: 'Antiplatelet Drugs',
                color: 'from-blue-400 to-indigo-600',
                description: 'Understand how antiplatelet medications prevent arterial thrombosis.',
                steps: [
                    { id: 'antiplatelets-overview', title: 'Antiplatelet Drugs: Overview', type: 'text', content: `<strong>Antiplatelet drugs</strong> prevent thrombosis in the arteries by suppressing platelet aggregation. In contrast, heparin and warfarin primarily prevent thrombosis in the veins.
                        <br><br>
                        Antiplatelet drug therapy is mainly for <strong>prophylactic use</strong> in:
                        <ul>
                            <li>Prevention of MI or stroke for patients with a family history.</li>
                            <li>Prevention of repeat MI or stroke.</li>
                            <li>Prevention of stroke for patients having transient ischemic attacks (TIAs).</li>
                        </ul>` },
                    { id: 'aspirin-antiplatelet', title: 'Aspirin as an Antiplatelet', type: 'text', content: `<strong>Aspirin (ASA)</strong> is an effective and inexpensive treatment for suppressing platelet aggregation.
                        <br><br>
                        <strong>Mechanism:</strong> Inhibits cyclooxygenase (COX), an enzyme needed by platelets to synthesize thromboxane A2 (TxA2).
                        <br><br>
                        <strong>Recommended Doses:</strong>
                        <ul>
                            <li>Stroke prophylaxis: 50 to 325 mg/day.</li>
                            <li>MI prophylaxis: 75 to 162 mg/day.</li>
                        </ul>
                        <strong>Caution:</strong> Due to prolonged antiplatelet activity, aspirin should be discontinued at least 7 days before surgery.` },
                    { id: 'other-antiplatelets', title: 'Other Antiplatelet Drugs', type: 'text', content: `Other antiplatelet drugs include:
                        <ul>
                            <li><strong>Clopidogrel</strong> (Plavix): An adenosine diphosphate (ADP) antagonist. Has effects similar to aspirin but affects platelet aggregation by blocking ADP binding to its receptor. Frequently used after MI or stroke to prevent a second event. May be prescribed singly or with aspirin (more effective together). Discontinued 7 days before surgery.</li>
                            <li><strong>Dipyridamole:</strong> An ADP antagonist, similar to aspirin.</li>
                            <li><strong>Cilostazol:</strong> Inhibits platelet aggregation and is a vasodilator; used for intermittent claudication.</li>
                            <li><strong>Prasugrel, Ticagrelor, Vorapaxar, Cangrelor:</strong> Newer antiplatelet agents with specific mechanisms and uses. Ticagrelor is often taken with low-dose aspirin.</li>
                            <li><strong>Glycoprotein (GP) IIb/IIIa Receptor Antagonists:</strong> (e.g., abciximab, eptifibatide, tirofiban) Block the binding of fibrinogen to the GP IIb/IIIa receptor on the platelet surface. Used primarily for acute coronary syndromes (unstable angina or non-Q-wave MI) and preventing reocclusion after percutaneous transluminal coronary angioplasty (PTCA). Abciximab is often the drug of choice for angioplasty.</li>
                        </ul>
                        <strong>Herbal Interactions:</strong> Dong quai, feverfew, garlic, ginger, Korean ginseng, saw palmetto, ginkgo biloba interfere with platelet aggregation; increase bleeding risk when taken with antiplatelets. Licorice may cause hypokalemia, potentiating drug toxicity. St. John’s wort with clopidogrel may potentiate drug effects.` },
                    { id: 'antiplatelets-quiz', title: 'Antiplatelet Drugs Quiz', type: 'quiz',
                      questions: [
                          { question: "What is the primary purpose of antiplatelet drug therapy?", options: ["To dissolve existing blood clots", "To inhibit hepatic synthesis of vitamin K", "To suppress platelet aggregation in arteries", "To increase blood clotting factors"], correctAnswer: "To suppress platelet aggregation in arteries" },
                          { question: "How does aspirin exert its antiplatelet effect?", options: ["By blocking ADP receptors", "By inhibiting thrombin directly", "By inhibiting cyclooxygenase (COX)", "By increasing fibrinogen levels"], correctAnswer: "By inhibiting cyclooxygenase (COX)" },
                          { question: "Which antiplatelet drug is an ADP antagonist often used after MI or stroke to prevent a second event, and should be discontinued 7 days before surgery?", options: ["Aspirin", "Cilostazol", "Abciximab", "Clopidogrel"], correctAnswer: "Clopidogrel" },
                          { question: "Glycoprotein (GP) IIb/IIIa receptor antagonists are primarily used for which condition?", options: ["Deep vein thrombosis (DVT)", "Chronic stable angina", "Acute coronary syndromes and prevention of reocclusion after PTCA", "Hypertension"], correctAnswer: "Acute coronary syndromes and prevention of reocclusion after PTCA" }
                      ]
                    },
                ]
            },
            'thrombolytics': {
                title: 'Thrombolytics',
                color: 'from-gray-700 to-gray-900',
                description: 'Understand how thrombolytic medications dissolve existing blood clots.',
                steps: [
                    { id: 'thrombolytics-overview', title: 'Thrombolytics: Overview & Mechanism', type: 'text', content: `<strong>Thromboembolism</strong> (occlusion by thrombus or embolus) causes ischemia and tissue necrosis. Natural fibrinolytic mechanisms take 1-2 weeks to disintegrate clots.
                        <br><br>
                        <strong>Thrombolytic therapy</strong> aims to dissolve new thrombi/emboli quickly to minimize tissue necrosis and reestablish blood flow.
                        <br><br>
                        <strong>Mechanism:</strong> Promote the fibrinolytic mechanism by converting <strong>plasminogen to plasmin</strong>. Plasmin is an enzyme that destroys the fibrin in the blood clot. These drugs induce fibrinolysis (fibrin breakdown).
                        <br><br>
                        <strong>Timing is Critical:</strong>
                        <ul>
                            <li>Administer as soon as possible after symptoms of acute myocardial infarction (AMI/heart attack). Ideally within 3-4 hours or 30 minutes of hospital arrival. Benefits may be seen up to 12 hours after initial symptoms.</li>
                            <li>Administer within 3 hours of a thrombotic stroke.</li>
                        </ul>
                        This prevents or minimizes necrosis and may decrease hospitalization time.
                        <br><br>
                        <strong>Uses:</strong> AMI, PE, DVT, noncoronary arterial occlusion from acute thromboembolism, thrombotic stroke.` },
                    { id: 'thrombolytics-drugs', title: 'Common Thrombolytics', type: 'text', content: `Commonly used thrombolytics include:
                        <ul>
                            <li><strong>Alteplase (tissue plasminogen activator - tPA):</strong> Clot-specific. Binds to the fibrin surface of a clot, promoting plasminogen conversion to plasmin. Plasmin digests fibrin, fibrinogen, and other clotting factors. Allergic reactions are less frequent than with other thrombolytics.</li>
                            <li><strong>Tenecteplase (TNK tPA):</strong> Similar to alteplase.</li>
                            <li><strong>Reteplase (r-PA):</strong> Penetrates clots and activates plasminogen inside the clot, potentially leading to higher clot lysis.</li>
                        </ul>
                        <strong>Administration (Alteplase example):</strong> Initially 10% of dose as IV bolus over 1 minute, then 90% infused over 60 minutes. Recommended max total dose is 90 mg (larger doses increase intracranial bleeding risk).
                        <br><br>
                        <strong>Pharmacodynamics (Alteplase):</strong> Peak action in 5-10 minutes. Duration of action is 1 hour.
                        <br><br>
                        <strong>Side Effects/Adverse Reactions:</strong>
                        <ul>
                            <li>Major complication: <strong>Hemorrhage (bleeding)</strong>.</li>
                            <li>Allergic reactions (less than 1% for tenecteplase): Anaphylactoid reactions (rash, laryngeal edema, angioedema, anaphylactic shock).</li>
                            <li>Reperfusion dysrhythmia or hemorrhagic infarction at myocardial necrotic area (if administered intracoronary after MI).</li>
                        </ul>
                        <strong>Antidote for bleeding:</strong> <strong>Aminocaproic acid</strong> (inhibits plasminogen activation, stopping thrombolysis).
                        <br><br>
                        <strong>Contraindications:</strong> Intracranial bleeding, aneurysm, CVA, brain tumor, head trauma, thrombocytopenia, coagulopathy, active bleeding, severe hypertension, recent traumatic injury.
                        <br><br>
                        <strong>Drug Interactions:</strong> Anticoagulants and antiplatelet drugs increase hemorrhage risk; avoid until thrombolytic effect passes.
                        <br><br>
                        <strong>Herbal Interactions:</strong> Ginkgo biloba, garlic, feverfew, ginger, green tea, omega-3 fatty acids (increase bleeding).` },
                    { id: 'thrombolytics-np', title: 'Thrombolytics: Nursing Process', type: 'text', content: `<strong>Concept: Clotting</strong><br>
                        <strong>Recognize Cues (Assessment):</strong>
                        <ul>
                            <li>Assess baseline vital signs.</li>
                            <li>Check baseline CBC, PT/INR values.</li>
                            <li>Obtain medical and drug history. Contraindications: recent CVA, active bleeding, severe hypertension, anticoagulant therapy, recent traumatic injury (especially head injury). Report aspirin or NSAID use.</li>
                        </ul>
                        <strong>Analyze Cues and Prioritize Hypothesis (Patient Problems):</strong> Bleeding, Tissue injury, Dehydration.<br>
                        <strong>Generate Solutions (Planning):</strong> Patient’s vital signs will be normal; patient will be free of excessive bleeding.<br>
                        <strong>Take Action (Nursing Interventions):</strong>
                        <ul>
                            <li>Monitor vital signs (increased pulse, decreased BP indicates blood loss/shock). Record and report changes.</li>
                            <li>Observe for signs of active bleeding (mouth, rectum). Hemorrhage is serious; aminocaproic acid can be given.</li>
                            <li>Examine for active bleeding for 24 hours after therapy: every 15 mins for first hour, then every 30 mins until 8th hour, then hourly.</li>
                            <li>Observe for allergic reaction: itching, hives, flushing, fever, dyspnea, bronchospasm, hypotension, cardiovascular collapse.</li>
                            <li>Avoid aspirin/NSAIDs for pain; acetaminophen can be substituted.</li>
                            <li>Monitor ECG for reperfusion dysrhythmias (antidysrhythmic therapy may be needed).</li>
                            <li>Avoid venipuncture/arterial sticks.</li>
                        </ul>
                        <strong>Patient Teaching:</strong>
                        <ul>
                            <li>Explain treatment to patient/family. Be supportive.</li>
                            <li>Report side effects: lightheadedness, dizziness, palpitations, nausea, pruritus, urticaria.</li>
                        </ul>
                        <strong>Evaluate Outcomes (Evaluation):</strong> Evaluate effectiveness (clot dissolved, stable vitals, no active bleeding, pain free).` },
                    { id: 'thrombolytics-quiz', title: 'Thrombolytics Quiz', type: 'quiz',
                      questions: [
                          { question: "Thrombolytic drugs primarily work by converting plasminogen into which enzyme?", options: ["Thrombin", "Fibrinogen", "Plasmin", "Factor Xa"], correctAnswer: "Plasmin" },
                          { question: "Ideally, within what timeframe should a thrombolytic drug be administered after the onset of symptoms of an acute myocardial infarction (AMI)?", options: ["Within 6-8 hours", "Within 12-24 hours", "Within 3-4 hours", "Within 48 hours"], correctAnswer: "Within 3-4 hours" },
                          { question: "What is the major complication associated with thrombolytic drug therapy?", options: ["Hypotension", "Bradycardia", "Hemorrhage", "Hyperglycemia"], correctAnswer: "Hemorrhage" },
                          { question: "Which drug is used as an antidote to stop bleeding caused by thrombolytic therapy?", options: ["Vitamin K", "Protamine sulfate", "Aminocaproic acid", "Naloxone"], correctAnswer: "Aminocaproic acid" }
                      ]
                    },
                ]
            },
            'chapter-review': {
                title: 'Chapter Review & NCLEX Questions',
                color: 'from-gray-700 to-gray-900',
                description: 'Integrate knowledge and practice NCLEX-style review questions for Chapter 43.',
                steps: [
                    { id: 'critical-thinking-case-study', title: 'Critical Thinking Case Study', type: 'case_study', case: {
                        scenario: `A 57-year-old man has thrombophlebitis in the right lower leg. IV heparin, 5000 units by bolus, was given. After the IV bolus, heparin 5000 units given subcutaneously every 6 hours was prescribed. Other therapeutic means to decrease pain and alleviate swelling and redness were also prescribed, and an aPTT test was ordered.
                        <br><br>
                        After 5 days of heparin therapy, the patient was prescribed oral warfarin 5 mg daily. An INR test was ordered.`,
                        question: `
                        1. Was the patient’s heparin order within the safe daily dosage range?
                        <br><br>
                        2. What are the various methods for administering heparin?
                        <br><br>
                        3. Why was an aPTT test ordered? How would you determine whether the patient is within the desired range? Explain your answer.
                        <br><br>
                        4. What is the pharmacologic action of warfarin? Is the warfarin dose within the safe daily dosage range? Explain your answer.
                        <br><br>
                        5. What are the half-life and protein binding for warfarin? If a patient takes a drug that is highly protein bound, would there be a drug interaction? Explain your answer.
                        <br><br>
                        6. Why was an INR ordered for the patient? What is the desired range?
                        <br><br>
                        7. What serious adverse reactions could result with prolonged use or large doses of warfarin?
                        <br><br>
                        8. What patient teaching interventions should the nurse include? List three interventions.
                        <br><br>
                        <em>Months later, the patient has hematemesis.</em>
                        <br><br>
                        9. What nursing action should be taken?
                        `,
                        options: [
                             "This is a discussion-based case study, not multiple choice."
                        ],
                        correctAnswer: ["This is a discussion-based case study, not multiple choice."],
                        explanation: `This is a multi-part, open-ended case study designed for critical thinking and discussion. Here are the rationales for each question based on Chapter 43 content:
                        <br><br>
                        <strong>1. Was the patient’s heparin order within the safe daily dosage range?</strong>
                        <br>
                        The provided text for Chapter 43 does not give a specific "safe daily dosage range" for heparin beyond the bolus and maintenance infusion for DVT/PE (80 units/kg bolus; maint: 18 units/kg/h infusion based on aPTT). However, it states that heparin is used for prophylaxis or by IV to treat acute thrombosis. A subcutaneous dose of 5000 units every 6 hours (20,000 units/day) is a common prophylactic or low-dose therapeutic regimen for DVT prevention/treatment. Without the patient's weight, a precise calculation for a high-dose therapeutic range (which is weight-based) isn't possible. For DVT treatment, higher doses are often used. Given it's for thrombophlebitis, a therapeutic dose would be expected, and 20,000 units/day is a plausible therapeutic dose, but it's on the lower end for acute treatment compared to continuous IV infusion based on aPTT. It's generally within a commonly used range for subcutaneous administration.
                        <br><br>
                        <strong>2. What are the various methods for administering heparin?</strong>
                        <br>
                        Heparin can be administered:
                        <ul>
                            <li><strong>Subcutaneously (SC/Subcut):</strong> For prophylaxis or low-dose therapeutic use.</li>
                            <li><strong>Intravenously (IV):</strong> As an IV bolus for rapid effect, or in IV fluid for continuous infusion to treat acute thrombosis.</li>
                        </ul>
                        It is poorly absorbed orally.
                        <br><br>
                        <strong>3. Why was an aPTT test ordered? How would you determine whether the patient is within the desired range? Explain your answer.</strong>
                        <br>
                        An **aPTT (activated partial thromboplastin time) test** was ordered because it is the primary laboratory test used to **monitor heparin therapy**. Heparin prolongs clotting time, and aPTT measures the time it takes blood to clot in the presence of certain clotting factors affected by heparin.
                        <br>
                        To determine if the patient is within the desired therapeutic range, the aPTT value should be **1.5 to 2 times the control value (or baseline)**. The text states "Anticoagulant: aPTT: 30–85 s" as a general therapeutic range, but ideally, it's compared to the patient's own baseline or a laboratory-specific control.
                        <br><br>
                        <strong>4. What is the pharmacologic action of warfarin? Is the warfarin dose within the safe daily dosage range? Explain your answer.</strong>
                        <br>
                        The pharmacologic action of **warfarin** is to **inhibit hepatic synthesis of vitamin K**, thereby affecting the production of clotting factors II (prothrombin), VII, IX, and X, as well as anticoagulant proteins. This prolongs clotting time.
                        <br>
                        Regarding the dose: The Prototype Drug Chart for Warfarin Sodium states for DVT or PE: "A: PO: 2–5 mg/d based on INR; maint: 2–10 mg/d; target INR 2–3". A dose of 5 mg daily is **within the typical initial and maintenance dosage range** for warfarin. The actual "safe" dose is determined by the patient's INR.
                        <br><br>
                        <strong>5. What are the half-life and protein binding for warfarin? If a patient takes a drug that is highly protein bound, would there be a drug interaction? Explain your answer.</strong>
                        <br>
                        * <strong>Half-life:</strong> Warfarin has a long half-life of **20 to 60 hours**.
                        * <strong>Protein binding:</strong> Warfarin is **highly protein bound at 97%**.
                        <br>
                        **Yes, if a patient takes another drug that is also highly protein bound, there would likely be a significant drug interaction.** Because warfarin is highly protein bound, other highly protein-bound drugs can **displace warfarin from its protein-binding sites**. This increases the amount of "free" (unbound) warfarin circulating in the bloodstream. Free drug is pharmacologically active. An increased level of free warfarin intensifies its anticoagulant effect, leading to a **higher risk of bleeding and hemorrhage**. The nurse would need to closely monitor the patient's INR and assess for signs of bleeding.
                        <br><br>
                        <strong>6. Why was an INR ordered for the patient? What is the desired range?</strong>
                        <br>
                        An **INR (international normalized ratio)** was ordered for the patient because it is the **most frequently used laboratory test to monitor oral warfarin therapy**. It standardizes PT results across different laboratories, accounting for variability in reagents.
                        <br>
                        The **desired therapeutic range for INR** for patients on warfarin therapy is typically **2 to 3**. For patients with mechanical heart valves or recurrent systemic embolism, the desired range may be 2.5 to 3.5, or even up to 4.5.
                        <br><br>
                        <strong>7. What serious adverse reactions could result with prolonged use or large doses of warfarin?</strong>
                        <br>
                        The most serious adverse reaction with prolonged use or large doses of warfarin is **bleeding (hemorrhage)**. This can manifest as:
                        <ul>
                            <li>External bleeding: Petechiae, ecchymosis, purpura, bleeding gums, epistaxis (nosebleeds).</li>
                            <li>Internal bleeding: Gastrointestinal (GI) bleeding (tarry stools, hematemesis), ocular hemorrhage, hematuria (blood in urine), intracranial bleeding.</li>
                            <li>Other: Purple-toe syndrome, bone fracture, hypotension, chest pain.</li>
                            <li>Life-threatening: Hemorrhage.</li>
                        </ul>
                        <br><br>
                        <strong>8. What patient teaching interventions should the nurse include? List three interventions.</strong>
                        <br>
                        Three crucial patient teaching interventions for a patient taking warfarin are:
                        <ol>
                            <li><strong>Bleeding Precautions:</strong> Instruct the patient to use a soft toothbrush and an electric razor to prevent cuts and bleeding. Advise them to apply firm, direct pressure for at least 5-10 minutes with a clean, dry absorbent material if external bleeding occurs from minor cuts or injuries.</li>
                            <li><strong>Monitoring and Reporting:</strong> Emphasize the importance of having regular PT/INR laboratory tests performed as ordered, as the warfarin dose is adjusted based on these results. Instruct them to immediately report any signs of bleeding (e.g., unusual bruising, petechiae, tarry stools, blood in urine/stools, bleeding gums, nosebleeds, vomiting blood).</li>
                            <li><strong>Dietary Consistency & Drug Interactions:</strong> Advise the patient to maintain a consistent intake of foods rich in vitamin K (e.g., green, leafy vegetables like spinach, kale, broccoli) rather than avoiding them entirely, as large fluctuations can affect INR. Warn against taking over-the-counter (OTC) drugs, especially aspirin or NSAIDs, and certain herbal products (e.g., garlic, ginger, ginkgo) without consulting their healthcare provider, as these can significantly increase bleeding risk. Suggest using acetaminophen for pain relief.</li>
                        </ol>
                        <br><br>
                        <strong>9. Months later, the patient has hematemesis. What nursing action should be taken?</strong>
                        <br>
                        Hematemesis (vomiting blood) is a serious sign of gastrointestinal bleeding and indicates **severe internal hemorrhage**, likely due to the anticoagulant effect of warfarin. The nurse should take the following immediate actions:
                        <ul>
                            <li><strong>Assess Vital Signs:</strong> Immediately assess and continuously monitor vital signs (BP, heart rate, respiratory rate, oxygen saturation) for signs of hypovolemic shock (e.g., hypotension, tachycardia, tachypnea).</li>
                            <li><strong>Notify Healthcare Provider:</strong> Promptly notify the healthcare provider of the hematemesis and the patient's current condition.</li>
                            <li><strong>Anticipate Orders:</strong> Expect orders to:
                                <ul>
                                    <li><strong>Stop Warfarin:</strong> Discontinue warfarin immediately.</li>
                                    <li><strong>STAT Labs:</strong> Order STAT PT/INR, CBC (hemoglobin, hematocrit, platelet count).</li>
                                    <li><strong>Administer Antidote:</strong> Prepare to administer <strong>Vitamin K (phytonadione)</strong> intravenously. For acute bleeding, fresh frozen plasma (FFP) may also be ordered for immediate reversal of anticoagulation.</li>
                                    <li><strong>Fluid Resuscitation:</strong> Initiate IV fluids to manage hypovolemia.</li>
                                    <li><strong>Further Diagnostics:</strong> Prepare for further diagnostic tests (e.g., endoscopy) to locate the source of bleeding.</li>
                                </ul>
                            </li>
                            <li><strong>Safety Measures:</strong> Implement bleeding precautions and ensure patient safety.</li>
                        </ul>`
                    }},
                    { id: 'review-quiz', title: 'Review Questions', type: 'quiz',
                      questions: [
                          { question: "A patient is placed on heparin, and the nurse acknowledges that heparin is effective for preventing clot formation in patients who have which disorder(s)? (Select all that apply.)", options: ["Coronary thrombosis", "Acute myocardial infarction", "Deep vein thrombosis", "Hemorrhagic stroke", "Disseminated intravascular coagulation"], correctAnswer: ["Coronary thrombosis", "Acute myocardial infarction", "Deep vein thrombosis", "Disseminated intravascular coagulation"] },
                          { question: "A patient who received heparin begins to bleed. The nurse anticipates that the health care provider will order which antidote?", options: ["Protamine sulfate", "Phytonadione", "Aminocaproic acid", "Potassium chloride"], correctAnswer: "Protamine sulfate" },
                          { question: "A patient is prescribed enoxaparin. The nurse knows that low-molecular-weight heparin has what kind of half-life?", options: ["A longer half-life than heparin", "A shorter half-life than heparin", "The same half-life as heparin", "A four-times shorter half-life than heparin"], correctAnswer: "A longer half-life than heparin" },
                          { question: "A patient had an orthopedic surgery and is prescribed enoxaparin. What would the nurse teach the patient and/or family members about this low-molecular-weight heparin before discharge?", options: ["Visual demonstration of intramuscular heparin administration is recommended.", "Prothrombin time and international normalized ratio monitoring will be done weekly.", "Avoidance of green leafy vegetables is recommended.", "Watch for bleeding or excessive bruising."], correctAnswer: "Watch for bleeding or excessive bruising." },
                          { question: "A patient is being changed from an injectable anticoagulant to an oral anticoagulant. Which anticoagulant does the nurse realize is administered orally?", options: ["Enoxaparin", "Warfarin", "Bivalirudin", "Dalteparin", "Tenecteplase", "Fondaparinux"], correctAnswer: "Warfarin" },
                          { question: "A patient is taking warfarin 5 mg/day for atrial fibrillation. The patient’s international normalized ratio is 3.8. The nurse would consider the international normalized ratio to be what?", options: ["Within normal range", "Elevated range", "Low range", "Low-average range"], correctAnswer: "Elevated range" },
                          { question: "Cilostazol is being prescribed for a patient with coronary artery disease. The nurse understands that which of the following is the major purpose for antiplatelet drug therapy?", options: ["Dissolve the blood clot", "Decrease tissue necrosis", "Inhibit hepatic synthesis of vitamin K", "Suppress platelet aggregation"], correctAnswer: "Suppress platelet aggregation" }
                      ]
                    },
                ]
            }
        };

        // The pre-assessment quiz data now includes questions for all new modules.
        const preAssessmentQuizData = [
            // Questions for Module: Introduction to Thrombus Formation
            { moduleId: 'intro-thrombus', question: "Which type of drug is known for attacking and dissolving blood clots that have already formed?", options: ["Anticoagulants", "Antiplatelets", "Thrombolytics", "Antithrombotics"], correctAnswer: "Thrombolytics" },
            { moduleId: 'intro-thrombus', question: "What is the primary initiating factor in the formation of an arterial thrombus?", options: ["Slow blood flow", "Fibrin formation", "Platelet aggregation", "Red blood cell clumping"], correctAnswer: "Platelet aggregation" },
            { moduleId: 'intro-thrombus', question: "Which substance is a potent stimulus for platelet aggregation, synthesized by platelets when they adhere to a broken endothelial lining?", options: ["Fibrinogen", "Thrombin", "Thromboxane A2", "Adenosine diphosphate (ADP)"], correctAnswer: "Thromboxane A2" },

            // Questions for Module: Anticoagulants: Heparin, Warfarin & Others
            { moduleId: 'anticoagulants', question: "Which laboratory test is primarily used to monitor heparin therapy?", options: ["Prothrombin Time (PT)", "International Normalized Ratio (INR)", "Activated Partial Thromboplastin Time (aPTT)", "Bleeding Time"], correctAnswer: "Activated Partial Thromboplastin Time (aPTT)" },
            { moduleId: 'anticoagulants', question: "What is the antidote for a warfarin overdose?", options: ["Protamine sulfate", "Vitamin K", "Aminocaproic acid", "Fresh frozen plasma"], correctAnswer: "Vitamin K" },
            { moduleId: 'anticoagulants', question: "A nurse is preparing to administer enoxaparin. Which statement about low-molecular-weight heparins (LMWHs) is correct?", options: ["LMWHs require frequent aPTT monitoring.", "LMWHs have a shorter half-life than unfractionated heparin.", "LMWHs are typically administered orally.", "LMWHs can be administered at home."], correctAnswer: "LMWHs can be administered at home." },
            { moduleId: 'anticoagulants', question: "Which of the following foods should a patient taking warfarin be advised to consume consistently, rather than in large, varying amounts?", options: ["Citrus fruits", "Lean meats", "Green, leafy vegetables", "Dairy products"], correctAnswer: "Green, leafy vegetables" },
            { moduleId: 'anticoagulants', question: "Factor Xa inhibitors like rivaroxaban are advantageous because they:", options: ["Require daily PT/INR monitoring.", "Are administered intravenously only.", "Do not require routine coagulation monitoring.", "Are the antidote for heparin overdose."], correctAnswer: "Do not require routine coagulation monitoring." },

            // Questions for Module: Antiplatelet Drugs
            { moduleId: 'antiplatelet-drugs', question: "What is the primary purpose of antiplatelet drug therapy?", options: ["To dissolve existing blood clots", "To inhibit hepatic synthesis of vitamin K", "To suppress platelet aggregation in arteries", "To increase blood clotting factors"], correctAnswer: "To suppress platelet aggregation in arteries" },
            { moduleId: 'antiplatelet-drugs', question: "How does aspirin exert its antiplatelet effect?", options: ["By blocking ADP receptors", "By inhibiting thrombin directly", "By inhibiting cyclooxygenase (COX)", "By increasing fibrinogen levels"], correctAnswer: "By inhibiting cyclooxygenase (COX)" },
            { moduleId: 'antiplatelet-drugs', question: "Which antiplatelet drug is an ADP antagonist often used after MI or stroke to prevent a second event, and should be discontinued 7 days before surgery?", options: ["Aspirin", "Cilostazol", "Abciximab", "Clopidogrel"], correctAnswer: "Clopidogrel" },
            { moduleId: 'antiplatelet-drugs', question: "Glycoprotein (GP) IIb/IIIa receptor antagonists are primarily used for which condition?", options: ["Deep vein thrombosis (DVT)", "Chronic stable angina", "Acute coronary syndromes and prevention of reocclusion after PTCA", "Hypertension"], correctAnswer: "Acute coronary syndromes and prevention of reocclusion after PTCA" },

            // Questions for Module: Thrombolytics
            { moduleId: 'thrombolytics', question: "Thrombolytic drugs primarily work by converting plasminogen into which enzyme?", options: ["Thrombin", "Fibrinogen", "Plasmin", "Factor Xa"], correctAnswer: "Plasmin" },
            { moduleId: 'thrombolytics', question: "Ideally, within what timeframe should a thrombolytic drug be administered after the onset of symptoms of an acute myocardial infarction (AMI)?", options: ["Within 6-8 hours", "Within 12-24 hours", "Within 3-4 hours", "Within 48 hours"], correctAnswer: "Within 3-4 hours" },
            { moduleId: 'thrombolytics', question: "What is the major complication associated with thrombolytic drug therapy?", options: ["Hypotension", "Bradycardia", "Hemorrhage", "Hyperglycemia"], correctAnswer: "Hemorrhage" },
            { moduleId: 'thrombolytics', question: "Which drug is used as an antidote to stop bleeding caused by thrombolytic therapy?", options: ["Vitamin K", "Protamine sulfate", "Aminocaproic acid", "Naloxone"], correctAnswer: "Aminocaproic acid" },

            // Questions for Chapter Review & NCLEX Questions
            { moduleId: 'chapter-review', question: "A patient is placed on heparin, and the nurse acknowledges that heparin is effective for preventing clot formation in patients who have which disorder(s)? (Select all that apply.)", options: ["Coronary thrombosis", "Acute myocardial infarction", "Deep vein thrombosis", "Hemorrhagic stroke", "Disseminated intravascular coagulation"], correctAnswer: ["Coronary thrombosis", "Acute myocardial infarction", "Deep vein thrombosis", "Disseminated intravascular coagulation"] },
            { moduleId: 'chapter-review', question: "A patient who received heparin begins to bleed. The nurse anticipates that the health care provider will order which antidote?", options: ["Protamine sulfate", "Phytonadione", "Aminocaproic acid", "Potassium chloride"], correctAnswer: "Protamine sulfate" },
            { moduleId: 'chapter-review', question: "A patient is prescribed enoxaparin. The nurse knows that low-molecular-weight heparin has what kind of half-life?", options: ["A longer half-life than heparin", "A shorter half-life than heparin", "The same half-life as heparin", "A four-times shorter half-life than heparin"], correctAnswer: "A longer half-life than heparin" },
            { moduleId: 'chapter-review', question: "A patient had an orthopedic surgery and is prescribed enoxaparin. What would the nurse teach the patient and/or family members about this low-molecular-weight heparin before discharge?", options: ["Visual demonstration of intramuscular heparin administration is recommended.", "Prothrombin time and international normalized ratio monitoring will be done weekly.", "Avoidance of green leafy vegetables is recommended.", "Watch for bleeding or excessive bruising."], correctAnswer: "Watch for bleeding or excessive bruising." },
            { moduleId: 'chapter-review', question: "A patient is being changed from an injectable anticoagulant to an oral anticoagulant. Which anticoagulant does the nurse realize is administered orally?", options: ["Enoxaparin", "Warfarin", "Bivalirudin", "Dalteparin", "Tenecteplase", "Fondaparinux"], correctAnswer: "Warfarin" },
            { moduleId: 'chapter-review', question: "A patient is taking warfarin 5 mg/day for atrial fibrillation. The patient’s international normalized ratio is 3.8. The nurse would consider the international normalized ratio to be what?", options: ["Within normal range", "Elevated range", "Low range", "Low-average range"], correctAnswer: "Elevated range" },
            { moduleId: 'chapter-review', question: "Cilostazol is being prescribed for a patient with coronary artery disease. The nurse understands that which of the following is the major purpose for antiplatelet drug therapy?", options: ["Dissolve the blood clot", "Decrease tissue necrosis", "Inhibit hepatic synthesis of vitamin K", "Suppress platelet aggregation"], correctAnswer: "Suppress platelet aggregation" }
        ];

        // --- Helper Functions ---
        const cn = (...classes) => classes.filter(Boolean).join(' ');


        // --- Child Components ---

        /**
         * Quiz component for interactive multiple-choice questions.
         * Users answer questions and receive immediate feedback.
         */
        const Quiz = ({ questions, onComplete, isPreAssessment = false }) => {
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [selectedOption, setSelectedOption] = useState([]);
            const [feedback, setFeedback] = useState(null);
            const [answers, setAnswers] = useState([]);

            const currentQuestion = questions[currentQuestionIndex];

            const handleOptionSelect = (option) => {
                if (feedback && !isPreAssessment) return;

                if (Array.isArray(currentQuestion.correctAnswer)) {
                    setSelectedOption(prevSelected => {
                        if (prevSelected.includes(option)) {
                            return prevSelected.filter(item => item !== option);
                        } else {
                            return [...prevSelected, option];
                        }
                    });
                } else {
                    setSelectedOption(option);
                }
            };

            const handlePreAssessmentNext = () => {
                if (selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)) return;
                
                const isCorrect = Array.isArray(currentQuestion.correctAnswer)
                    ? currentQuestion.correctAnswer.every(ans => selectedOption.includes(ans)) && selectedOption.length === currentQuestion.correctAnswer.length
                    : selectedOption.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                
                const updatedAnswers = [...answers, { question: currentQuestion, isCorrect }];
                setAnswers(updatedAnswers);

                if (currentQuestionIndex < questions.length - 1) {
                    setCurrentQuestionIndex(currentQuestionIndex + 1);
                    setSelectedOption([]);
                    setFeedback(null);
                } else {
                    onComplete(updatedAnswers);
                }
            };
            
            const handleRegularQuizSubmit = () => {
                if (selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)) return;
                
                const isCorrect = Array.isArray(currentQuestion.correctAnswer)
                    ? currentQuestion.correctAnswer.every(ans => selectedOption.includes(ans)) && selectedOption.length === currentQuestion.correctAnswer.length
                    : selectedOption.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                
                setFeedback(isCorrect ? 'correct' : 'incorrect');
            };

            const handleRegularQuizNext = () => {
                const isCorrect = Array.isArray(currentQuestion.correctAnswer)
                    ? currentQuestion.correctAnswer.every(ans => selectedOption.includes(ans)) && selectedOption.length === currentQuestion.correctAnswer.length
                    : selectedOption.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                const finalAnswers = [...answers, { question: currentQuestion, isCorrect }];
                
                if (currentQuestionIndex < questions.length - 1) {
                    setAnswers(finalAnswers);
                    setCurrentQuestionIndex(currentQuestionIndex + 1);
                    setSelectedOption([]);
                    setFeedback(null);
                } else {
                    const finalScore = finalAnswers.reduce((acc, ans) => acc + (ans.isCorrect ? 1 : 0), 0);
                    onComplete({ score: finalScore, total: questions.length });
                }
            };

            return (
                <div className="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h4 className="font-bold text-lg text-gray-800 mb-2">Quiz: {currentQuestionIndex + 1} of {questions.length}</h4>
                    <p className="font-semibold text-gray-700 mb-3">{currentQuestion.question}</p>
                    <div className="space-y-2">
                        {currentQuestion.options.map((option, index) => {
                            const isSelected = Array.isArray(selectedOption) ? selectedOption.includes(option) : selectedOption === option;
                            const isCorrectOption = Array.isArray(currentQuestion.correctAnswer)
                                ? currentQuestion.correctAnswer.includes(option)
                                : option.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                            let optionClass = 'bg-white hover:bg-gray-100 border-gray-200';

                            if (feedback && !isPreAssessment) {
                                if (isCorrectOption) {
                                    optionClass = 'bg-green-100 border-green-500 text-green-800';
                                } else if (isSelected && !isCorrectOption) {
                                    optionClass = 'bg-red-100 border-red-500 text-red-800';
                                }
                            } else if (isSelected) {
                                optionClass = 'bg-indigo-100 border-indigo-500 text-indigo-800';
                            }

                            return (
                                <div
                                    key={index}
                                    onClick={() => handleOptionSelect(option)}
                                    className={cn('p-3 rounded-lg border-2 cursor-pointer transition-colors', optionClass)}
                                >
                                    <div className="flex items-center">
                                        {feedback && !isPreAssessment && (isCorrectOption || (isSelected && !isCorrectOption)) && (
                                            isCorrectOption ? <span className="text-green-600 mr-2">✓</span> : <span className="text-red-600 mr-2">✗</span>
                                        )}
                                        <span className="flex-1">{option}</span>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    <div className="mt-4 text-center">
                        {isPreAssessment ? (
                             <button
                                 onClick={handlePreAssessmentNext}
                                 disabled={selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)}
                                 className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                            >
                                {currentQuestionIndex < questions.length - 1 ? 'Next Question' : 'Finish Assessment'}
                            </button>
                        ) : (
                            <>
                            {!feedback ? (
                                <button
                                    onClick={handleRegularQuizSubmit}
                                    disabled={selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                >
                                    Submit Answer
                                </button>
                            ) : (
                                <button
                                    onClick={handleRegularQuizNext}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors"
                                >
                                    Next Question
                                </button>
                            )}
                            </>
                        )}
                    </div>
                </div>
            );
        };
        
        /**
         * PreAssessmentQuiz component to handle the initial diagnostic quiz.
         * Displays quiz questions and then results, allowing users to "test out" of modules.
         */
        const PreAssessmentQuiz = ({ onComplete, onExit }) => {
            const [results, setResults] = useState(null);

            const handleQuizComplete = (finalAnswers) => {
                const moduleResults = {};
                finalAnswers.forEach(answer => {
                    const { moduleId } = answer.question;
                    if (!moduleResults[moduleId]) {
                        moduleResults[moduleId] = { correct: 0, total: 0 };
                    }
                    if (answer.isCorrect) {
                        moduleResults[moduleId].correct++;
                    }
                    moduleResults[moduleId].total++;
                });

                const completedModules = [];
                for (const moduleId in moduleResults) {
                    if (moduleResults[moduleId].correct === moduleResults[moduleId].total) {
                        completedModules.push(moduleId);
                    }
                }
                setResults({ completedModules, total: finalAnswers.length, correct: finalAnswers.filter(a => a.isCorrect).length });
                onComplete(completedModules);
            };

            if (results) {
                return (
                    <div className="fixed inset-0 bg-gray-100 flex items-center justify-center z-40 p-4 animate-fade-in">
                        <div className="bg-white rounded-2xl shadow-xl p-8 max-w-2xl w-full text-center">
                            <h2 className="text-3xl font-bold text-gray-800 mb-4">Assessment Complete!</h2>
                            <p className="text-lg text-gray-600 mb-6">
                                You correctly answered {results.correct} out of {results.total} questions.
                            </p>
                            {results.completedModules.length > 0 ? (
                                <>
                                    <p className="text-green-600 font-semibold mb-4">You've tested out of the following modules:</p>
                                    <ul className="list-disc list-inside text-left mb-6 bg-green-50 p-4 rounded-lg">
                                        {results.completedModules.map(id => <li key={id}>{contentData[id].title}</li>)}
                                    </ul>
                                </>
                            ) : (
                                <p className="text-yellow-600 font-semibold mb-6">You haven't tested out of any modules. You can proceed to the main modules for learning.</p>
                            )}
                            <button
                                onClick={onExit}
                                className="px-8 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors"
                            >
                                Return to Dashboard
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="fixed inset-0 bg-gray-100 flex items-center justify-center z-40 p-4">
                    <div className="bg-white rounded-2xl shadow-xl p-8 max-w-2xl w-full">
                        <h2 className="text-2xl font-bold text-center text-gray-800 mb-6">Diagnostic Quiz</h2>
                        <Quiz questions={preAssessmentQuizData} onComplete={handleQuizComplete} isPreAssessment={true} />
                    </div>
                </div>
            );
        };


        /**
         * Dashboard component to display the available learning modules.
         * It allows users to select a module to start learning.
         * Shows progress for each module using a circular progress bar and status.
         */
        const Dashboard = ({ onSelectModule, progress, onResetProgress, onStartPreAssessment }) => {
            let totalCompletedSteps = 0;
            let totalPossibleSteps = 0;
            let totalQuizCorrect = 0;
            let totalQuizQuestions = 0;

            // Calculate overall progress and gather quiz scores
            Object.entries(contentData).forEach(([moduleId, module]) => {
                totalPossibleSteps += module.steps.length;
                const moduleProgress = progress[moduleId] || {};
                
                Object.values(moduleProgress).forEach(stepProgress => {
                    if (stepProgress.completed) {
                        totalCompletedSteps++;
                    }
                    if (stepProgress.score !== undefined) {
                        totalQuizCorrect += stepProgress.score;
                    }
                });

                module.steps.forEach(step => {
                    if (step.type === 'quiz') {
                        totalQuizQuestions += step.questions.length;
                    }
                });
            });


            const overallPercentage = totalPossibleSteps > 0 ? (totalCompletedSteps / totalPossibleSteps) * 100 : 0;

            return (
                <div className="p-4 sm:p-6 md:p-8 min-h-screen w-full flex flex-col">
                    <div className="w-full">
                        <header className="mb-8 text-center">
                            <div className="flex items-center justify-center gap-3 mb-2">
                                {/* Text placeholder for the main application identifier */}
                                <span className="w-10 h-10 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold text-xl shadow-lg">ACT</span>
                                <h1 className="text-3xl sm:text-4xl font-extrabold text-gray-800">Anticoagulants, Antiplatelets, and Thrombolytics Learning Module</h1>
                                <span className="bg-gray-200 text-gray-600 text-xs font-mono px-2.5 py-1 rounded-full">V:1.0</span>
                            </div>
                            <p className="text-lg text-gray-500 max-w-2xl mx-auto">Master the pharmacology of anticoagulants, antiplatelets, and thrombolytics through interactive modules and NCLEX-style assessments.</p>
                        </header>

                        {/* Skip Ahead Button */}
                        <div className="mb-8 text-center">
                            <button
                                onClick={onStartPreAssessment}
                                className="w-full max-w-md mx-auto px-6 py-4 bg-teal-500 text-white font-bold rounded-lg shadow-lg hover:bg-teal-600 transition-all duration-300 transform hover:scale-105"
                            >
                                <div className="text-xl">Skip Ahead: Take Diagnostic Quiz</div>
                                <div className="text-sm font-normal">Test your knowledge and potentially skip modules.</div>
                            </button>
                        </div>

                        {/* Overall Progress Bar & Reset Button */}
                        <div className="mb-8 bg-white rounded-2xl shadow-lg p-6 w-full">
                           <div className="flex justify-between items-center mb-3">
                             <h3 className="text-xl font-bold text-gray-800">Overall Progress</h3>
                             <button 
                                 onClick={onResetProgress}
                                 className="px-4 py-2 text-sm bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 transition-colors flex items-center gap-2"
                             >
                                 <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                     <path fillRule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V4a1 1 0 112 0v1.001A7.002 7.002 0 0112.292 4.293a1 1 0 111.414 1.414A9.002 9.002 0 004 9.899V11a1 1 0 11-2 0V3a1 1 0 011-1z" clipRule="evenodd" />
                                 </svg>
                                 Reset Progress
                             </button>
                           </div>
                            <div className="w-full bg-gray-200 rounded-full h-4">
                                <div
                                    className="bg-indigo-600 h-4 rounded-full transition-all duration-500 ease-out"
                                    style={{ width: `${overallPercentage}%` }}
                                ></div>
                            </div>
                            <div className="flex justify-between items-center">
                                <p className="text-left text-sm text-gray-600 mt-2">
                                    {totalQuizQuestions > 0 && `Quiz Performance: ${totalQuizCorrect} / ${totalQuizQuestions} correct`}
                                </p>
                                <p className="text-right text-sm text-gray-600 mt-2">{Math.round(overallPercentage)}% Completed</p>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 w-full">
                            {/* Iterate over all modules defined in contentData */}
                            {Object.entries(contentData).map(([id, module]) => {
                                const moduleProgress = progress[id] || {};
                                // Calculate completion count for steps within the module.
                                const completedCount = Object.values(moduleProgress).filter(p => p.completed).length;
                                const totalSteps = module.steps.length;
                                const percentage = totalSteps > 0 ? (completedCount / totalSteps) * 100 : 0;

                                let statusText = "Not Started";
                                let statusColor = "text-gray-500";
                                if (completedCount === totalSteps) {
                                    statusText = "Completed";
                                    statusColor = "text-green-600";
                                } else if (completedCount > 0) {
                                    statusText = "In Progress";
                                    statusColor = "text-yellow-600";
                                }

                                // Get quiz score for this module if available
                                const quizStep = module.steps.find(step => step.type === 'quiz');
                                const quizProgress = quizStep ? moduleProgress[quizStep.id] : null;

                                return (
                                    <div
                                        key={id}
                                        onClick={() => onSelectModule(id)}
                                        // Styling for module cards, including hover effects.
                                        className="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 cursor-pointer transition-all duration-300 hover:shadow-xl hover:-translate-y-1 group flex flex-col"
                                    >
                                        <div className="flex justify-between items-start mb-4">
                                            {/* Placeholder for module icon: Displays the first letter of the module title. */}
                                            <div className={cn("p-3 rounded-full bg-gradient-to-br", module.color, "w-10 h-10 flex items-center justify-center text-white text-lg font-bold shadow-md flex-shrink-0")}>
                                                {module.title.split(' ').map(word => word.charAt(0)).join('')}
                                            </div>
                                            {/* Progress Circle */}
                                            <div className="relative w-12 h-12 flex-shrink-0">
                                                <svg className="w-full h-full" viewBox="0 0 36 36">
                                                    {/* Background circle for the progress bar. */}
                                                    <path
                                                        className="text-gray-200"
                                                        d="M18 2.0845
                                                            a 15.9155 15.9155 0 0 1 0 31.831
                                                            a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="currentColor"
                                                        strokeWidth="3"
                                                    />
                                                    {/* Foreground arc representing the completion percentage. */}
                                                    <path
                                                        className="text-indigo-500"
                                                        d="M18 2.0845
                                                            a 15.9155 15.9155 0 0 1 0 31.831
                                                            a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="currentColor"
                                                        strokeWidth="3"
                                                        strokeDasharray={`${percentage}, 100`}
                                                        strokeLinecap="round"
                                                        transform="rotate(-90 18 18)"
                                                    />
                                                </svg>
                                                <span className="absolute inset-0 flex items-center justify-center text-xs font-bold text-gray-600">{Math.round(percentage)}%</span>
                                            </div>
                                        </div>
                                        <h3 className="text-xl font-bold text-gray-800 mb-2">{module.title}</h3>
                                        <p className="text-gray-500 text-sm mb-2 h-10">{module.description}</p>
                                        <div className="mt-auto">
                                            <p className={cn("text-sm font-semibold", statusColor)}>{statusText}</p>
                                            {quizProgress && quizProgress.score !== undefined && (
                                                <p className="text-sm text-gray-600 mt-1">Quiz Score: {quizProgress.score} / {quizStep.questions.length}</p>
                                            )}
                                            <div className="flex items-center justify-end text-sm font-medium text-indigo-600 group-hover:text-indigo-700 mt-2">
                                                Start Learning <span className="ml-1 transition-transform group-hover:translate-x-1">&rarr;</span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };
        
        /**
         * CaseStudy component for a multiple-choice case study challenge.
         * Presents a scenario and a question with multiple options.
         */
        const CaseStudy = ({ caseData, onComplete }) => {
            // State to store the user's selected answer.
            const [selectedAnswer, setSelectedAnswer] = useState(null);

            // Handles the selection of an answer option.
            const handleSelect = (option) => {
                if (selectedAnswer) return; // Prevents changing the answer once selected.
                setSelectedAnswer(option);
                // Case-insensitive comparison needs to check if the 'option' matches any of the correct answers.
                // For the case study, the correct answers are an array in the data.
                const isCorrect = Array.isArray(caseData.correctAnswer)
                    ? caseData.correctAnswer.includes(option)
                    : option.toLowerCase() === caseData.correctAnswer.toLowerCase();
                
                if (isCorrect) {
                    onComplete(); // Marks the step as complete if the correct answer is chosen.
                }
            };

            return (
                <div className="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h4 className="font-bold text-lg text-gray-800 mb-2">Critical Thinking Case Study</h4>
                    {/* Scenario description, using dangerouslySetInnerHTML to render HTML bold tags */}
                    <p className="bg-blue-100 text-blue-800 p-3 rounded-md mb-4 text-sm" dangerouslySetInnerHTML={{ __html: caseData.scenario }}></p>
                    <p className="font-semibold text-gray-700 mb-3" dangerouslySetInnerHTML={{ __html: caseData.question }}></p>
                    <div className="space-y-2">
                        {caseData.options.map(option => {
                            const isSelected = selectedAnswer === option;
                            // Case-insensitive comparison for correct answer highlight
                            const isCorrectOption = Array.isArray(caseData.correctAnswer)
                                ? caseData.correctAnswer.includes(option)
                                : option.toLowerCase() === caseData.correctAnswer.toLowerCase();
                            const showFeedback = selectedAnswer !== null; // Show feedback once any answer is selected 

                            let optionClass = 'bg-white hover:bg-gray-100 border-gray-200'; // Default styling for options.
                            if (showFeedback) {
                                if (isCorrectOption) {
                                    optionClass = 'bg-green-100 border-green-500 text-green-800'; // Correct answer always green when feedback is shown 
                                } else if (isSelected && !isCorrectOption) {
                                    optionClass = 'bg-red-100 border-red-500 text-red-800'; // Incorrect selected answer is red 
                                }
                            } else if (isSelected) {
                                optionClass = 'bg-indigo-100 border-indigo-500 text-indigo-800'; // Highlight selected before submission 
                            } 

                            return (
                                <div
                                    key={option}
                                    onClick={() => handleSelect(option)}
                                    className={cn('p-3 rounded-lg border-2 cursor-pointer transition-colors', optionClass)}
                                >
                                    <div className="flex items-center">
                                        {showFeedback && ( // Display a checkmark or cross icon if feedback is active 
                                            isCorrectOption ? <span className="text-green-600 mr-2">✓</span> : (isSelected && <span className="text-red-600 mr-2">✗</span>)
                                        )}
                                        <span className="flex-1">{option}</span>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    {selectedAnswer && ( // Display the explanation after an answer has been selected.
                        <div className="mt-4 p-3 bg-indigo-50 rounded-lg border-l-4 border-indigo-500">
                            <h5 className="font-bold text-indigo-800">Explanation</h5>
                            <p className="text-sm text-indigo-700" dangerouslySetInnerHTML={{ __html: caseData.explanation }}></p>
                        </div>
                    )}
                </div>
            );
        };
        
        /**
         * VitalsCheck component for an interactive question about vital signs.
         * This component is not used in this module, but kept for completeness if needed in other modules.
         */
        const VitalsCheck = ({ onComplete }) => {
            // State to store the user's selected vital sign.
            const [selectedVital, setSelectedVital] = useState(null);
            const vitals = { "BP": "100/68 mmHg", "HR": "110 bpm", "RR": "24/min", "Temp": "99°F" };
            const mostConcerning = "HR"; // The correct answer.
            const explanation = "A heart rate of 110 bpm (tachycardia) is a significant sign of distress. It indicates the heart is working hard to compensate for poor perfusion, which is common during an acute myocardial infarction.";

            // Handles the selection of a vital sign option.
            const handleSelect = (vital) => {
                if(selectedVital) return; // Prevents changing the selection once made.
                setSelectedVital(vital);
                // Case-insensitive comparison (though keys are already consistent)
                if (vital.toLowerCase() === mostConcerning.toLowerCase()) {
                    onComplete(); // Mark step as complete if correct answer is chosen 
                }
            };

            return (
                <div className="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h4 className="font-bold text-lg text-gray-800 mb-2">Vitals Check</h4>
                    <p className="text-sm text-gray-600 mb-4">A patient presents with chest pain. Based on these vital signs, which one is the MOST concerning indicator of impaired central perfusion?</p>
                    <div className="grid grid-cols-2 sm:grid-cols-4 gap-4">
                        {Object.entries(vitals).map(([key, value]) => {
                            const isSelected = selectedVital === key;
                            // Case-insensitive comparison for correct answer highlight
                            const isCorrect = key.toLowerCase() === mostConcerning.toLowerCase();
                            const showFeedback = selectedVital !== null; // Show feedback once any vital is selected 

                            let optionClass = 'bg-white hover:bg-gray-100 border-gray-200'; // Default styling.
                            if (showFeedback) {
                                if (isCorrect) {
                                    optionClass = 'bg-green-100 border-green-500 text-green-800'; // Correct answer always green when feedback is shown 
                                } else if (isSelected && !isCorrect) {
                                    optionClass = 'bg-red-100 border-red-500 text-red-800'; // Incorrect selected answer is red 
                                }
                            } else if (isSelected) {
                                optionClass = 'bg-indigo-100 border-indigo-500 text-indigo-800'; // Highlight selected before submission 
                            } 
                            return (
                                <div key={key} onClick={() => handleSelect(key)} className={cn('p-4 rounded-lg border-2 cursor-pointer text-center', optionClass)}>
                                    <div className="text-sm font-bold text-gray-500">{key}</div>
                                    <div className="text-xl font-semibold text-gray-800">{value}</div>
                                </div>
                            );
                        })}
                    </div>
                   {selectedVital && ( // Display the rationale after a selection is made.
                        <div className="mt-4 p-3 bg-indigo-50 rounded-lg border-l-4 border-indigo-500">
                            <h5 className="font-bold text-indigo-800">Rationale</h5>
                            <p className="text-sm text-indigo-700" dangerouslySetInnerHTML={{ __html: explanation }}></p>
                        </div>
                    )}
                </div>
            );
        };
        
        /**
         * StaticContentStep component for displaying basic text content.
         * Marks itself as complete immediately on render.
         */
        const StaticContentStep = ({ step, onComplete }) => {
            // For 'text' type steps, mark them as complete immediately upon rendering.
            // The effect should only run once when the component mounts to prevent an infinite loop.
            useEffect(() => {
                onComplete();
            }, []); // Empty dependency array ensures this runs only once.

            // Using dangerouslySetInnerHTML to render HTML content (e.g., <strong> tags).
            return (
                <div className="prose max-w-none text-gray-700 leading-relaxed p-4 bg-gray-50 rounded-lg shadow-inner space-y-4" dangerouslySetInnerHTML={{ __html: step.content }}>
                </div>
            );
        };

        /**
         * CompletionModal component displayed when a module is completed.
         */
        const CompletionModal = ({ isOpen, onClose, onNextModule, hasNextModule }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center transform animate-fade-in">
                        <h3 className="text-2xl font-bold text-indigo-700 mb-4">Module Completed! 🎉</h3>
                        <p className="text-gray-700 mb-6">You've successfully completed all steps in this module. Great job!</p>
                        <div className="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                            <button
                                onClick={onClose}
                                className="px-6 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 transition-colors shadow-sm"
                            >
                                Back to Dashboard
                            </button>
                            {hasNextModule && (
                                <button
                                    onClick={onNextModule}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors"
                                >
                                    Continue to Next Module
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        /**
         * LearningModule component to manage steps within the selected module.
         * Provides navigation between steps and renders the appropriate content for each.
         */
        const LearningModule = ({ module, onBack, progress, onProgressUpdate, onNextModule, hasNextModule }) => {
            const [activeStep, setActiveStep] = useState(0); // Manages the index of the currently active step.
            const [isSidebarOpen, setIsSidebarOpen] = useState(false); // Controls the visibility of the sidebar on mobile.
            const [isCompletionModalOpen, setIsCompletionModalOpen] = useState(false); // State for completion modal 

            // Callback function to update the completion status of a specific step.
            const handleStepComplete = useCallback((stepId, data = {}) => {
                onProgressUpdate(module.id, stepId, { completed: true, ...data });
            }, [onProgressUpdate, module.id]);

            const moduleProgress = progress[module.id] || {};
            
            // Check if all steps in the current module are completed
            const allStepsCompletedInModule = module.steps.every(step =>
                moduleProgress[step.id] && moduleProgress[step.id].completed
            );

            // Navigates to the next step, if available.
            const handleNextStep = () => {
                // If it's the last step and all steps in the module are completed, open the modal 
                if (activeStep === module.steps.length - 1 && allStepsCompletedInModule) {
                    setIsCompletionModalOpen(true);
                } else if (activeStep < module.steps.length - 1) {
                    setActiveStep(activeStep + 1);
                }
            };

            // Navigates to the previous step, if available.
            const handlePrevStep = () => {
                if (activeStep > 0) {
                    setActiveStep(activeStep - 1);
                }
            };
            
            // Ensure module and its steps are defined before accessing properties 
            if (!module || !module.steps) {
                console.error("LearningModule received invalid module prop:", module);
                return <div className="fixed inset-0 flex items-center justify-center bg-gray-100 text-gray-700">Loading module...</div>;
            }

            const currentStep = module.steps[activeStep];
            
            // Renders the appropriate content component based on the current step's type.
            // This function acts as a router for different interactive and static content types.
            const renderStepContent = (step) => {
                if (!step) return <p>Please select a step.</p>;

                const onCompleteForStep = (data) => handleStepComplete(step.id, data);

                switch (step.type) {
                    case 'text':
                        return <StaticContentStep key={step.id} step={step} onComplete={onCompleteForStep} />;
                    case 'interactive_vitals':
                        return <VitalsCheck key={step.id} onComplete={onCompleteForStep} />;
                    case 'case_study':
                        return <CaseStudy key={step.id} caseData={step.case} onComplete={onCompleteForStep} />;
                    case 'quiz':
                        return <Quiz key={step.id} questions={step.questions} onComplete={onCompleteForStep} />;
                    default:
                        // Fallback for unrecognized step types, ensuring robust error handling.
                        return <p key={step.id} className="text-red-600">Error: Content for this step type is not available.</p>;
                }
            };

            const handleModalClose = () => {
                setIsCompletionModalOpen(false);
                onBack(); // Go back to dashboard when modal is closed 
            };

            const handleModalNextModule = () => {
                setIsCompletionModalOpen(false);
                onNextModule(); // Proceed to next module 
            };


            return (
                <div className="fixed inset-0 bg-gray-100 flex flex-col z-20">
                    {/* Header for the learning module, including back button and module title. */}
                    <header className="bg-white shadow-md p-4 flex items-center justify-between z-30 flex-shrink-0">
                        <button onClick={onBack} className="flex items-center gap-2 text-indigo-600 font-semibold hover:text-indigo-800 transition-colors p-2 rounded-lg -ml-2">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clipRule="evenodd" /></svg>
                            <span className="hidden sm:inline">Dashboard</span>
                        </button>
                        <div className="flex items-center gap-3">
                            <h2 className="text-xl font-bold text-gray-800 text-center flex-1 sm:flex-initial truncate px-2">{module.title}</h2>
                        </div>
                        {/* Mobile sidebar toggle button using text/emoji placeholders. */}
                        <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors">
                           <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        </button>
                    </header>
                    {isSidebarOpen && <div onClick={() => setIsSidebarOpen(false)} className="fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden"></div>}
                    <div className="flex flex-1 overflow-hidden">
                        {/* Sidebar for navigation steps within the module. */}
                        <aside className={cn(
                            "bg-white border-r border-gray-200 p-4 w-72 lg:w-80 flex-shrink-0 flex flex-col transition-transform duration-300 ease-in-out md:translate-x-0 absolute md:static h-full z-20",
                            isSidebarOpen ? 'translate-x-0' : '-translate-x-full'
                        )}>
                            <h3 className="text-lg font-semibold mb-4 text-gray-700 px-3">Module Steps</h3>
                            <nav className="space-y-1 overflow-y-auto flex-1 pr-1">
                                {module.steps.map((step, index) => (
                                    <button
                                        key={step.id}
                                        onClick={() => {
                                            setActiveStep(index);
                                            setIsSidebarOpen(false); // Close sidebar on mobile after a step is selected.
                                        }}
                                        className={cn(
                                            'w-full text-left p-3 rounded-lg flex items-center gap-3 transition-colors',
                                            activeStep === index ? 'bg-indigo-100 text-indigo-700 font-semibold' : 'hover:bg-gray-100 text-gray-700'
                                        )}
                                    >
                                        {/* Step completion indicator */}
                                        <div className="w-5 h-5 flex-shrink-0 flex items-center justify-center">
                                            {moduleProgress[step.id]?.completed ? (
                                                <svg className="w-5 h-5 text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" /></svg>
                                            ) : (
                                                <div className={cn("w-3 h-3 rounded-full border-2", activeStep === index ? "border-indigo-500 bg-indigo-500" : "border-gray-400 bg-white")}></div>
                                            )}
                                        </div>
                                        <span className="flex-1 text-sm">{step.title}</span>
                                    </button>
                                ))}
                            </nav>
                        </aside>

                        {/* Main content area for the current step. */}
                        <main className="flex-1 overflow-y-auto p-4 sm:p-6 md:p-8">
                            <div className="max-w-5xl mx-auto">
                                <h3 className="text-2xl font-bold text-gray-800 mb-4">{currentStep.title}</h3>
                                {renderStepContent(currentStep)}

                                {/* Navigation buttons for moving between steps. */}
                                <div className="flex justify-between mt-8">
                                    <button
                                        onClick={handlePrevStep}
                                        disabled={activeStep === 0}
                                        className="px-6 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm"
                                    >
                                        Previous
                                    </button>

                                    <button
                                        onClick={handleNextStep}
                                        disabled={activeStep === module.steps.length - 1 && !allStepsCompletedInModule}
                                        className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md"
                                    >
                                        {activeStep === module.steps.length - 1 ? 'Finish Module' : 'Next'}
                                    </button>
                                </div>
                            </div>
                        </main>
                    </div>
                    <CompletionModal
                        isOpen={isCompletionModalOpen}
                        onClose={handleModalClose}
                        onNextModule={handleModalNextModule}
                        hasNextModule={hasNextModule}
                    />
                </div>
            );
        };
        
        // --- Main App Component ---
        /**
         * The root component of the Anticoagulants, Antiplatelets, and Thrombolytics Learning Module application.
         * Manages overall application state, including module selection, user ID, and progress.
         */
        function App() {
            // State for the currently selected learning module's ID. Null means Dashboard is active.
            const [currentModuleId, setCurrentModuleId] = useState(null);
            const [isPreAssessmentActive, setIsPreAssessmentActive] = useState(false);
            // State for the authenticated user's ID, used for local storage progress tracking.
            const [userId, setUserId] = useState(null);
            // State for storing the user's progress across all modules and steps.
            const [progress, setProgress] = useState({});
            // State to indicate if authentication is complete and user ID is available.
            const [isAuthReady, setIsAuthReady] = useState(false);

            // Effect hook for handling initial authentication and setting the user ID.
            useEffect(() => {
                const unsubscribe = mockAuth.onAuthStateChanged((user) => {
                    if (user) setUserId(user.uid);
                    setIsAuthReady(true); // Mark authentication as ready once user is determined.
                });
                return () => unsubscribe(); // Cleanup the auth state listener on component unmount.
            }, []); // Empty dependency array ensures this runs only once on mount.

            // Effect hook for loading user progress from localStorage after authentication is ready.
            useEffect(() => {
                if (!isAuthReady || !userId) return; // Only proceed if auth is ready and userId is available.
                const storedProgress = localStorage.getItem(`anticoagulants-module-progress-${userId}`); // Updated localStorage key
                if (storedProgress) {
                    try {
                        setProgress(JSON.parse(storedProgress)); // Attempt to parse and set stored progress.
                    } catch (e) {
                        console.error("Failed to parse stored progress, resetting.", e);
                        setProgress({}); // Reset progress if parsing fails (e.g., corrupted data).
                    }
                }
            }, [isAuthReady, userId]); // Reruns when auth status or userId changes.

            // Callback function to update and persist the user's progress for a specific step.
            const handleProgressUpdate = useCallback((moduleId, stepId, data = {}) => {
                if (!isAuthReady || !userId) return;

                setProgress(currentProgress => {
                    const currentStepProgress = currentProgress[moduleId]?.[stepId] || {};
                    const newStepProgress = { ...currentStepProgress, ...data };

                    // If the old and new step data are identical, do not update state.
                    // This prevents the infinite re-render loop.
                    if (JSON.stringify(currentStepProgress) === JSON.stringify(newStepProgress)) {
                        return currentProgress;
                    }

                    // Otherwise, proceed with the update.
                    const newProgress = {
                        ...currentProgress,
                        [moduleId]: {
                            ...(currentProgress[moduleId] || {}),
                            [stepId]: newStepProgress
                        }
                    };

                    localStorage.setItem(`anticoagulants-module-progress-${userId}`, JSON.stringify(newProgress)); // Updated localStorage key
                    return newProgress;
                });
            }, [isAuthReady, userId]);

            const handlePreAssessmentComplete = (completedModuleIds) => {
                const newProgress = { ...progress };
                completedModuleIds.forEach(moduleId => {
                    const module = contentData[moduleId];
                    if (module) {
                        newProgress[moduleId] = {};
                        module.steps.forEach(step => {
                            newProgress[moduleId][step.id] = { completed: true };
                        });
                    }
                });
                setProgress(newProgress);
                localStorage.setItem(`anticoagulants-module-progress-${userId}`, JSON.stringify(newProgress)); // Updated localStorage key
                // The results screen is now part of the PreAssessmentQuiz component.
                // We just need to handle exiting it.
            };
            
            // Callback to reset all progress
            const handleResetProgress = useCallback(() => {
                if (!isAuthReady || !userId) return;
                // Clear from state
                setProgress({});
                // Clear from localStorage
                localStorage.removeItem(`anticoagulants-module-progress-${userId}`); // Updated localStorage key
            }, [isAuthReady, userId]);

            // Function to navigate to the next module in the sequence
            const handleNextModule = useCallback(() => {
                const moduleIds = Object.keys(contentData);
                const currentIndex = moduleIds.indexOf(currentModuleId);
                if (currentIndex !== -1 && currentIndex < moduleIds.length - 1) {
                    setCurrentModuleId(moduleIds[currentIndex + 1]);
                } else {
                    // If it's the last module, go back to the dashboard.
                    setCurrentModuleId(null);
                }
            }, [currentModuleId]);

            // Determine which module is currently selected based on `currentModuleId`.
            const selectedModule = currentModuleId && contentData[currentModuleId]
                                             ? { ...contentData[currentModuleId], id: currentModuleId }
                                             : null;

            const moduleIds = Object.keys(contentData);
            const currentIndex = selectedModule ? moduleIds.indexOf(selectedModule.id) : -1;
            const hasNextModule = currentIndex !== -1 && currentIndex < moduleIds.length - 1;


            return (
                <div className="bg-gray-100 min-h-screen font-sans text-gray-900">
                    {isPreAssessmentActive ? (
                        <PreAssessmentQuiz 
                            onComplete={handlePreAssessmentComplete} 
                            onExit={() => setIsPreAssessmentActive(false)}
                        />
                    ) : selectedModule ? (
                        <LearningModule
                            key={selectedModule.id}
                            module={selectedModule}
                            onBack={() => setCurrentModuleId(null)}
                            progress={progress}
                            onProgressUpdate={handleProgressUpdate}
                            onNextModule={handleNextModule}
                            hasNextModule={hasNextModule}
                        />
                    ) : (
                        <Dashboard 
                            onSelectModule={setCurrentModuleId} 
                            progress={progress} 
                            onResetProgress={handleResetProgress}
                            onStartPreAssessment={() => setIsPreAssessmentActive(true)}
                        />
                    )}
                </div>
            );
        }

        // --- Render the App into the DOM ---
        // Get the DOM element where the React application will be mounted.
        const container = document.getElementById('root');
        // Create a React root, which is the entry point for React 18+ applications.
        const root = ReactDOM.createRoot(container);
        // Render the main App component into the root.
        root.render(<App />);
    </script>
</body>
</html>
