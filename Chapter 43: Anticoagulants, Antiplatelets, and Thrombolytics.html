<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Antihyperlipidemics & Peripheral Blood Flow Learning Module</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CSS configuration to use the Inter font.
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    keyframes: {
                        'fade-in': {
                            '0%': { opacity: '0', transform: 'scale(0.95)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                    },
                    animation: {
                        'fade-in': 'fade-in 0.3s ease-out forwards',
                    },
                },
            },
        };
    </script>

    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="font-sans antialiased text-gray-900 bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        // --- React and Library Setup ---
        // Destructure necessary hooks from the global React object.
        const { useState, useEffect, useCallback, useMemo } = React;

        // --- Mock Authentication Setup for Standalone Demo ---
        // This mock object simulates basic user authentication to allow progress tracking via localStorage.
        // In a real application, this would be replaced with actual Firebase authentication.
        const mockAuth = {
            onAuthStateChanged: (callback) => {
                // Simulate an asynchronous authentication check, providing a unique user ID.
                setTimeout(() => callback({ uid: 'standalone-cardio-user' }), 100);
                return () => {}; // Returns an empty function as a cleanup/unsubscribe placeholder.
            },
            signInAnonymously: () => Promise.resolve({ user: { uid: 'standalone-cardio-user' } }), // Mock anonymous sign-in.
        };

        // --- Content & Data Structure for the Learning Modules ---
        // The main content is broken down into smaller, focused modules based on concepts.
        const contentData = {
            'lipids-fundamentals': {
                title: 'Lipids & Apolipoproteins',
                color: 'from-blue-500 to-indigo-400',
                description: 'Understand the basics of lipids, lipoproteins, and apolipoproteins, and nonpharmacologic reduction methods.',
                steps: [
                    { id: 'lipoproteins-intro', title: 'Lipoproteins & Apolipoproteins', type: 'text', content: `
                        Lipids—cholesterol, triglycerides, and phospholipids—are bound in the inner shell of protein, a carrier that transports lipids in the bloodstream. When there is an excess of one or more lipids in the blood, the condition is known as hyperlipidemia or hyperlipoproteinemia. The four major categories of lipoprotein are high-density lipoprotein (HDL), low-density lipoprotein (LDL), very-low-density lipoprotein (VLDL), and chylomicrons.
                        <br><br>
                        <strong>HDL</strong>, also known as “friendly” or “good” lipoprotein, is the smallest and densest lipoprotein, meaning that it contains more protein and less fat than the others. The function of HDL is to remove cholesterol from the bloodstream and deliver it to the liver for excretion in bile.
                        <br><br>
                        <strong>LDL</strong>, the “bad” lipoprotein, contains 50% to 60% of cholesterol in the bloodstream. With an elevated LDL, the risk is greater for developing atherosclerotic plaques and heart disease.
                        <br><br>
                        <strong>VLDL</strong> carries mostly triglycerides and less cholesterol. The <strong>chylomicrons</strong> are large particles that transport fatty acids and cholesterol to the liver. They are composed mostly of triglycerides.
                        <br><br>
                        Serum cholesterol and triglyceride measurements are frequently part of a regular physical examination or readmission evaluation and are used as baseline test results. If the levels are high, a 12- to 14-hour fasting lipid profile may be ordered. When cholesterol, triglycerides, and LDL are elevated, the patient is at increased risk for coronary artery disease (CAD).
                        <br><br>
                        <strong>Reference Values for Serum Lipids:</strong>
                        <ul>
                            <li><strong>Cholesterol:</strong> Desirable (mg/dL): 150–200, Low Risk: 200, Moderate Risk: 200–240, High Risk: >240</li>
                            <li><strong>Triglycerides:</strong> Desirable (mg/dL): 40–150 (Values vary with age), High Risk: >190</li>
                            <li><strong>LDL:</strong> Desirable (mg/dL): &lt;100, Low Risk: 100–130, Moderate Risk: 130–159, High Risk: >160</li>
                            <li><strong>HDL:</strong> Desirable (mg/dL): >60, Low Risk: 50–60, Moderate Risk: 35–50, High Risk: &lt;35</li>
                        </ul>
                        <br>
                        <strong>Apolipoproteins</strong> are within the lipoprotein shell and contain apolipoprotein (apo) A-1, B, and E. The major component of apoA-1 is HDL. The major component of apoB is LDL, which exists in two forms, apoB-100 and apoB-48. ApoB-100 has VLDL as well as LDL and is a better indicator of risk for CAD than LDL alone.
                    `},
                    { id: 'nonpharmacologic-methods', title: 'Nonpharmacologic Methods', type: 'text', content: `
                        Before drugs to lower LDL and raise HDL are prescribed, nondrug therapy should be initiated to decrease cholesterol.
                        <ul>
                            <li><strong>Dietary Reduction:</strong> Saturated fats and cholesterol in the diet should be reduced. Total fat intake should be 30% or less of caloric intake, and cholesterol intake should be 300 mg/day or less. Patients should choose lean meats, especially chicken and fish.</li>
                            <li><strong>Exercise:</strong> An important aspect to reduce cholesterol and increase HDL. For the older adult, exercise can be walking and bicycling.</li>
                            <li><strong>Smoking Cessation:</strong> Smoking increases LDL cholesterol and decreases HDL.</li>
                        </ul>
                        In many cases, diet alone will not lower blood lipid levels because 75% to 85% of serum cholesterol is endogenously (internally) derived. Dietary modification alone typically lowers total cholesterol levels by only 10% to 30%. This and the fact that adherence to dietary restrictions is often short-lived explains why many patients do not respond to diet modification alone.
                        <br><br>
                        If nonpharmacologic methods are ineffective and hyperlipidemia remains, antihyperlipidemic drugs are prescribed. Patients must understand that dietary changes and an exercise program are still necessary even after drug therapy begins.
                    `},
                    { id: 'lipids-quiz', title: 'Lipids Fundamentals Quiz', type: 'quiz',
                        questions: [
                            { question: "Which lipoprotein is known as 'good' cholesterol because it removes cholesterol from the bloodstream?", options: ["LDL", "VLDL", "HDL", "Chylomicrons"], correctAnswer: "HDL" },
                            { question: "What is the recommended maximum daily intake of cholesterol for cholesterol reduction?", options: ["100 mg", "200 mg", "300 mg", "400 mg"], correctAnswer: "300 mg" },
                            { question: "A patient's fasting lipid profile shows an LDL of 180 mg/dL and HDL of 30 mg/dL. This indicates:", options: ["Low risk for CAD", "Moderate risk for CAD", "High risk for CAD", "Normal lipid levels"], correctAnswer: "High risk for CAD" }
                        ]
                    }
                ]
            },
            'antihyperlipidemics': {
                title: 'Antihyperlipidemics',
                color: 'from-green-500 to-emerald-400',
                description: 'Learn about various drug classes used to lower blood lipid levels.',
                steps: [
                    { id: 'antihyperlipidemics-intro', title: 'Antihyperlipidemics: Overview', type: 'text', content: `
                        Drugs that lower lipid levels include bile-acid sequestrants, fibrates (fibric acid), nicotinic acid, cholesterol absorption inhibitors, and hepatic 3-hydroxy-3-methylglutaryl-coenzyme A (HMG-CoA) reductase inhibitors, better known as statins. The statin drugs have fewer adverse effects and are well tolerated.
                    `},
                    { id: 'bile-acid-sequestrants', title: 'Bile-Acid Sequestrants', type: 'text', content: `
                        One of the first antihyperlipidemics, <strong>cholestyramine</strong> (A: PO: Initially 4 g qd/bid before meals; mix powder in 60–180 mL of fluid; maint: 4–16 g daily in 2 divided doses; max: 24 g daily), is a bile-acid sequestrant that reduces LDL cholesterol (LDL-C) levels by binding with bile acids in the intestine. It is effective against hyperlipidemia type II. This group may be used as an adjunct to the statins.
                        <br><br>
                        <strong>Colestipol hydrochloride</strong> (A: PO: Initially 2 g tablets qd or bid, may increase at 1- to 2-month intervals; max: 16 g daily) is another resin antihyperlipidemic similar to cholestyramine. Both are effective in lowering cholesterol.
                        <br><br>
                        <strong>Colesevelam</strong> (A: PO: 1.875 g bid; max: 3.75 g/d), another bile acid sequestrant, has fewer side effects (less constipation, flatulence, and cramping) and less effect on the absorption of fat-soluble vitamins than the older agents. It is usually the first-choice bile-acid sequestrant drug.
                        <br><br>
                        <strong>Side Effects and Adverse Reactions (Cholestyramine, Colestipol):</strong> May cause anorexia, nausea, vomiting, diarrhea, constipation, steatorrhea, abdominal pain, eructation, flatulence, osteoporosis, peptic ulcer, and GI bleeding. Protein Binding (PB): UK; t½: UK.
                        <br>
                        <strong>Side Effects (Colesevelam):</strong> May cause headache, dyspepsia, constipation, hypertension, weakness, nausea, influenza, hypoglycemia, and hypertriglyceridemia. PB: UK; t½: UK.
                        <br>
                        <strong>Nursing Consideration:</strong> Constipation can be decreased or alleviated by increasing intake of fluids and foods high in fiber. Early signs of peptic ulcer are nausea and abdominal discomfort, followed later by abdominal pain and distension. To avoid GI discomfort, the drug must be taken with and followed by sufficient fluids.
                    `},
                    { id: 'fibrates', title: 'Fibrates (Fibric Acid Derivatives)', type: 'text', content: `
                        <strong>Gemfibrozil</strong> (A: PO: 600 mg bid 30 min before morning and evening meals; max: 1200 mg daily) is a fibric acid derivative that is more effective for reducing triglyceride and VLDL levels than for reducing LDL. It is used primarily to reduce hyperlipidemia type IV, but it can also be used for type II hyperlipidemia. PB: 95%; t½: 1.5 h.
                        <br><br>
                        This drug is highly protein bound and should not be taken with anticoagulants because they compete for protein sites. The anticoagulant dose should be reduced during antihyperlipidemic therapy, and the international normalized ratio (INR) should be closely monitored.
                        <br><br>
                        <strong>Fenofibrate</strong> (Lipofen capsules: A: PO: 50–150 mg daily with food; max: 150 mg daily) has similar actions and some of the same side effects as gemfibrozil. If taken with warfarin, bleeding might occur. Both fenofibrate and gemfibrozil are highly protein bound (Fenofibrate PB: 99%; t½: 20 h).
                        <br><br>
                        <strong>Side Effects (General for Fibrates):</strong> Dizziness, headache, weakness, nausea, diarrhea, constipation, abdominal pain, cholelithiasis, back pain, and elevated hepatic enzymes.
                    `},
                    { id: 'niacin', title: 'Niacin (Vitamin B3)', type: 'text', content: `
                        <strong>Niacin</strong> (Regular release: A: PO: Initially 250 mg qd after evening meal; may increase q4–7d; max: 6 g qd. Sustained release: A: PO: 1–2 g/d in 2–3 divided doses; max: 2 g/d) reduces VLDL and LDL. Niacin is actually very effective at lowering cholesterol levels, and its effect on the lipid profile is highly desirable. PB: &lt;20%; t½: 20–48 min.
                        <br><br>
                        Because it has numerous side effects and large doses are required, as few as 20% of patients can initially tolerate niacin. However, with proper counseling, careful drug titration, and concomitant use of aspirin, this number can be increased to as much as 60% to 70%. Niacin is only recommended in specific clinical situations such as triglyceride levels over 500 mg/dL or if intolerant to other treatment.
                        <br><br>
                        <strong>Side Effects:</strong> Flushing, hypotension, dizziness, headache, cough, pruritus, nausea, vomiting, diarrhea, hyperglycemia, hyperuricemia, rash, edema, and weakness. Flushing is common but should decrease with continued use; starting with a low dose helps. Large doses can cause vasodilation, dizziness, and faintness (syncope).
                    `},
                    { id: 'cholesterol-absorption-inhibitors', title: 'Cholesterol Absorption Inhibitors', type: 'text', content: `
                        <strong>Ezetimibe</strong> (A: PO: 10 mg daily; max: 10 mg daily) is a cholesterol absorption inhibitor that acts on the cells in the small intestine to inhibit cholesterol absorption. It decreases cholesterol from dietary absorption, reducing serum cholesterol, LDL, triglycerides, and apoB levels. Ezetimibe causes only a small increase in HDL. It must be combined with a statin (e.g., simvastatin) for optimum effect. PB: 90%; t½: 22 h.
                        <br><br>
                        <strong>Side Effects:</strong> Diarrhea, arthralgia, abdominal and back pain, fatigue, infection, pharyngitis, elevated hepatic enzymes, cholelithiasis, and myalgia.
                    `},
                    { id: 'statins', title: 'Statins (HMG-CoA Reductase Inhibitors)', type: 'text', content: `
                        The statin drugs inhibit the enzyme HMG-CoA reductase in cholesterol biosynthesis; thus statins are called HMG-CoA reductase inhibitors. By inhibiting cholesterol synthesis in the liver, this group of antihyperlipidemics decreases the concentration of cholesterol, decreases LDL, and slightly increases HDL cholesterol. Reduction of LDL cholesterol may be seen as early as 2 weeks after initiating therapy. The statin group has been useful in decreasing CAD and reducing mortality rates.
                        <br><br>
                        Numerous statins have been approved: <strong>atorvastatin calcium</strong> (see Prototype Drug Chart: Atorvastatin), <strong>fluvastatin sodium</strong> (Regular release: A: PO: Initially 20–40 mg daily; maint: 20–80 mg daily; max: 80 mg qd. Extended release: A: PO: 20–80 mg daily; max: 80 mg daily; PB: 98%; t½: Immediate release 2.5–2.7 h, extended release 9 h), <strong>lovastatin</strong> (Immediate release: A: PO: Initially 10–20 mg qd with evening meal; max: 80 mg qd. Extended release: A: PO: 20–60 mg qd at bedtime; max: 60 mg qd; PB: 95%; t½: 1.1–1.7 h), <strong>pravastatin sodium</strong> (A: PO: Initially 40 mg daily; maint: 10–80 mg daily; max: 80 mg daily; PB: 50%; t½: 2–3 h), <strong>simvastatin</strong> (A: PO: Initially 10–20 mg qd at hs; maint: 5–40 mg daily in evening; max: 40 mg daily; PB: 95%; t½: 1.9 h), <strong>pitavastatin</strong> (A: PO: Initially 2 mg qd; max: 4 mg qd; PB: 99%; t½: 12 h), and <strong>rosuvastatin</strong> (A: PO: 5–10 mg qd; maint: 5–40 mg/d; max: 40 mg qd; PB: 88%; t½: 20 h).
                        <br>Atorvastatin, lovastatin, rosuvastatin, and simvastatin are more effective at lowering LDL than the other statins. Rosuvastatin and atorvastatin are at the top of the list of most prescribed drugs in the United States.
                        <br><br>
                        The statin drugs can be combined with other drugs: <strong>amlodipine and atorvastatin</strong> (A: PO: Initially 5–10 mg amlodipine and 10–20 mg atorvastatin daily; maint: 10 mg amlodipine and 10–80 mg atorvastatin daily; max: 10 mg amlodipine and 80 mg atorvastatin daily; Older A: PO: 2.5 mg amlodipine and 10–20 mg atorvastatin; max: 10 mg amlodipine and 80 mg atorvastatin. PB: amlodipine 93%, atorvastatin 98%; t½: amlodipine 30–50 h, atorvastatin 14 h. Side effects: headache, fatigue, nasopharyngitis, gynecomastia, dyspepsia, nausea, diarrhea, arthralgia, palpitations, and edema), and <strong>ezetimibe and simvastatin</strong> (A: PO: Initially 10 mg ezetimibe and 10–20 mg simvastatin qd at hs; maint: 10 mg ezetimibe and 40 mg simvastatin daily; max: 10 mg ezetimibe and 40 mg simvastatin daily. PB: ezetimibe 90%, simvastatin 95%; t½: ezetimibe 22 h, simvastatin 1.9 h. Side effects: headache, diarrhea, myalgia, infection, influenza, musculoskeletal pain, and elevated hepatic enzymes).
                        <br><br>
                        <strong>Common Side Effects (General for Statins):</strong> Gastrointestinal (GI) disturbances, headaches, muscle cramps, and fatigue are early complaints. Dose-related increase in liver enzyme levels may occur.
                        <br>
                        <strong>Serious Adverse Reaction:</strong> Rhabdomyolysis (muscle disintegration) is rare but potentially fatal. Patients should report immediately any unexplained muscle aches or weakness, especially if accompanied by fever or malaise. Tendon rupture, hyperglycemia, and diabetes mellitus can also occur.
                        <br>
                        <strong>Monitoring:</strong> Serum liver enzymes (alkaline phosphatase [ALP], alanine aminotransferase [ALT], gamma-glutamyl transferase [GGT]) should be monitored. Baseline liver enzyme studies should be obtained before initiating statin therapy. A slight transient increase may be within normal range but should be rechecked in 1 week. An annual eye examination is needed because cataract formation may result. Statins are contraindicated for patients with acute hepatic disorders.
                        <br>
                        <strong>Important:</strong> If antihyperlipidemic therapy is withdrawn, cholesterol and LDL levels return to pretreatment levels. Antihyperlipidemic therapy is a lifetime commitment. Abruptly stopping a statin drug could cause a threefold rebound effect that may cause death from acute myocardial infarction (AMI).
                    `},
                    { id: 'misc-antilipemics', title: 'Miscellaneous Antilipemics', type: 'text', content: `
                        Additional Antilipemics include:
                        <ul>
                            <li><strong>Icosapent ethyl</strong> (A: PO: 2 g q12h; max: 4 g daily with food. PB: 99%; t½: 89 h). Uses: For hypertriglyceridemia. May cause arthralgia, bleeding, peripheral edema, gout, musculoskeletal pain, constipation, and atrial fibrillation/flutter.</li>
                            <li><strong>Lomitapide</strong> (A: PO: Initially 5 mg daily 2 h after evening meal, may increase to 10 mg in 2 wk; maint: 10–60 mg daily; max: 60 mg daily. PB: 99.8%; t½: 39.7 h). Uses: For hypercholesterolemia. May cause dizziness, fatigue, back pain, influenza, chest pain, elevated hepatic enzymes, dyspepsia, nausea, vomiting, diarrhea, constipation, abdominal pain, GERD, steatosis, weight loss, flatulence, and pharyngitis.</li>
                            <li><strong>Mipomersen</strong> (A: Subcut: 200 mg/wk; max: 200 mg/wk. PB: 90%; t½: 1–2 mo). Uses: For hypercholesterolemia. May cause headache, fatigue, nausea, influenza, injection site reaction/skin discoloration, hematoma, antibody formation, pruritus, erythema, steatosis, elevated hepatic enzymes, and proteinuria.</li>
                            <li><strong>Alirocumab</strong> (A: Subcut: Initially 75 mg q2wk; max: 150 mg q2wk. PB: UK; t½: 17–20 d). Uses: For hypercholesterolemia and hyperlipidemia. May cause myalgia, diarrhea, antibody formation, infection, injection site reaction, nasopharyngitis, chest pain, and influenza.</li>
                            <li><strong>Evolocumab</strong> (A: Subcut: 140 mg q2wk or 420 mg q1mo; max: 420 mg/mo. PB: UK; t½: 11–17 d). Uses: For hypercholesterolemia. May cause dizziness, headache, hyperglycemia, infection, arthralgia, myalgia, diarrhea, nasopharyngitis, hypertension, influenza, sinusitis, cough, back pain, musculoskeletal pain, and injection site reaction.</li>
                            <li><strong>Bempedoic acid</strong> (A: PO: 180 mg/d; max: 180 mg/d. PB: 99%; t½: 10–32 h). Uses: For hypercholesterolemia. May cause back/abdominal pain, muscle cramps, infection, hyperuricemia, leukopenia, and thrombocytosis.</li>
                            <li><strong>Evinacumab</strong> (A: IV: 15 mg/kg over 60 min q4wk; max: 15 mg/kg q4wk. PB: UK; t½: UK). Uses: For hypercholesterolemia. May cause pharyngitis, rhinorrhea, nasal congestion, infusion-related reactions, dizziness, weakness, abdominal pain, nausea, and constipation.</li>
                        </ul>
                    `},
                    { id: 'atorvastatin-prototype', title: 'Prototype Drug: Atorvastatin', type: 'text', content: `
                        <strong>Drug Class:</strong> Antihyperlipidemic: HMG-CoA reductase inhibitor
                        <br><br>
                        <strong>Dosage:</strong> Adult PO: Initially 10–20 mg qd; maint: 10–80 mg qd; max: 80 mg qd
                        <br><br>
                        <strong>Contraindications:</strong> Hepatic disease/encephalopathy, cholestasis, pregnancy, breastfeeding.
                        <br>
                        <strong>Caution:</strong> Alcohol use disorder, diabetes mellitus, seizures, renal impairment, stroke, hypotension, hypothyroidism, electrolyte imbalance, rhabdomyolysis, older adults.
                        <br><br>
                        <strong>Drug-Lab-Food Interactions:</strong>
                        <ul>
                            <li><strong>Drug:</strong> Decreased effect with antacids, phenytoin, and propranolol; may increase digoxin level, oral contraceptive efficacy; increased drug effects with macrolide antibiotics and antifungals.</li>
                            <li><strong>Food:</strong> Grapefruit juice should be avoided as it could cause an increase in drug concentration.</li>
                        </ul>
                        <br>
                        <strong>Pharmacokinetics:</strong>
                        <ul>
                            <li>Absorption: Rapid</li>
                            <li>Protein Binding (PB): 98%</li>
                            <li>Half-life (t½): 14–30 h</li>
                            <li>Excretion: Primarily in feces</li>
                        </ul>
                        <br>
                        <strong>Pharmacodynamics:</strong>
                        <ul>
                            <li>Onset: UK (but effects seen in 3-5 days)</li>
                            <li>Peak: 1–2 h</li>
                            <li>Duration: UK</li>
                            <li>Therapeutic effect of lowering lipids is seen in about 3 to 5 days; however, it takes 2 to 4 weeks to achieve full therapeutic effect. Atorvastatin may be taken without regard to meals.</li>
                        </ul>
                        <br>
                        <strong>Therapeutic Effects/Uses:</strong> To decrease cholesterol levels and serum lipids, especially LDL and triglycerides; for treatment of atherosclerosis, hypercholesterolemia, hyperlipoproteinemia, and hypertriglyceridemia.
                        <br>
                        <strong>Mechanism of Action:</strong> Inhibits HMG-CoA reductase, the enzyme necessary for hepatic production of cholesterol.
                        <br><br>
                        <strong>Side Effects:</strong> Dizziness, insomnia, memory impairment, flushing, nightmares, blurred vision, weakness, myalgia, dyspepsia, nausea, diarrhea, flatulence, abdominal pain, peripheral neuropathy.
                        <br><br>
                        <strong>Adverse Reactions:</strong> Rhabdomyolysis (rare), tendon rupture, hyperglycemia, diabetes mellitus.
                        <br>
                        <strong>Life-threatening:</strong> Hepatic/renal failure, stroke, leukopenia, hemolytic anemia, thrombocytopenia.
                    `},
                    { id: 'lab-tests-cam', title: 'Laboratory Tests & CAM', type: 'text', content: `
                        <strong>Laboratory Tests:</strong>
                        <ul>
                            <li><strong>Homocysteine:</strong> An amino acid, by-product of protein. Reference values: 4 to 17 mmol/L (fasting). High levels have been linked to cardiovascular disease, stroke, and Alzheimer disease. It may also promote blood clotting and damage the inner lining of blood vessels. Three vitamins that can lower serum homocysteine levels are vitamin B6 (pyridoxine), vitamin B12 (cyanocobalamin), and folic acid.</li>
                            <li><strong>High-sensitivity C-reactive protein (hsCRP):</strong> A highly sensitive test for detecting the inflammatory protein that can be associated with cardiovascular and peripheral vascular disease.
                                <ul>
                                    <li>Low risk: &lt;1 mg/L</li>
                                    <li>Moderate risk: 1 to 3 mg/L</li>
                                    <li>High risk: >3 mg/L</li>
                                </ul>
                                This test is frequently ordered along with cholesterol screening. Approximately one-third of persons who have had a heart attack have normal cholesterol levels and normal blood pressure. A positive hsCRP test can indicate that the patient is at high risk for CAD, making it a valuable test for predicting CAD.
                            </li>
                        </ul>
                        <br>
                        <strong>Complementary and Alternative Therapies (CAM) with Statins:</strong>
                        <ul>
                            <li>Black cohosh: May potentiate an increase in liver enzymes.</li>
                            <li>Chinese skullcap: May increase drug levels of rosuvastatin.</li>
                            <li>Cranberry: May increase side effects of simvastatin.</li>
                            <li>Ginkgo biloba: May increase drug levels of statins.</li>
                            <li>Green tea: May increase side effects of statins.</li>
                            <li>St. John’s wort: May decrease effect and drug levels of statins.</li>
                        </ul>
                    `},
                    { id: 'antihyperlipidemics-nursing-process', title: 'Antihyperlipidemics: Nursing Process', type: 'text', content: `
                        <strong>Concept: Perfusion</strong>
                        <br><br>
                        <strong>Recognize Cues (Assessment):</strong>
                        <ul>
                            <li>Assess vital signs and baseline serum chemistry values (cholesterol, triglycerides, aspartate aminotransferase [AST], alanine aminotransferase [ALT], and creatine phosphokinase [CPK]).</li>
                            <li>Obtain a medical history. Statin drugs are contraindicated for patients with liver disorders and in pregnant patients.</li>
                        </ul>
                        <br>
                        <strong>Analyze Cues and Prioritize Hypothesis (Patient Problems):</strong> Hyperglycemia, Vomiting, Ischemia, Nausea, Decreased visual acuity.
                        <br><br>
                        <strong>Generate Solutions (Planning):</strong>
                        <ul>
                            <li>The patient’s cholesterol level will be less than 200 mg/dL in 6 to 8 weeks.</li>
                            <li>The patient will choose foods from a list that are low in fat, cholesterol, and complex sugars.</li>
                        </ul>
                        <br>
                        <strong>Take Action (Nursing Interventions):</strong>
                        <ul>
                            <li>Monitor the patient’s blood lipid levels—cholesterol, triglycerides, low-density lipoprotein (LDL), and high-density lipoprotein (HDL)—every 6 to 8 weeks for the first 6 months after statin therapy, then every 3 to 6 months. For a lipid-level profile, the patient should fast for 12 to 14 hours. The desired values are less than 200 mg/dL for cholesterol; less than 150 mg/dL for triglycerides, although this can vary; less than 100 mg/dL for LDL; and more than 60 mg/dL for HDL. Cholesterol levels higher than 240 mg/dL, LDL levels higher than 160 mg/dL, and HDL levels below 35 mg/dL can lead to severe cardiovascular events or cerebrovascular accident (CVA).</li>
                            <li>Monitor laboratory tests for liver function (ALT, alkaline phosphatase [ALP], and gamma-glutamyl transferase [GGT]). Antihyperlipidemic drugs can cause liver disorders.</li>
                            <li>Observe for signs and symptoms of gastrointestinal (GI) upset. Taking the drug with sufficient water or with meals may alleviate some of the discomfort.</li>
                        </ul>
                        <br>
                        <strong>Patient Teaching:</strong>
                        <ul>
                            <li>Emphasize the need to comply with the drug regimen to lower blood lipids.</li>
                            <li>Inform patients that it may take several weeks before blood lipid levels decline.</li>
                            <li>Explain that laboratory tests for blood lipids—cholesterol, triglycerides, LDL, and HDL—are usually ordered every 3 to 6 months.</li>
                            <li>Advise patients to have serum liver enzymes monitored as indicated by their health care provider. Lovastatin, pravastatin, and simvastatin are contraindicated in acute hepatic disease and pregnancy.</li>
                            <li>Instruct patients to have an annual eye examination and to report changes in visual acuity.</li>
                            <li>Advise patients taking gemfibrozil that the drug may increase their risk for bleeding if they are also taking an oral anticoagulant, so bleeding should be reported. Drug dosage can be changed, or another antihyperlipidemic may be ordered.</li>
                            <li>Instruct patients to take nicotinic acid with meals to decrease GI discomfort.</li>
                            <li>Teach patients to mix cholestyramine/colestipol powder well in water or juice.</li>
                            <li>Advise patients that constipation may occur with cholestyramine and colestipol. Increasing fluid intake and food bulk should help alleviate the problem.</li>
                            <li>Explain to patients that flushing is common with niacin and should decrease with continued use of the drug. Usually the drug is started at a low dose.</li>
                            <li>Advise patients that large doses of niacin can cause vasodilation and produce dizziness and faintness (syncope).</li>
                            <li>Explain to patients that ezetimibe may cause headaches and GI upset. If it continues, notify the health care provider.</li>
                            <li>Explain to patients that serum liver enzyme levels are periodically monitored.</li>
                            <li>Encourage patients to promptly report any unexplained muscle tenderness or weakness that may be caused by rhabdomyolysis.</li>
                            <li>Caution patients not to abruptly stop taking their statin drug because a serious rebound effect might occur that could lead to acute myocardial infarction (AMI) and possible death. Before stopping a statin, the patient should talk to his or her health care provider.</li>
                            <li>Explain to patients that GI discomfort is a common problem with most antihyperlipidemics. Suggest increasing fluid intake when taking the medication.</li>
                            <li>Encourage patients to consume foods that are low in animal fats, cholesterol, and complex sugars. Lovastatin and other antihyperlipidemics are adjuncts to, not substitutes for, a low-fat diet.</li>
                        </ul>
                        <br>
                        <strong>Evaluate Outcomes (Evaluation):</strong>
                        <ul>
                            <li>Evaluate effectiveness of the antihyperlipidemic drug. The patient’s cholesterol level should be within the desired range.</li>
                            <li>Determine that the patient is maintaining a low-fat, low-cholesterol diet.</li>
                        </ul>
                    `},
                    { id: 'antihyperlipidemics-quiz', title: 'Antihyperlipidemics Quiz', type: 'quiz',
                        questions: [
                            { question: "Which drug class inhibits the enzyme HMG-CoA reductase to decrease cholesterol synthesis in the liver?", options: ["Bile-acid sequestrants", "Fibrates", "Statins", "Cholesterol absorption inhibitors"], correctAnswer: "Statins" },
                            { question: "A patient taking gemfibrozil is also prescribed warfarin. What is a critical nursing consideration?", options: ["Increase the warfarin dose.", "Monitor INR closely for increased bleeding risk.", "Administer both drugs with grapefruit juice.", "Expect increased VLDL levels."], correctAnswer: "Monitor INR closely for increased bleeding risk." },
                            { question: "A nurse is teaching a patient about common side effects of niacin. Which of the following should be included?", options: ["Muscle pain and weakness", "Flushing of the skin and hyperglycemia", "Severe constipation and peptic ulcer", "Tachycardia and palpitations"], correctAnswer: "Flushing of the skin and hyperglycemia" },
                            { question: "What serious adverse effect should the nurse monitor for in a patient taking atorvastatin?", options: ["Hypotension", "Diarrhea", "Rhabdomyolysis", "Increased appetite"], correctAnswer: "Rhabdomyolysis" },
                            { question: "A patient is taking cholestyramine. To alleviate a common side effect, the nurse should advise the patient to:", options: ["Take the medication on an empty stomach.", "Increase fluid and fiber intake.", "Limit exercise.", "Avoid all dairy products."], correctAnswer: "Increase fluid and fiber intake." }
                        ]
                    }
                ]
            },
            'peripheral-blood-flow': {
                title: 'Drugs to Improve Peripheral Blood Flow',
                color: 'from-purple-500 to-pink-400',
                description: 'Explore medications used to enhance circulation in peripheral arterial disease.',
                steps: [
                    { id: 'pad-intro', title: 'Peripheral Arterial Disease (PAD)', type: 'text', content: `
                        A common problem in older adults is <strong>peripheral arterial disease (PAD)</strong>, also called peripheral vascular disease (PVD). It is characterized by numbness and coolness of the extremities, claudication (pain and weakness of a limb when walking but no symptoms at rest), and possible leg ulcers. The primary cause is arteriosclerosis and hyperlipidemia, resulting in atherosclerosis, after which the arteries become occluded.
                        <br><br>
                        Peripheral vasodilators increase blood flow to the extremities. They are used in peripheral vascular disorders of venous and arterial vessels. They are more effective for disorders that result from vasospasm (Raynaud disease) than from vessel occlusion or arteriosclerosis (arteriosclerosis obliterans, thromboangiitis obliterans [Buerger disease]). In Raynaud disease, cold exposure or emotional upset can trigger vasospasm of the toes and fingers; these patients have benefited from vasodilators.
                        <br><br>
                        Patients with diabetes mellitus are two to four times more likely to have PAD and are at risk of intermittent claudication.
                        <br><br>
                        Individuals with PAD who are treated with HMG-CoA reductase inhibitors (statins) for dyslipidemia may see an improvement in intermittent claudication symptoms as well as a decrease in serum lipids. Also, patients with PAD who are hypertensive see improvement for both conditions when taking the antihypertensive drug ramipril, an angiotensin-converting enzyme (ACE) inhibitor. The alpha blocker prazosin and the calcium channel blocker nifedipine have been used as peripheral vasodilators. The antiplatelet drugs clopidogrel and aspirin have been used to decrease PAD symptoms. Another antiplatelet drug, cilostazol, has been approved by the US Food and Drug Administration (FDA) for treating intermittent claudication. It decreases arterial thrombi. Ginkgo biloba, taken with an antiplatelet drug, has been used to treat intermittent claudication because of its vasodilating and antioxidant effects, although this product has not been approved by the FDA. Most of the drugs used for treating PAD do not cure the health problem, but they can aid in relieving PAD symptoms.
                    `},
                    { id: 'cilostazol', title: 'Cilostazol', type: 'text', content: `
                        <strong>Cilostazol</strong> (A: PO: 50–100 mg q12h 30 min before or 2 h after morning and evening meals with full glass of water; do not administer with grapefruit juice; max: 200 mg qd) is an antiplatelet drug that has a dual purpose of inhibiting platelet aggregation as well as causing vasodilation to treat intermittent claudication. It decreases arterial thrombi.
                        <br><br>
                        <strong>Drug Class:</strong> Direct-acting vasodilator
                        <br>
                        <strong>Contraindications:</strong> Heart failure, hypersensitivity, bleeding disorders.
                        <br>
                        <strong>Caution:</strong> Hepatic and renal disease, tobacco smokers, cardiovascular disease, dysrhythmias, pregnancy, breastfeeding, older adults.
                        <br><br>
                        <strong>Drug-Lab-Food Interactions:</strong>
                        <ul>
                            <li><strong>Drug:</strong> Increased effects with aspirin, cimetidine, clarithromycin, erythromycin, enoxaparin, ticlopidine, warfarin.</li>
                            <li><strong>Food:</strong> Grapefruit and green tea will increase levels; ginger and ginkgo biloba may prolong bleeding time; St. John’s wort will decrease effect. Licorice may cause hypokalemia, which can potentiate drug toxicity.</li>
                        </ul>
                        <br>
                        <strong>Pharmacokinetics:</strong>
                        <ul>
                            <li>Absorption: PO: Readily absorbed from the GI tract.</li>
                            <li>Protein Binding (PB): 95%–98%</li>
                            <li>Half-life (t½): 11–13 h</li>
                            <li>Excretion: In urine (74%), feces (20%)</li>
                        </ul>
                        <br>
                        <strong>Pharmacodynamics:</strong>
                        <ul>
                            <li>Onset: 2–12 wk</li>
                            <li>Peak: UK</li>
                            <li>Duration: UK</li>
                            <li>Mechanism of Action: Acts directly to inhibit platelet aggregation and cause vasodilation, especially in femoral vasculature.</li>
                        </ul>
                        <br>
                        <strong>Side Effects:</strong> Dizziness, headache, nasopharyngitis, rhinitis, cough, dyspepsia, myalgia, flushing, nausea, vomiting, flatulence, diarrhea, melena, back and abdominal pain, peripheral edema, infection, influenza, cholelithiasis.
                        <br><br>
                        <strong>Adverse Reactions:</strong> Tachycardia, palpitations, angina, HF, MI, hypo/hypertension, peptic ulcer, gout, diabetes mellitus, elevated hepatic enzymes.
                        <br>
                        <strong>Life-threatening:</strong> Thrombocytopenia, leukopenia, aplastic anemia, agranulocytosis, dysrhythmias, Stevens-Johnson syndrome.
                    `},
                    { id: 'pentoxifylline', title: 'Pentoxifylline', type: 'text', content: `
                        <strong>Pentoxifylline</strong> (A: PO: 400 mg tid with meals; max: 1200 mg daily), classified as a hemorrheologic agent or blood viscosity reducer agent, improves microcirculation and tissue perfusion by decreasing blood viscosity and improving the flexibility of erythrocytes, thus increasing tissue oxygenation. It inhibits aggregation of platelets and red blood cells. PB: UK; t½: 0.4–0.8 h.
                        <br><br>
                        Approved by the FDA for patients with intermittent claudication, and it has been prescribed for those with Buerger disease resulting from arterial occlusions. However, in one research study, pentoxifylline was not determined to be more effective than a placebo.
                        <br><br>
                        <strong>Side Effects:</strong> Blurred vision, confusion, nausea, vomiting, constipation, cholestasis, tachycardia, edema, and hypotension.
                        <br><br>
                        <strong>Nursing Considerations:</strong>
                        <ul>
                            <li>Reactions to an overdose of pentoxifylline include tachycardia, hypotension, and blurred vision.</li>
                            <li>The drug should be taken with food.</li>
                            <li>The patient should avoid smoking because nicotine increases vasoconstriction.</li>
                            <li>Patients taking an antihypertensive drug along with pentoxifylline may need to have the antihypertensive dosage decreased to avoid side effects.</li>
                        </ul>
                    `},
                    { id: 'cilostazol-nursing-process', title: 'Cilostazol: Nursing Process', type: 'text', content: `
                        <strong>Concept: Perfusion</strong>
                        <br><br>
                        <strong>Recognize Cues (Assessment):</strong>
                        <ul>
                            <li>Obtain baseline vital signs for future comparison.</li>
                            <li>Assess for signs of inadequate blood flow to the extremities: pallor, coldness of extremities, and pain.</li>
                        </ul>
                        <br>
                        <strong>Analyze Cues and Prioritize Hypothesis (Patient Problems):</strong> Hyperglycemia, Hypotension, Ischemia, Discomfort, Decreased visual acuity.
                        <br><br>
                        <strong>Generate Solutions (Planning):</strong>
                        <ul>
                            <li>The patient’s legs will be warm and pink.</li>
                            <li>The patient will report that pain has decreased.</li>
                        </ul>
                        <br>
                        <strong>Take Action (Nursing Interventions):</strong>
                        <ul>
                            <li>Monitor vital signs, especially blood pressure and heart rate. Tachycardia and orthostatic hypotension can be problematic with peripheral vasodilators.</li>
                        </ul>
                        <br>
                        <strong>Patient Teaching:</strong>
                        <ul>
                            <li>Inform patients that a desired therapeutic response may take 1.5 to 3 months.</li>
                            <li>Advise patients not to smoke because smoking increases vasospasm.</li>
                            <li>Instruct patients to use aspirin or aspirin-like compounds only with the health care provider’s approval. Salicylates help prevent platelet aggregation.</li>
                            <li>Encourage patients to change position slowly but frequently to avoid orthostatic hypotension. Orthostatic hypotension is common when taking high doses of a vasodilator.</li>
                            <li>Instruct patients to report side effects of cilostazol, such as flushing, headaches, and dizziness.</li>
                            <li>Suggest that patients with gastrointestinal (GI) disturbances take cilostazol with meals.</li>
                            <li>Advise patients not to ingest alcohol with a vasodilator because it may cause a hypotensive reaction.</li>
                        </ul>
                        <br>
                        <strong>Evaluate Outcomes (Evaluation):</strong>
                        <ul>
                            <li>Evaluate effectiveness of cilostazol therapy; blood flow is increased in extremities, and pain has subsided.</li>
                            <li>The patient should experience no side effects from the prescribed drug.</li>
                        </ul>
                    `},
                    { id: 'critical-thinking-case-study', title: 'Critical Thinking Case Study', type: 'case_study',
                        case: {
                            scenario: `A patient had a myocardial infarction (MI) 3 years ago. He was prescribed gemfibrozil 600 mg twice daily before meals, but his cholesterol remained between 220 and 240 mg/dL, and his LDL was 140 mg/dL. His anticholesterol drug was changed to simvastatin 20 mg/day in the evening.`,
                            question: `Answer the following questions related to this case study. Select all applicable options for questions 1-8.`,
                            options: [
                                "1. Simvastatin is an HMG-CoA reductase inhibitor (statin); Gemfibrozil is a fibric acid derivative effective for triglycerides.",
                                "1. Simvastatin is a fibric acid derivative; Gemfibrozil is a statin.",
                                "1. Gemfibrozil primarily lowers VLDL and triglycerides; Simvastatin primarily lowers LDL.",
                                "2. The patient's LDL was still too high; Statins are more effective for lowering LDL.",
                                "2. Simvastatin has more severe GI side effects than gemfibrozil.",
                                "3. Hepatic enzyme levels (ALT, AST, ALP)",
                                "3. Blood glucose levels",
                                "4. In 1 to 2 weeks",
                                "4. Every 6 to 8 weeks for the first 6 months, then every 3 to 6 months.",
                                "5. 60 mg/day",
                                "5. 40 mg/day",
                                "6. Rhabdomyolysis",
                                "6. Normal muscle soreness from exercise",
                                "7. Yes, they are often combined for synergistic effects.",
                                "7. No, they should not be taken together due to increased risk of rhabdomyolysis.",
                                "8. He should stop taking it until he returns home to avoid running out.",
                                "8. He should contact his healthcare provider for a refill or guidance, as abrupt cessation can cause a rebound effect."
                            ],
                            correctAnswer: [
                                "1. Simvastatin is an HMG-CoA reductase inhibitor (statin); Gemfibrozil is a fibric acid derivative effective for triglycerides.",
                                "1. Gemfibrozil primarily lowers VLDL and triglycerides; Simvastatin primarily lowers LDL.",
                                "2. The patient's LDL was still too high; Statins are more effective for lowering LDL.",
                                "3. Hepatic enzyme levels (ALT, AST, ALP)",
                                "4. Every 6 to 8 weeks for the first 6 months, then every 3 to 6 months.",
                                "5. 40 mg/day",
                                "6. Rhabdomyolysis",
                                "7. No, they should not be taken together due to increased risk of rhabdomyolysis.",
                                "8. He should contact his healthcare provider for a refill or guidance, as abrupt cessation can cause a rebound effect."
                            ],
                            explanation: `
                                <strong>1. How does simvastatin differ from gemfibrozil?</strong> Simvastatin is an HMG-CoA reductase inhibitor (statin) that primarily lowers LDL cholesterol. Gemfibrozil is a fibric acid derivative that is more effective for reducing triglycerides and VLDL.
                                <br><br>
                                <strong>2. Why do you think the patient’s cholesterol drug, gemfibrozil, was changed to simvastatin?</strong> The patient's cholesterol and LDL levels were still elevated (220-240 mg/dL cholesterol, 140 mg/dL LDL) despite gemfibrozil. Statins are generally more effective at lowering LDL, which is strongly associated with CAD risk.
                                <br><br>
                                <strong>3. While the patient is taking simvastatin, which group of serum levels should be monitored?</strong> Hepatic enzyme levels (ALT, AST, ALP, GGT) should be monitored due to the risk of liver dysfunction with statins.
                                <br><br>
                                <strong>4. How long after taking simvastatin should the patient’s cholesterol and lipoproteins be checked?</strong> Blood lipid levels should be monitored every 6 to 8 weeks for the first 6 months after initiating statin therapy, then every 3 to 6 months.
                                <br><br>
                                <strong>5. What is the maximum dose for simvastatin?</strong> The maximum dose for simvastatin is 40 mg daily in the evening, as listed in Table 44.3.
                                <br><br>
                                <strong>6. The patient complains of muscle pain and muscle weakness. What might this indicate?</strong> This might indicate rhabdomyolysis, a rare but serious adverse reaction associated with statin use, which can be fatal. This should be reported immediately.
                                <br><br>
                                <strong>7. Could the patient receive both gemfibrozil and simvastatin? Explain your answer.</strong> Concomitant use of fibrates (like gemfibrozil) and statins (like simvastatin) is generally discouraged due to an increased risk of severe muscle side effects, including rhabdomyolysis.
                                <br><br>
                                <strong>8. The patient is on vacation and does not have enough simvastatin tablets. What should he do?</strong> He should contact his healthcare provider for a refill or guidance. Abruptly stopping a statin drug can cause a serious threefold rebound effect that may cause death from acute myocardial infarction.
                            `
                        }
                    },
                    { id: 'peripheral-review-quiz', title: 'Peripheral Blood Flow Review Quiz', type: 'quiz',
                        questions: [
                            { question: "1. Which of the following is a primary characteristic of Peripheral Arterial Disease (PAD)?", options: ["Warm, flushed extremities", "Claudication", "Increased sensation in limbs", "Absence of leg ulcers"], correctAnswer: "Claudication" },
                            { question: "2. Cilostazol has a dual purpose. What are its two main actions?", options: ["Decreases blood pressure and increases heart rate", "Inhibits platelet aggregation and causes vasodilation", "Increases blood viscosity and reduces erythrocyte flexibility", "Reduces pain and suppresses cough"], correctAnswer: "Inhibits platelet aggregation and causes vasodilation" },
                            { question: "3. A nurse is teaching a patient about pentoxifylline. Which statement indicates the patient understands the medication?", options: ["'I will take this medication on an empty stomach.'", "'I should continue smoking to improve blood flow.'", "'This medication helps decrease blood viscosity and improves red blood cell flexibility.'", "'I can expect immediate relief from my claudication symptoms.'"], correctAnswer: "This medication helps decrease blood viscosity and improves red blood cell flexibility." },
                            { question: "4. What should a patient avoid when taking cilostazol due to potential increased drug levels?", options: ["Water", "Lean meats", "Grapefruit juice", "Exercise"], correctAnswer: "Grapefruit juice" },
                            { question: "5. A patient with peripheral arterial disease is prescribed cilostazol. Which of the following adverse reactions would be of most concern to the nurse?", options: ["Headache", "Diarrhea", "Tachycardia", "Nausea"], correctAnswer: "Tachycardia" },
                            { question: "6. A patient has a serum cholesterol level of 265 mg/dL, a triglyceride level of 235 mg/dL, and a low-density lipoprotein of 180 mg/dL. What do these serum levels indicate?", options: ["a. Hypolipidemia", "b. Normolipidemia", "c. Hyperlipidemia", "d. Alipidemia"], correctAnswer: "c. Hyperlipidemia" },
                            { question: "7. The nurse knows that a patient’s total cholesterol level should be within which range?", options: ["a. 150 to 200 mg/dL", "b. 200 to 225 mg/dL", "c. 225 to 250 mg/dL", "d. Greater than 250 mg/dL"], correctAnswer: "a. 150 to 200 mg/dL" },
                            { question: "8. A patient has a low-density lipoprotein of 175 mg/dL and a high-density lipoprotein of 30 mg/dL. What teaching should the nurse implement for this patient?", options: ["a. Discuss medications ordered, dietary changes, and exercise.", "b. No changes in lifestyle are needed; continue with the current plan.", "c. Discuss how to have fat intake be 40% of caloric intake.", "d. Begin keeping a food diary, and schedule laboratory work to be repeated in 6 months."], correctAnswer: "a. Discuss medications ordered, dietary changes, and exercise." },
                            { question: "9. Which laboratory test value does the nurse realize can contribute to the development of cardiovascular disease and stroke?", options: ["a. Decreased antidiuretic hormone", "b. Increased homocysteine level", "c. Decreased triglycerides", "d. Increased high-density lipoprotein level"], correctAnswer: "b. Increased homocysteine level" },
                            { question: "10. A patient is taking lovastatin. Which serum level is most important for the nurse to monitor?", options: ["a. Blood urea nitrogen", "b. Complete blood count", "c. Cardiac enzymes", "d. Hepatic enzymes"], correctAnswer: "d. Hepatic enzymes" },
                            { question: "11. For what severe skeletal muscle adverse reaction should the nurse observe in a patient taking rosuvastatin?", options: ["a. Myasthenia gravis", "b. Rhabdomyolysis", "c. Dyskinesia", "d. Agranulocytosis"], correctAnswer: "b. Rhabdomyolysis" },
                            { question: "12. A patient is taking ezetimibe and asks the nurse how it works. The nurse should explain that ezetimibe does what?", options: ["a. Inhibits absorption of dietary cholesterol in the intestines", "b. Binds with bile acids in the intestines to reduce low-density lipoprotein levels", "c. Inhibits 3-hydroxy-3-methylglutaryl-coenzyme A reductase, which is necessary for cholesterol production in the liver", "d. Forms insoluble complexes and reduces circulating cholesterol in the blood"], correctAnswer: "a. Inhibits absorption of dietary cholesterol in the intestines" },
                            { question: "13. A patient is diagnosed with peripheral arterial disease. He is prescribed pentoxifylline. What does the nurse realize are the effects of pentoxifylline? (Select all that apply.)", options: ["a. May lead to hypertension and bradycardia", "b. Improves microcirculation and tissue perfusion", "c. Decreases blood viscosity and improves flexibility of erythrocytes", "d. Alleviates intermittent claudication", "e. Commonly causes an adverse effect of rhabdomyolysis", "f. Allows vasodilation of arteries in skeletal muscles"], correctAnswer: ["b. Improves microcirculation and tissue perfusion", "c. Decreases blood viscosity and improves flexibility of erythrocytes", "d. Alleviates intermittent claudication"] }
                        ]
                    }
                ]
            }
        };

        // The pre-assessment quiz data combines relevant questions from all sections
        const preAssessmentQuizData = [
            // Questions for Lipids & Apolipoproteins
            { moduleId: 'lipids-fundamentals', question: "Which lipoprotein is known as 'good' cholesterol because it removes cholesterol from the bloodstream?", options: ["LDL", "VLDL", "HDL", "Chylomicrons"], correctAnswer: "HDL" },
            { moduleId: 'lipids-fundamentals', question: "What is the recommended maximum daily intake of cholesterol for cholesterol reduction?", options: ["100 mg", "200 mg", "300 mg", "400 mg"], correctAnswer: "300 mg" },
            { moduleId: 'lipids-fundamentals', question: "A patient's fasting lipid profile shows an LDL of 180 mg/dL and HDL of 30 mg/dL. This indicates:", options: ["Low risk for CAD", "Moderate risk for CAD", "High risk for CAD", "Normal lipid levels"], correctAnswer: "High risk for CAD" },

            // Questions for Antihyperlipidemics
            { moduleId: 'antihyperlipidemics', question: "Which drug class inhibits the enzyme HMG-CoA reductase to decrease cholesterol synthesis in the liver?", options: ["Bile-acid sequestrants", "Fibrates", "Statins", "Cholesterol absorption inhibitors"], correctAnswer: "Statins" },
            { moduleId: 'antihyperlipidemics', question: "A patient taking gemfibrozil is also prescribed warfarin. What is a critical nursing consideration?", options: ["Increase the warfarin dose.", "Monitor INR closely for increased bleeding risk.", "Administer both drugs with grapefruit juice.", "Expect increased VLDL levels."], correctAnswer: "Monitor INR closely for increased bleeding risk." },
            { moduleId: 'antihyperlipidemics', question: "A nurse is teaching a patient about common side effects of niacin. Which of the following should be included?", options: ["Muscle pain and weakness", "Flushing of the skin and hyperglycemia", "Severe constipation and peptic ulcer", "Tachycardia and palpitations"], correctAnswer: "Flushing of the skin and hyperglycemia" },
            { moduleId: 'antihyperlipidemics', question: "What serious adverse effect should the nurse monitor for in a patient taking atorvastatin?", options: ["Hypotension", "Diarrhea", "Rhabdomyolysis", "Increased appetite"], correctAnswer: "Rhabdomyolysis" },
            { moduleId: 'antihyperlipidemics', question: "A patient is taking cholestyramine. To alleviate a common side effect, the nurse should advise the patient to:", options: ["Take the medication on an empty stomach.", "Increase fluid and fiber intake.", "Limit exercise.", "Avoid all dairy products."], correctAnswer: "Increase fluid and fiber intake." },

            // Questions for Drugs to Improve Peripheral Blood Flow
            { moduleId: 'peripheral-blood-flow', question: "Which of the following is a primary characteristic of Peripheral Arterial Disease (PAD)?", options: ["Warm, flushed extremities", "Claudication", "Increased sensation in limbs", "Absence of leg ulcers"], correctAnswer: "Claudication" },
            { moduleId: 'peripheral-blood-flow', question: "Cilostazol has a dual purpose. What are its two main actions?", options: ["Decreases blood pressure and increases heart rate", "Inhibits platelet aggregation and causes vasodilation", "Increases blood viscosity and reduces erythrocyte flexibility", "Reduces pain and suppresses cough"], correctAnswer: "Inhibits platelet aggregation and causes vasodilation" },
            { moduleId: 'peripheral-blood-flow', question: "A nurse is teaching a patient about pentoxifylline. Which statement indicates the patient understands the medication?", options: ["'I will take this medication on an empty stomach.'", "'I should continue smoking to improve blood flow.'", "'This medication helps decrease blood viscosity and improves red blood cell flexibility.'", "'I can expect immediate relief from my claudication symptoms.'"], correctAnswer: "This medication helps decrease blood viscosity and improves red blood cell flexibility." },
            { moduleId: 'peripheral-blood-flow', question: "What should a patient avoid when taking cilostazol due to potential increased drug levels?", options: ["Water", "Lean meats", "Grapefruit juice", "Exercise"], correctAnswer: "Grapefruit juice" },
            { moduleId: 'peripheral-blood-flow', question: "A patient with peripheral arterial disease is prescribed cilostazol. Which of the following adverse reactions would be of most concern to the nurse?", options: ["Headache", "Diarrhea", "Tachycardia", "Nausea"], correctAnswer: "Tachycardia" }
        ];

        // --- Helper Functions ---
        // Utility for conditionally joining Tailwind CSS classes.
        const cn = (...classes) => classes.filter(Boolean).join(' ');


        // --- Child Components ---

        /**
         * Quiz component for interactive multiple-choice questions.
         * Users answer questions and receive immediate feedback.
         */
        const Quiz = ({ questions, onComplete, isPreAssessment = false }) => {
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [selectedOption, setSelectedOption] = useState([]); // Changed to array for multi-select
            const [feedback, setFeedback] = useState(null);
            const [answers, setAnswers] = useState([]);

            const currentQuestion = questions[currentQuestionIndex];

            // Handle option selection for both single and multiple choice
            const handleOptionSelect = (option) => {
                if (feedback && !isPreAssessment) return; // Prevent changing answer after feedback in regular quiz

                if (Array.isArray(currentQuestion.correctAnswer)) {
                    // Multi-select (SATA)
                    setSelectedOption(prevSelected => {
                        if (prevSelected.includes(option)) {
                            return prevSelected.filter(item => item !== option);
                        } else {
                            return [...prevSelected, option];
                        }
                    });
                } else {
                    // Single select
                    setSelectedOption(option);
                }
            };
            
            const handlePreAssessmentNext = () => {
                if (selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)) return;
                
                // Logic for checking correctness for both single and multi-select
                const isCorrect = Array.isArray(currentQuestion.correctAnswer)
                    ? currentQuestion.correctAnswer.every(ans => selectedOption.includes(ans)) && selectedOption.length === currentQuestion.correctAnswer.length
                    : selectedOption.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                
                const updatedAnswers = [...answers, { question: currentQuestion, isCorrect }];
                setAnswers(updatedAnswers);

                if (currentQuestionIndex < questions.length - 1) {
                    setCurrentQuestionIndex(currentQuestionIndex + 1);
                    setSelectedOption([]); // Reset for next question
                    setFeedback(null);
                } else {
                    onComplete(updatedAnswers);
                }
            };
            
            const handleRegularQuizSubmit = () => {
                if (selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)) return;
                
                const isCorrect = Array.isArray(currentQuestion.correctAnswer)
                    ? currentQuestion.correctAnswer.every(ans => selectedOption.includes(ans)) && selectedOption.length === currentQuestion.correctAnswer.length
                    : selectedOption.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                
                setFeedback(isCorrect ? 'correct' : 'incorrect');
            };

            const handleRegularQuizNext = () => {
                // Ensure the current answer is recorded before moving to the next question
                const isCorrect = Array.isArray(currentQuestion.correctAnswer)
                    ? currentQuestion.correctAnswer.every(ans => selectedOption.includes(ans)) && selectedOption.length === currentQuestion.correctAnswer.length
                    : selectedOption.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                const finalAnswers = [...answers, { question: currentQuestion, isCorrect }];
                
                if (currentQuestionIndex < questions.length - 1) {
                    setAnswers(finalAnswers);
                    setCurrentQuestionIndex(currentQuestionIndex + 1);
                    setSelectedOption([]); // Reset for next question
                    setFeedback(null);
                } else {
                    const finalScore = finalAnswers.reduce((acc, ans) => acc + (ans.isCorrect ? 1 : 0), 0);
                    onComplete({ score: finalScore, total: questions.length });
                }
            };

            return (
                <div className="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h4 className="font-bold text-lg text-gray-800 mb-2">Quiz: {currentQuestionIndex + 1} of {questions.length}</h4>
                    <p className="font-semibold text-gray-700 mb-3">{currentQuestion.question}</p>
                    <div className="space-y-2">
                        {currentQuestion.options.map((option, index) => {
                            const isSelected = Array.isArray(selectedOption) ? selectedOption.includes(option) : selectedOption === option;
                            const isCorrectOption = Array.isArray(currentQuestion.correctAnswer)
                                ? currentQuestion.correctAnswer.includes(option)
                                : option.toLowerCase() === currentQuestion.correctAnswer.toLowerCase();
                            let optionClass = 'bg-white hover:bg-gray-100 border-gray-200';

                            if (feedback && !isPreAssessment) {
                                if (isCorrectOption) {
                                    optionClass = 'bg-green-100 border-green-500 text-green-800';
                                } else if (isSelected && !isCorrectOption) {
                                    optionClass = 'bg-red-100 border-red-500 text-red-800';
                                }
                            } else if (isSelected) {
                                optionClass = 'bg-indigo-100 border-indigo-500 text-indigo-800';
                            }

                            return (
                                <div
                                    key={index}
                                    onClick={() => handleOptionSelect(option)}
                                    className={cn('p-3 rounded-lg border-2 cursor-pointer transition-colors', optionClass)}
                                >
                                    <div className="flex items-center">
                                        {feedback && !isPreAssessment && (isCorrectOption || (isSelected && !isCorrectOption)) && (
                                            isCorrectOption ? <span className="text-green-600 mr-2">✓</span> : <span className="text-red-600 mr-2">✗</span>
                                        )}
                                        <span className="flex-1">{option}</span>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    <div className="mt-4 text-center">
                        {isPreAssessment ? (
                             <button
                                onClick={handlePreAssessmentNext}
                                disabled={selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)}
                                className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                            >
                                {currentQuestionIndex < questions.length - 1 ? 'Next Question' : 'Finish Assessment'}
                            </button>
                        ) : (
                            <>
                            {!feedback ? (
                                <button
                                    onClick={handleRegularQuizSubmit}
                                    disabled={selectedOption === null || (Array.isArray(selectedOption) && selectedOption.length === 0)}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                >
                                    Submit Answer
                                </button>
                            ) : (
                                <button
                                    onClick={handleRegularQuizNext}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors"
                                >
                                    Next Question
                                </button>
                            )}
                            </>
                        )}
                    </div>
                </div>
            );
        };
        
        /**
         * PreAssessmentQuiz component to handle the initial diagnostic quiz.
         * Displays quiz questions and then results, allowing users to "test out" of modules.
         */
        const PreAssessmentQuiz = ({ onComplete, onExit }) => {
            const [results, setResults] = useState(null);

            const handleQuizComplete = (finalAnswers) => {
                const moduleResults = {};
                finalAnswers.forEach(answer => {
                    const { moduleId } = answer.question;
                    if (!moduleResults[moduleId]) {
                        moduleResults[moduleId] = { correct: 0, total: 0 };
                    }
                    if (answer.isCorrect) {
                        moduleResults[moduleId].correct++;
                    }
                    moduleResults[moduleId].total++;
                });

                const completedModules = [];
                for (const moduleId in moduleResults) {
                    // For pre-assessment, a module is "completed" if all its questions in the pre-assessment quiz were answered correctly.
                    if (moduleResults[moduleId].correct === moduleResults[moduleId].total) {
                        completedModules.push(moduleId);
                    }
                }
                setResults({ completedModules, total: finalAnswers.length, correct: finalAnswers.filter(a => a.isCorrect).length });
                onComplete(completedModules);
            };

            if (results) {
                return (
                    <div className="fixed inset-0 bg-gray-100 flex items-center justify-center z-40 p-4 animate-fade-in">
                        <div className="bg-white rounded-2xl shadow-xl p-8 max-w-2xl w-full text-center">
                            <h2 className="text-3xl font-bold text-gray-800 mb-4">Assessment Complete!</h2>
                            <p className="text-lg text-gray-600 mb-6">
                                You correctly answered {results.correct} out of {results.total} questions.
                            </p>
                            {results.completedModules.length > 0 ? (
                                <>
                                    <p className="text-green-600 font-semibold mb-4">You've tested out of the following modules:</p>
                                    <ul className="list-disc list-inside text-left mb-6 bg-green-50 p-4 rounded-lg">
                                        {results.completedModules.map(id => <li key={id}>{contentData[id].title}</li>)}
                                    </ul>
                                </>
                            ) : (
                                <p className="text-yellow-600 font-semibold mb-6">You haven't tested out of any modules. You can proceed to the main modules for learning.</p>
                            )}
                            <button
                                onClick={onExit}
                                className="px-8 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors"
                            >
                                Return to Dashboard
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="fixed inset-0 bg-gray-100 flex items-center justify-center z-40 p-4">
                    <div className="bg-white rounded-2xl shadow-xl p-8 max-w-2xl w-full">
                        <h2 className="text-2xl font-bold text-center text-gray-800 mb-6">Diagnostic Quiz</h2>
                        <Quiz questions={preAssessmentQuizData} onComplete={handleQuizComplete} isPreAssessment={true} />
                    </div>
                </div>
            );
        };


        /**
         * Dashboard component to display the available learning modules.
         * It allows users to select a module to start learning.
         * Shows progress for each module using a circular progress bar and status.
         */
        const Dashboard = ({ onSelectModule, progress, onResetProgress, onStartPreAssessment }) => {
            let totalCompletedSteps = 0;
            let totalPossibleSteps = 0;
            let totalQuizCorrect = 0;
            let totalQuizQuestions = 0;

            // Calculate overall progress and gather quiz scores
            Object.entries(contentData).forEach(([moduleId, module]) => {
                totalPossibleSteps += module.steps.length;
                const moduleProgress = progress[moduleId] || {};
                
                Object.values(moduleProgress).forEach(stepProgress => {
                    if (stepProgress.completed) {
                        totalCompletedSteps++;
                    }
                    if (stepProgress.score !== undefined) {
                        totalQuizCorrect += stepProgress.score;
                    }
                });

                module.steps.forEach(step => {
                    if (step.type === 'quiz') {
                        totalQuizQuestions += step.questions.length;
                    }
                });
            });


            const overallPercentage = totalPossibleSteps > 0 ? (totalCompletedSteps / totalPossibleSteps) * 100 : 0;

            return (
                <div className="p-4 sm:p-6 md:p-8 min-h-screen w-full flex flex-col">
                    <div className="w-full">
                        <header className="mb-8 text-center">
                            <div className="flex items-center justify-center gap-3 mb-2">
                                {/* Text placeholder for the main application identifier */}
                                <span className="w-10 h-10 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold text-xl shadow-lg">ALM</span>
                                <h1 className="text-3xl sm:text-4xl font-extrabold text-gray-800">Antihyperlipidemics & Peripheral Blood Flow Module</h1>
                                <span className="bg-gray-200 text-gray-600 text-xs font-mono px-2.5 py-1 rounded-full">V:1.0</span>
                            </div>
                            <p className="text-lg text-gray-500 max-w-2xl mx-auto">Master the pharmacology of blood lipid management and peripheral circulation through interactive modules and NCLEX-style assessments.</p>
                        </header>

                        {/* Skip Ahead Button */}
                        <div className="mb-8 text-center">
                            <button
                                onClick={onStartPreAssessment}
                                className="w-full max-w-md mx-auto px-6 py-4 bg-teal-500 text-white font-bold rounded-lg shadow-lg hover:bg-teal-600 transition-all duration-300 transform hover:scale-105"
                            >
                                <div className="text-xl">Skip Ahead: Take Diagnostic Quiz</div>
                                <div className="text-sm font-normal">Test your knowledge and potentially skip modules.</div>
                            </button>
                        </div>

                        {/* Overall Progress Bar & Reset Button */}
                        <div className="mb-8 bg-white rounded-2xl shadow-lg p-6 w-full">
                           <div className="flex justify-between items-center mb-3">
                                <h3 className="text-xl font-bold text-gray-800">Overall Progress</h3>
                                <button
                                    onClick={onResetProgress}
                                    className="px-4 py-2 text-sm bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 transition-colors flex items-center gap-2"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                        <path fillRule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 110 2H4a1 1 0 01-1-1V4a1 1 0 112 0v1.001A7.002 7.002 0 0112.292 4.293a1 1 0 111.414 1.414A9.002 9.002 0 004 9.899V11a1 1 0 11-2 0V3a1 1 0 011-1z" clipRule="evenodd" />
                                    </svg>
                                    Reset Progress
                                </button>
                           </div>
                            <div className="w-full bg-gray-200 rounded-full h-4">
                                <div
                                    className="bg-indigo-600 h-4 rounded-full transition-all duration-500 ease-out"
                                    style={{ width: `${overallPercentage}%` }}
                                ></div>
                            </div>
                            <div className="flex justify-between items-center">
                                <p className="text-left text-sm text-gray-600 mt-2">
                                    {totalQuizQuestions > 0 && `Quiz Performance: ${totalQuizCorrect} / ${totalQuizQuestions} correct`}
                                </p>
                                <p className="text-right text-sm text-gray-600 mt-2">{Math.round(overallPercentage)}% Completed</p>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 w-full">
                            {/* Iterate over all modules defined in contentData */}
                            {Object.entries(contentData).map(([id, module]) => {
                                const moduleProgress = progress[id] || {};
                                // Calculate completion count for steps within the module.
                                const completedCount = Object.values(moduleProgress).filter(p => p.completed).length;
                                const totalSteps = module.steps.length;
                                const percentage = totalSteps > 0 ? (completedCount / totalSteps) * 100 : 0;

                                let statusText = "Not Started";
                                let statusColor = "text-gray-500";
                                if (completedCount === totalSteps) {
                                    statusText = "Completed";
                                    statusColor = "text-green-600";
                                } else if (completedCount > 0) {
                                    statusText = "In Progress";
                                    statusColor = "text-yellow-600";
                                }

                                // Get quiz score for this module if available
                                const quizStep = module.steps.find(step => step.type === 'quiz');
                                const quizProgress = quizStep ? moduleProgress[quizStep.id] : null;

                                return (
                                    <div
                                        key={id}
                                        onClick={() => onSelectModule(id)}
                                        // Styling for module cards, including hover effects.
                                        className="bg-white rounded-2xl shadow-lg border border-gray-100 p-6 cursor-pointer transition-all duration-300 hover:shadow-xl hover:-translate-y-1 group flex flex-col"
                                    >
                                        <div className="flex justify-between items-start mb-4">
                                            {/* Placeholder for module icon: Displays the first letter of the module title. */}
                                            <div className={cn("p-3 rounded-full bg-gradient-to-br", module.color, "w-10 h-10 flex items-center justify-center text-white text-lg font-bold shadow-md flex-shrink-0")}>
                                                {module.title.split(' ').map(word => word.charAt(0)).join('')}
                                            </div>
                                            {/* Progress Circle */}
                                            <div className="relative w-12 h-12 flex-shrink-0">
                                                <svg className="w-full h-full" viewBox="0 0 36 36">
                                                    {/* Background circle for the progress bar. */}
                                                    <path
                                                        className="text-gray-200"
                                                        d="M18 2.0845
                                                            a 15.9155 15.9155 0 0 1 0 31.831
                                                            a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="currentColor"
                                                        strokeWidth="3"
                                                    />
                                                    {/* Foreground arc representing the completion percentage. */}
                                                    <path
                                                        className="text-indigo-500"
                                                        d="M18 2.0845
                                                            a 15.9155 15.9155 0 0 1 0 31.831
                                                            a 15.9155 15.9155 0 0 1 0 -31.831"
                                                        fill="none"
                                                        stroke="currentColor"
                                                        strokeWidth="3"
                                                        strokeDasharray={`${percentage}, 100`}
                                                        strokeLinecap="round"
                                                        transform="rotate(-90 18 18)"
                                                    />
                                                </svg>
                                                <span className="absolute inset-0 flex items-center justify-center text-xs font-bold text-gray-600">{Math.round(percentage)}%</span>
                                            </div>
                                        </div>
                                        <h3 className="text-xl font-bold text-gray-800 mb-2">{module.title}</h3>
                                        <p className="text-gray-500 text-sm mb-2 h-10">{module.description}</p>
                                        <div className="mt-auto">
                                            <p className={cn("text-sm font-semibold", statusColor)}>{statusText}</p>
                                            {quizProgress && quizProgress.score !== undefined && (
                                                <p className="text-sm text-gray-600 mt-1">Quiz Score: {quizProgress.score} / {quizStep.questions.length}</p>
                                            )}
                                            <div className="flex items-center justify-end text-sm font-medium text-indigo-600 group-hover:text-indigo-700 mt-2">
                                                Start Learning <span className="ml-1 transition-transform group-hover:translate-x-1">&rarr;</span>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        };
        
        /**
         * CaseStudy component for a multiple-choice case study challenge.
         * Presents a scenario and a question with multiple options.
         */
        const CaseStudy = ({ caseData, onComplete }) => {
            // State to store the user's selected answer.
            const [selectedAnswers, setSelectedAnswers] = useState([]); // Changed to array for multi-select
            const [showFeedback, setShowFeedback] = useState(false);

            // Handles the selection of an answer option.
            const handleSelect = (option) => {
                if (showFeedback) return; // Prevent changing the answer once submitted.

                setSelectedAnswers(prevSelected => {
                    if (prevSelected.includes(option)) {
                        return prevSelected.filter(item => item !== option);
                    } else {
                        return [...prevSelected, option];
                    }
                });
            };

            const handleSubmit = () => {
                setShowFeedback(true);
                // Check if all correct answers are selected AND no incorrect answers are selected
                const isCorrect = caseData.correctAnswer.every(ans => selectedAnswers.includes(ans)) &&
                                  selectedAnswers.length === caseData.correctAnswer.length;
                if (isCorrect) {
                    onComplete(); // Marks the step as complete if the correct answer is chosen.
                }
            };


            return (
                <div className="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h4 className="font-bold text-lg text-gray-800 mb-2">Critical Thinking Case Study</h4>
                    {/* Scenario description, using dangerouslySetInnerHTML to render HTML bold tags */}
                    <p className="bg-blue-100 text-blue-800 p-3 rounded-md mb-4 text-sm" dangerouslySetInnerHTML={{ __html: caseData.scenario }}></p>
                    <p className="font-semibold text-gray-700 mb-3" dangerouslySetInnerHTML={{ __html: caseData.question }}></p>
                    <div className="space-y-2">
                        {caseData.options.map(option => {
                            const isSelected = selectedAnswers.includes(option);
                            // Check if this option is one of the correct answers
                            const isCorrectOption = caseData.correctAnswer.includes(option);
                            
                            let optionClass = 'bg-white hover:bg-gray-100 border-gray-200'; // Default styling for options.
                            if (showFeedback) {
                                if (isCorrectOption) {
                                    optionClass = 'bg-green-100 border-green-500 text-green-800'; // Correct answer always green when feedback is shown
                                } else if (isSelected && !isCorrectOption) {
                                    optionClass = 'bg-red-100 border-red-500 text-red-800'; // Incorrect selected answer is red
                                }
                            } else if (isSelected) {
                                optionClass = 'bg-indigo-100 border-indigo-500 text-indigo-800'; // Highlight selected before submission
                            }

                            return (
                                <div
                                    key={option}
                                    onClick={() => handleSelect(option)}
                                    className={cn('p-3 rounded-lg border-2 cursor-pointer transition-colors', optionClass)}
                                >
                                    <div className="flex items-center">
                                        {showFeedback && ( // Display a checkmark or cross icon if feedback is active
                                            isCorrectOption ? <span className="text-green-600 mr-2">✓</span> : (isSelected && <span className="text-red-600 mr-2">✗</span>)
                                        )}
                                        <span className="flex-1">{option}</span>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    {!showFeedback && (
                        <div className="mt-4 text-center">
                            <button
                                onClick={handleSubmit}
                                disabled={selectedAnswers.length === 0}
                                className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                            >
                                Submit Answer
                            </button>
                        </div>
                    )}
                    {showFeedback && ( // Display the explanation after an answer has been selected.
                        <div className="mt-4 p-3 bg-indigo-50 rounded-lg border-l-4 border-indigo-500">
                            <h5 className="font-bold text-indigo-800">Explanation</h5>
                            <p className="text-sm text-indigo-700" dangerouslySetInnerHTML={{ __html: caseData.explanation }}></p>
                        </div>
                    )}
                </div>
            );
        };
        
        /**
         * VitalsCheck component for an interactive question about vital signs.
         * This component is not used in the Antihyperlipidemics module, but kept for completeness if needed in other modules.
         */
        const VitalsCheck = ({ onComplete }) => {
            // State to store the user's selected vital sign.
            const [selectedVital, setSelectedVital] = useState(null);
            const vitals = { "BP": "100/68 mmHg", "HR": "110 bpm", "RR": "24/min", "Temp": "99°F" };
            const mostConcerning = "HR"; // The correct answer.
            const explanation = "A heart rate of 110 bpm (tachycardia) is a significant sign of distress. It indicates the heart is working hard to compensate for poor perfusion, which is common during an acute myocardial infarction.";

            // Handles the selection of a vital sign option.
            const handleSelect = (vital) => {
                if(selectedVital) return; // Prevents changing the selection once made.
                setSelectedVital(vital);
                // Case-insensitive comparison (though keys are already consistent)
                if (vital.toLowerCase() === mostConcerning.toLowerCase()) {
                    onComplete(); // Mark step as complete if correct answer is chosen
                }
            };

            return (
                <div className="p-4 bg-gray-50 rounded-lg shadow-inner">
                    <h4 className="font-bold text-lg text-gray-800 mb-2">Vitals Check</h4>
                    <p className="text-sm text-gray-600 mb-4">A patient presents with chest pain. Based on these vital signs, which one is the MOST concerning indicator of impaired central perfusion?</p>
                    <div className="grid grid-cols-2 sm:grid-cols-4 gap-4">
                        {Object.entries(vitals).map(([key, value]) => {
                            const isSelected = selectedVital === key;
                            // Case-insensitive comparison for correct answer highlight
                            const isCorrect = key.toLowerCase() === mostConcerning.toLowerCase();
                            const showFeedback = selectedVital !== null; // Show feedback once any vital is selected

                            let optionClass = 'bg-white hover:bg-gray-100 border-gray-200'; // Default styling.
                            if (showFeedback) {
                                if (isCorrect) {
                                    optionClass = 'bg-green-100 border-green-500 text-green-800'; // Correct answer always green when feedback is shown
                                } else if (isSelected && !isCorrect) {
                                    optionClass = 'bg-red-100 border-red-500 text-red-800'; // Incorrect selected answer is red
                                }
                            } else if (isSelected) {
                                optionClass = 'bg-indigo-100 border-indigo-500 text-indigo-800'; // Highlight selected before submission
                            }
                            return (
                                <div key={key} onClick={() => handleSelect(key)} className={cn('p-4 rounded-lg border-2 cursor-pointer text-center', optionClass)}>
                                    <div class="text-sm font-bold text-gray-500">{key}</div>
                                    <div class="text-xl font-semibold text-gray-800">{value}</div>
                                </div>
                            );
                        })}
                    </div>
                   {selectedVital && ( // Display the rationale after a selection is made.
                        <div className="mt-4 p-3 bg-indigo-50 rounded-lg border-l-4 border-indigo-500">
                            <h5 className="font-bold text-indigo-800">Rationale</h5>
                            <p className="text-sm text-indigo-700" dangerouslySetInnerHTML={{ __html: explanation }}></p>
                        </div>
                    )}
                </div>
            );
        };
        
        /**
         * StaticContentStep component for displaying basic text content.
         * Marks itself as complete immediately on render.
         */
        const StaticContentStep = ({ step, onComplete }) => {
            // For 'text' type steps, mark them as complete immediately upon rendering.
            // The effect should only run once when the component mounts to prevent an infinite loop.
            useEffect(() => {
                onComplete();
            }, []); // Empty dependency array ensures this runs only once.

            // Using dangerouslySetInnerHTML to render HTML content (e.g., <strong> tags).
            return (
                <div className="prose max-w-none text-gray-700 leading-relaxed p-4 bg-gray-50 rounded-lg shadow-inner space-y-4" dangerouslySetInnerHTML={{ __html: step.content }}>
                </div>
            );
        };

        /**
         * CompletionModal component displayed when a module is completed.
         */
        const CompletionModal = ({ isOpen, onClose, onNextModule, hasNextModule }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center transform animate-fade-in">
                        <h3 class="text-2xl font-bold text-indigo-700 mb-4">Module Completed! 🎉</h3>
                        <p class="text-gray-700 mb-6">You've successfully completed all steps in this module. Great job!</p>
                        <div class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                            <button
                                onClick={onClose}
                                className="px-6 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 transition-colors shadow-sm"
                            >
                                Back to Dashboard
                            </button>
                            {hasNextModule && (
                                <button
                                    onClick={onNextModule}
                                    className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition-colors"
                                >
                                    Continue to Next Module
                                </button>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        /**
         * LearningModule component to manage steps within the selected module.
         * Provides navigation between steps and renders the appropriate content for each.
         */
        const LearningModule = ({ module, onBack, progress, onProgressUpdate, onNextModule, hasNextModule }) => {
            const [activeStep, setActiveStep] = useState(0); // Manages the index of the currently active step.
            const [isSidebarOpen, setIsSidebarOpen] = useState(false); // Controls the visibility of the sidebar on mobile.
            const [isCompletionModalOpen, setIsCompletionModalOpen] = useState(false); // State for completion modal

            // Callback function to update the completion status of a specific step.
            const handleStepComplete = useCallback((stepId, data = {}) => {
                onProgressUpdate(module.id, stepId, { completed: true, ...data });
            }, [onProgressUpdate, module.id]);

            const moduleProgress = progress[module.id] || {};
            
            // Check if all steps in the current module are completed
            const allStepsCompletedInModule = module.steps.every(step =>
                moduleProgress[step.id] && moduleProgress[step.id].completed
            );

            // Navigates to the next step, if available.
            const handleNextStep = () => {
                // If it's the last step and all steps in the module are completed, open the modal
                if (activeStep === module.steps.length - 1 && allStepsCompletedInModule) {
                    setIsCompletionModalOpen(true);
                } else if (activeStep < module.steps.length - 1) {
                    setActiveStep(activeStep + 1);
                }
            };

            // Navigates to the previous step, if available.
            const handlePrevStep = () => {
                if (activeStep > 0) {
                    setActiveStep(activeStep - 1);
                }
            };
            
            // Ensure module and its steps are defined before accessing properties
            if (!module || !module.steps) {
                console.error("LearningModule received invalid module prop:", module);
                return <div className="fixed inset-0 flex items-center justify-center bg-gray-100 text-gray-700">Loading module...</div>;
            }

            const currentStep = module.steps[activeStep];
            
            // Renders the appropriate content component based on the current step's type.
            // This function acts as a router for different interactive and static content types.
            const renderStepContent = (step) => {
                if (!step) return <p>Please select a step.</p>;

                const onCompleteForStep = (data) => handleStepComplete(step.id, data);

                switch (step.type) {
                    case 'text':
                        return <StaticContentStep key={step.id} step={step} onComplete={onCompleteForStep} />;
                    case 'interactive_vitals':
                        return <VitalsCheck key={step.id} onComplete={onCompleteForStep} />;
                    case 'case_study':
                        return <CaseStudy key={step.id} caseData={step.case} onComplete={onCompleteForStep} />;
                    case 'quiz':
                        return <Quiz key={step.id} questions={step.questions} onComplete={onCompleteForStep} />;
                    default:
                        // Fallback for unrecognized step types, ensuring robust error handling.
                        return <p key={step.id} className="text-red-600">Error: Content for this step type is not available.</p>;
                }
            };

            const handleModalClose = () => {
                setIsCompletionModalOpen(false);
                onBack(); // Go back to dashboard when modal is closed
            };

            const handleModalNextModule = () => {
                setIsCompletionModalOpen(false);
                onNextModule(); // Proceed to next module
            };


            return (
                <div class="fixed inset-0 bg-gray-100 flex flex-col z-20">
                    {/* Header for the learning module, including back button and module title. */}
                    <header class="bg-white shadow-md p-4 flex items-center justify-between z-30 flex-shrink-0">
                        <button onClick={onBack} className="flex items-center gap-2 text-indigo-600 font-semibold hover:text-indigo-800 transition-colors p-2 rounded-lg -ml-2">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clipRule="evenodd" /></svg>
                            <span class="hidden sm:inline">Dashboard</span>
                        </button>
                        <div class="flex items-center gap-3">
                            <h2 class="text-xl font-bold text-gray-800 text-center flex-1 sm:flex-initial truncate px-2">{module.title}</h2>
                        </div>
                        {/* Mobile sidebar toggle button using text/emoji placeholders. */}
                        <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="md:hidden p-2 rounded-lg hover:bg-gray-100 transition-colors">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M4 6h16M4 12h16M4 18h16" /></svg>
                        </button>
                    </header>
                    {isSidebarOpen && <div onClick={() => setIsSidebarOpen(false)} className="fixed inset-0 bg-black bg-opacity-50 z-20 md:hidden"></div>}
                    <div class="flex flex-1 overflow-hidden">
                        {/* Sidebar for navigation steps within the module. */}
                        <aside class={cn(
                            "bg-white border-r border-gray-200 p-4 w-72 lg:w-80 flex-shrink-0 flex flex-col transition-transform duration-300 ease-in-out md:translate-x-0 absolute md:static h-full z-20",
                            isSidebarOpen ? 'translate-x-0' : '-translate-x-full'
                        )}>
                            <h3 class="text-lg font-semibold mb-4 text-gray-700 px-3">Module Steps</h3>
                            <nav class="space-y-1 overflow-y-auto flex-1 pr-1">
                                {module.steps.map((step, index) => (
                                    <button
                                        key={step.id}
                                        onClick={() => {
                                            setActiveStep(index);
                                            setIsSidebarOpen(false); // Close sidebar on mobile after a step is selected.
                                        }}
                                        className={cn(
                                            'w-full text-left p-3 rounded-lg flex items-center gap-3 transition-colors',
                                            activeStep === index ? 'bg-indigo-100 text-indigo-700 font-semibold' : 'hover:bg-gray-100 text-gray-700'
                                        )}
                                    >
                                        {/* Step completion indicator */}
                                        <div class="w-5 h-5 flex-shrink-0 flex items-center justify-center">
                                            {moduleProgress[step.id]?.completed ? (
                                                <svg class="w-5 h-5 text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" /></svg>
                                            ) : (
                                                <div class={cn("w-3 h-3 rounded-full border-2", activeStep === index ? "border-indigo-500 bg-indigo-500" : "border-gray-400 bg-white")}></div>
                                            )}
                                        </div>
                                        <span class="flex-1 text-sm">{step.title}</span>
                                    </button>
                                ))}
                            </nav>
                        </aside>

                        {/* Main content area for the current step. */}
                        <main class="flex-1 overflow-y-auto p-4 sm:p-6 md:p-8">
                            <div class="max-w-5xl mx-auto">
                                <h3 class="text-2xl font-bold text-gray-800 mb-4">{currentStep.title}</h3>
                                {renderStepContent(currentStep)}

                                {/* Navigation buttons for moving between steps. */}
                                <div class="flex justify-between mt-8">
                                    <button
                                        onClick={handlePrevStep}
                                        disabled={activeStep === 0}
                                        className="px-6 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-sm"
                                    >
                                        Previous
                                    </button>

                                    <button
                                        onClick={handleNextStep}
                                        disabled={activeStep === module.steps.length - 1 && !allStepsCompletedInModule}
                                        className="px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md"
                                    >
                                        {activeStep === module.steps.length - 1 ? 'Finish Module' : 'Next'}
                                    </button>
                                </div>
                            </div>
                        </main>
                    </div>
                    <CompletionModal
                        isOpen={isCompletionModalOpen}
                        onClose={handleModalClose}
                        onNextModule={handleModalNextModule}
                        hasNextModule={hasNextModule}
                    />
                </div>
            );
        };
        
        // --- Main App Component ---
        /**
         * The root component of the Antihyperlipidemics & Peripheral Blood Flow Learning Module application.
         * Manages overall application state, including module selection, user ID, and progress.
         */
        function App() {
            // State for the currently selected learning module's ID. Null means Dashboard is active.
            const [currentModuleId, setCurrentModuleId] = useState(null);
            const [isPreAssessmentActive, setIsPreAssessmentActive] = useState(false);
            // State for the authenticated user's ID, used for local storage progress tracking.
            const [userId, setUserId] = useState(null);
            // State for storing the user's progress across all modules and steps.
            const [progress, setProgress] = useState({});
            // State to indicate if authentication is complete and user ID is available.
            const [isAuthReady, setIsAuthReady] = useState(false);

            // Effect hook for handling initial authentication and setting the user ID.
            useEffect(() => {
                const unsubscribe = mockAuth.onAuthStateChanged((user) => {
                    if (user) setUserId(user.uid);
                    setIsAuthReady(true); // Mark authentication as ready once user is determined.
                });
                return () => unsubscribe(); // Cleanup the auth state listener on component unmount.
            }, []); // Empty dependency array ensures this runs only once on mount.

            // Effect hook for loading user progress from localStorage after authentication is ready.
            useEffect(() => {
                if (!isAuthReady || !userId) return; // Only proceed if auth is ready and userId is available.
                const storedProgress = localStorage.getItem(`cardio-module-progress-${userId}`); // Changed key
                if (storedProgress) {
                    try {
                        setProgress(JSON.parse(storedProgress)); // Attempt to parse and set stored progress.
                    } catch (e) {
                        console.error("Failed to parse stored progress, resetting.", e);
                        setProgress({}); // Reset progress if parsing fails (e.g., corrupted data).
                    }
                }
            }, [isAuthReady, userId]); // Reruns when auth status or userId changes.

            // Callback function to update and persist the user's progress for a specific step.
            const handleProgressUpdate = useCallback((moduleId, stepId, data = {}) => {
                if (!isAuthReady || !userId) return;

                setProgress(currentProgress => {
                    const currentStepProgress = currentProgress[moduleId]?.[stepId] || {};
                    const newStepProgress = { ...currentStepProgress, ...data };

                    // If the old and new step data are identical, do not update state.
                    // This prevents the infinite re-render loop.
                    if (JSON.stringify(currentStepProgress) === JSON.stringify(newStepProgress)) {
                        return currentProgress;
                    }

                    // Otherwise, proceed with the update.
                    const newProgress = {
                        ...currentProgress,
                        [moduleId]: {
                            ...(currentProgress[moduleId] || {}),
                            [stepId]: newStepProgress
                        }
                    };

                    localStorage.setItem(`cardio-module-progress-${userId}`, JSON.stringify(newProgress)); // Changed key
                    return newProgress;
                });
            }, [isAuthReady, userId]);

            const handlePreAssessmentComplete = (completedModuleIds) => {
                const newProgress = { ...progress };
                completedModuleIds.forEach(moduleId => {
                    const module = contentData[moduleId];
                    if (module) {
                        newProgress[moduleId] = {};
                        module.steps.forEach(step => {
                            newProgress[moduleId][step.id] = { completed: true };
                        });
                    }
                });
                setProgress(newProgress);
                localStorage.setItem(`cardio-module-progress-${userId}`, JSON.stringify(newProgress)); // Changed key
                // The results screen is now part of the PreAssessmentQuiz component.
                // We just need to handle exiting it.
            };
            
            // Callback to reset all progress
            const handleResetProgress = useCallback(() => {
                if (!isAuthReady || !userId) return;
                // Clear from state
                setProgress({});
                // Clear from localStorage
                localStorage.removeItem(`cardio-module-progress-${userId}`); // Changed key
            }, [isAuthReady, userId]);

            // Function to navigate to the next module in the sequence
            const handleNextModule = useCallback(() => {
                const moduleIds = Object.keys(contentData);
                const currentIndex = moduleIds.indexOf(currentModuleId);
                if (currentIndex !== -1 && currentIndex < moduleIds.length - 1) {
                    setCurrentModuleId(moduleIds[currentIndex + 1]);
                } else {
                    // If it's the last module, go back to the dashboard.
                    setCurrentModuleId(null);
                }
            }, [currentModuleId]);

            // Determine which module is currently selected based on `currentModuleId`.
            const selectedModule = currentModuleId && contentData[currentModuleId]
                                            ? { ...contentData[currentModuleId], id: currentModuleId }
                                            : null;

            const moduleIds = Object.keys(contentData);
            const currentIndex = selectedModule ? moduleIds.indexOf(selectedModule.id) : -1;
            const hasNextModule = currentIndex !== -1 && currentIndex < moduleIds.length - 1;


            return (
                <div class="bg-gray-100 min-h-screen font-sans text-gray-900">
                    {isPreAssessmentActive ? (
                        <PreAssessmentQuiz
                            onComplete={handlePreAssessmentComplete}
                            onExit={() => setIsPreAssessmentActive(false)}
                        />
                    ) : selectedModule ? (
                        <LearningModule
                            key={selectedModule.id}
                            module={selectedModule}
                            onBack={() => setCurrentModuleId(null)}
                            progress={progress}
                            onProgressUpdate={handleProgressUpdate}
                            onNextModule={handleNextModule}
                            hasNextModule={hasNextModule}
                        />
                    ) : (
                        <Dashboard
                            onSelectModule={setCurrentModuleId}
                            progress={progress}
                            onResetProgress={handleResetProgress}
                            onStartPreAssessment={() => setIsPreAssessmentActive(true)}
                        />
                    )}
                </div>
            );
        }

        // --- Render the App into the DOM ---
        // Get the DOM element where the React application will be mounted.
        const container = document.getElementById('root');
        // Create a React root, which is the entry point for React 18+ applications.
        const root = ReactDOM.createRoot(container);
        // Render the main App component into the root.
        root.render(<App />);
    </script>
</body>
</html>
