<!DOCTYPE html>
<html lang="en" class="min-h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VSREP Hub - Empowering Your Journey</title>

    <!-- Favicon Links (Adjusted paths for static hosting like GitHub Pages) -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Tailwind CSS configuration for custom colors, font, and extending default theme
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'vsrep-blue-dark': '#2c7ac2', /* Primary strong blue */
                        'vsrep-blue-medium': '#4292dc', /* Mid blue for gradients/accents */
                        'vsrep-blue-light': '#e0f2ff', /* Very light blue for backgrounds */
                        'vsrep-gray-dark': '#344759', /* Dark text */
                        'vsrep-gray-medium': '#6f7c8d', /* Secondary text */
                        'vsrep-gray-light': '#e0e6ed', /* Subtle borders */
                        'vsrep-bg-start': '#eef2f5', /* Light background gradient start */
                        'vsrep-bg-end': '#f5f8fa', /* Light background gradient end */
                        'vsrep-red': '#f44336', /* Error/Logout Red */
                        'vsrep-green': '#4CAF50', /* Success Green */
                        'vsrep-orange': '#FF9800', /* Calendar/Warning */
                        'fourth-red': '#DC2626', // Tailwind red-600
                        'fourth-blue': '#2563EB', // Tailwind blue-600
                        'fourth-dark': '#344759', // Using vsrep-gray-dark for better contrast on "4th"
                        'firework-gold': '#FFD700',
                        'firework-silver': '#C0C0C0',
                        'firework-purple': '#800080',
                    },
                    boxShadow: {
                        'soft-xl': '0 20px 60px rgba(0,0,0,0.15)', /* More pronounced shadow */
                        'input-focus': '0 0 0 4px rgba(44, 122, 194, 0.25)', /* Softer focus ring */
                        'button-hover-blue': '0 12px 30px rgba(44, 122, 194, 0.35)',
                        'button-hover-gray': '0 12px 30px rgba(111, 124, 141, 0.35)',
                        'button-hover-red': '0 12px 30px rgba(244, 67, 54, 0.35)',
                    },
                    borderRadius: {
                        '3xl': '1.75rem', /* A little less than 2rem, modern */
                        '2xl': '1rem',
                        'xl': '0.75rem',
                        'lg': '0.5rem',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        slideInDown: { /* New keyframe for sliding down from top */
                            '0%': { opacity: '0', transform: 'translateY(-20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        pulseFade: {
                            '0%, 100%': { opacity: '0.8', transform: 'scale(1)' },
                            '50%': { opacity: '1', transform: 'scale(1.05)' },
                        },
                        shimmer: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(100%)' },
                        },
                        bgPan: { /* Background gradient animation */
                            '0%': { backgroundPosition: '0% 50%' },
                            '50%': { backgroundPosition: '100% 50%' },
                            '100%': { backgroundPosition: '0% 50%' },
                        },
                        blobMove1: { /* Blob animation 1 */
                            '0%, 100%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(50px, -30px) scale(1.1)' },
                            '66%': { transform: 'translate(-40px, 20px) scale(0.95)' },
                        },
                        blobMove2: { /* Blob animation 2 */
                            '0%, 100%': { transform: 'translate(0px, 0px) scale(1)' },
                            '40%': { transform: 'translate(-60px, 40px) scale(1.05)' },
                            '75%': { transform: 'translate(30px, -50px) scale(1.15)' },
                        },
                        blobMove3: { /* Blob animation 3 */
                            '0%, 100%': { transform: 'translate(0px, 0px) scale(1)' },
                            '25%': { transform: 'translate(70px, 10px) scale(0.9)' },
                            '60%': { transform: 'translate(-20px, -40px) scale(1.2)' },
                        },
                        'gradient-shift': { /* New: For animated gradient background */
                            '0%, 100%': { backgroundPosition: '0% 50%' },
                            '50%': { backgroundPosition: '100% 50%' },
                        },
                        'icon-bounce': { /* Enhanced icon animation */
                            '0%, 100%': { transform: 'translateY(0) scale(1)' },
                            '25%': { transform: 'translateY(-5px) scale(1.1)' },
                            '50%': { transform: 'translateY(0) scale(1)' },
                            '75%': { transform: 'translateY(-2px) scale(1.05)' },
                        },
                        fireworksPop: { /* For the main 4th of July text/icon */
                            '0%': { opacity: '0', transform: 'scale(0.5)' },
                            '50%': { opacity: '1', transform: 'scale(1.1)' },
                            '100%': { opacity: '1', transform: 'scale(1)' },
                        },
                        sparkleEffect: { /* For individual sparkles */
                            '0%': { opacity: '0', transform: 'scale(0) translateY(0)' },
                            '20%': { opacity: '1', transform: 'scale(1) translateY(-5px)' },
                            '100%': { opacity: '0', transform: 'scale(0) translateY(-20px)' },
                        },
                        firecracker: {
                            '0%, 100%': { transform: 'translateY(0) rotate(0deg)' },
                            '25%': { transform: 'translateY(-10px) rotate(5deg)' },
                            '50%': { transform: 'translateY(0) rotate(-5deg)' },
                            '75%': { transform: 'translateY(-5px) rotate(2deg)' },
                        },
                        // Removed fireworkExplosion and fireworkParticle as they are for CSS-based fireworks
                        fireworkLaunch: { /* For the upward trajectory of a firework */
                            '0%': { transform: 'translateY(0) scale(0.5)', opacity: '0' },
                            '50%': { transform: 'translateY(-100px) scale(1)', opacity: '1' },
                            '100%': { transform: 'translateY(-200px) scale(0.5)', opacity: '0' },
                        }
                    },
                    animation: {
                        fadeIn: 'fadeIn 0.6s ease-out forwards',
                        slideInUp: 'slideInUp 0.7s ease-out forwards',
                        slideInDown: 'slideInDown 0.7s ease-out forwards',
                        pulseFade: 'pulseFade 2s infinite ease-in-out',
                        shimmer: 'shimmer 1.5s infinite linear',
                        bgPan: 'bgPan 15s ease infinite',
                        blob1: 'blobMove1 18s infinite alternate ease-in-out',
                        blob2: 'blobMove2 22s infinite alternate-reverse ease-in-out',
                        blob3: 'blobMove3 20s infinite alternate ease-in-out',
                        'gradient-shift': 'gradient-shift 8s ease infinite',
                        'icon-bounce': 'icon-bounce 2s infinite ease-in-out',
                        fireworksPop: 'fireworksPop 1s ease-out forwards',
                        sparkleEffect: 'sparkleEffect 0.8s ease-out infinite alternate',
                        fireworkTrail: 'fireworkTrail 0.7s ease-out infinite',
                        firecracker: 'firecracker 1.5s infinite ease-in-out',
                        // Removed fireworkExplosion and fireworkParticle as they are for CSS-based fireworks
                        fireworkLaunch: 'fireworkLaunch 1.5s ease-out forwards',
                    }
                }
            }
        }
    </script>
    <style>
        /* Global Reset & Base Styles */
        body {
            @apply font-inter text-vsrep-gray-dark min-h-screen flex flex-col;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            scroll-behavior: smooth;
        }

        /* Animated Background for Login/Auth Area */
        #auth-container {
            background: linear-gradient(135deg, theme('colors.vsrep-bg-start'), theme('colors.vsrep-bg-end'), theme('colors.vsrep-blue-light'));
            background-size: 200% 200%;
            animation: bgPan 15s ease infinite;
        }

        /* Animated Blobs Background */
        .blob {
            position: absolute;
            background-color: theme('colors.vsrep-blue-medium');
            border-radius: 50%;
            filter: blur(120px); /* Increased blur for more softness */
            opacity: 0.4; /* Adjusted opacity for subtle blend */
            will-change: transform; /* Optimize for animation */
            z-index: 0; /* Blobs are behind the card content, but within the auth container */
        }

        .blob-1 {
            width: 300px;
            height: 300px;
            top: 10%;
            left: 15%;
            background-color: theme('colors.vsrep-blue-medium');
            animation: blob1 18s infinite alternate ease-in-out;
        }
        .blob-2 {
            width: 400px;
            height: 400px;
            bottom: 5%;
            right: 10%;
            background-color: theme('colors.vsrep-blue-dark');
            animation: blob2 22s infinite alternate-reverse ease-in-out;
            opacity: 0.3; /* Slightly different opacity for variation */
        }
        .blob-3 {
            width: 250px;
            height: 250px;
            top: 30%;
            right: 20%;
            background-color: theme('colors.vsrep-blue-light');
            animation: blob3 20s infinite alternate ease-in-out;
            opacity: 0.45; /* Slightly different opacity for variation */
        }

        /* Custom Shimmer for Buttons/Cards */
        .button-shimmer::after {
            content: '';
            @apply absolute inset-0 block bg-gradient-to-r from-transparent via-white/50 to-transparent transform -skew-x-12;
            animation: shimmer 1.5s infinite;
        }
        .button-shimmer:hover::after {
            animation: shimmer 1.5s infinite; /* Keep shimmer active on hover */
        }

        /* Ensure main content is hidden/shown by JS - now using `hidden` utility */
        #app-content {
            @apply hidden; /* Default hidden */
        }
        #auth-container.hidden {
            @apply hidden;
        }
        #app-content.visible {
            @apply block;
        }
        /* Styles for password toggle */
        .password-input-group {
            position: relative;
        }
        .password-toggle {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: theme('colors.vsrep-gray-medium');
            transition: color 0.2s ease;
        }
        .password-toggle:hover {
            color: theme('colors.vsrep-blue-dark');
        }

        /* Input validation feedback */
        .input-error {
            @apply border-vsrep-red focus:border-vsrep-red focus:shadow-none;
        }
        .input-success {
            @apply border-vsrep-green focus:border-vsrep-green focus:shadow-none;
        }
        .error-message {
            @apply text-vsrep-red text-sm mt-1 text-left;
        }

        /* Styles for the pharmacology update notification */
        #pharmacology-update-notification {
            background-size: 200% 200%; /* For gradient animation */
            text-shadow: 0 0 8px rgba(0,0,0,0.3); /* Subtle text shadow */
            position: relative; /* For pseudo-elements */
        }

        /* Animated border/glow for the notification */
        #pharmacology-update-notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: theme('borderRadius.3xl'); /* Match parent border radius */
            padding: 2px; /* Thickness of the border */
            background: linear-gradient(45deg, theme('colors.vsrep-blue-light'), theme('colors.vsrep-blue-medium'), theme('colors.vsrep-blue-dark'));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            animation: gradient-shift 4s infinite linear; /* Faster gradient shift for border */
            z-index: -1; /* Behind the content */
        }

        /* Styles for the 4th of July message and fireworks */
        .fireworks-container {
            position: fixed; /* Changed to fixed */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Allow clicks to pass through */
            z-index: 9999; /* Higher z-index to be on top of everything */
            background-color: transparent; /* Ensure it's transparent */
        }

        /* CSS for the Canvas-based fireworks */
        #fireworks-canvas {
            position: absolute; /* Position relative to .fireworks-container */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: transparent; /* Canvas background should be transparent */
        }

        .firecracker-icon {
            animation: firecracker 1.5s infinite ease-in-out;
            transform-origin: bottom center; /* Pivot from the bottom */
        }
    </style>
</head>
<body class="font-inter">
    <!-- Fireworks Container - positioned fixed to cover the entire viewport -->
    <div id="fireworks-display" class="fireworks-container">
        <canvas id="fireworks-canvas"></canvas>
    </div>

    <!-- Main Application Container -->
    <div id="main-app-container" class="min-h-screen flex flex-col">

        <!-- Firebase Authentication Container (Login/Signup Form) -->
        <div id="auth-container" class="flex flex-grow items-center justify-center p-6 relative overflow-hidden">
            <!-- Animated Blobs Background -->
            <div class="blob blob-1"></div>
            <div class="blob blob-2"></div>
            <div class="blob blob-3"></div>

            <div class="bg-white p-8 sm:p-10 rounded-3xl shadow-soft-xl text-center w-full max-w-lg border border-vsrep-gray-light
                         transition-all duration-300 hover:scale-[1.005] hover:shadow-xl relative z-10">
                <div class="mb-8 animate-slideInUp relative z-10">
                    <img src="https://placehold.co/100x100/2c7ac2/ffffff?text=VSREP" alt="VSREP Logo" class="mx-auto mb-4 rounded-full shadow-md animate-pulseFade">
                    <h2 class="text-4xl font-extrabold text-vsrep-blue-dark mb-3 leading-tight">
                        Welcome to VSREP Hub
                    </h2>
                    <p class="text-vsrep-gray-medium text-lg max-w-md mx-auto">
                        Secure access to exclusive resources for our students and faculty.
                    </p>
                </div>

                <!-- Login/Signup Toggle Tabs -->
                <div class="flex justify-center mb-8 relative z-10 animate-fadeIn" style="animation-delay: 0.2s;">
                    <button id="show-login" class="px-6 py-3 rounded-l-full text-lg font-bold transition-all duration-300
                                                 bg-vsrep-blue-dark text-white shadow-md hover:bg-vsrep-blue-medium">
                        Login
                    </button>
                    <button id="show-signup" class="px-6 py-3 rounded-r-full text-lg font-bold transition-all duration-300
                                                 bg-vsrep-gray-medium text-white shadow-md hover:bg-vsrep-gray-dark">
                        Sign Up
                    </button>
                </div>

                <form id="auth-form" class="space-y-6 relative z-10 animate-slideInUp" style="animation-delay: 0.3s;">
                    <div>
                        <label for="auth-email" class="block text-left text-vsrep-gray-dark font-semibold text-lg mb-2">Email Address</label>
                        <input type="email" id="auth-email" placeholder="your.email@example.com" required
                               class="w-full px-5 py-3 border border-vsrep-gray-light rounded-lg text-lg text-vsrep-gray-dark
                                     focus:outline-none focus:border-vsrep-blue-dark focus:shadow-input-focus transition-all duration-200">
                        <p id="email-error" class="error-message"></p>
                    </div>

                    <div class="password-input-group">
                        <label for="auth-password" class="block text-left text-vsrep-gray-dark font-semibold text-lg mb-2">Password</label>
                        <input type="password" id="auth-password" placeholder="••••••••" required
                               class="w-full px-5 py-3 border border-vsrep-gray-light rounded-lg text-lg text-vsrep-gray-dark
                                     focus:outline-none focus:border-vsrep-blue-dark focus:shadow-input-focus transition-all duration-200">
                        <span class="password-toggle" data-target="auth-password"><i class="fas fa-eye"></i></span>
                        <p id="password-error" class="error-message"></p>
                    </div>

                    <div id="confirm-password-group" class="password-input-group hidden">
                        <label for="auth-confirm-password" class="block text-left text-vsrep-gray-dark font-semibold text-lg mb-2">Confirm Password</label>
                        <input type="password" id="auth-confirm-password" placeholder="••••••••"
                               class="w-full px-5 py-3 border border-vsrep-gray-light rounded-lg text-lg text-vsrep-gray-dark
                                     focus:outline-none focus:border-vsrep-blue-dark focus:shadow-input-focus transition-all duration-200">
                        <span class="password-toggle" data-target="auth-confirm-password"><i class="fas fa-eye"></i></span>
                        <p id="confirm-password-error" class="error-message"></p>
                    </div>
                    
                    <div class="flex items-center justify-between text-vsrep-gray-medium text-base">
                        <label for="remember-me-checkbox" class="flex items-center cursor-pointer select-none">
                            <input type="checkbox" id="remember-me-checkbox" class="h-5 w-5 rounded-md accent-vsrep-blue-dark focus:ring-2 focus:ring-vsrep-blue-dark transition-colors duration-200">
                            <span class="ml-2">Remember Me</span>
                        </label>
                        <a href="#" id="forgot-password-link" class="text-vsrep-blue-medium hover:underline hover:text-vsrep-blue-dark transition-colors duration-200">Forgot Password?</a>
                    </div>

                    <button type="submit" id="main-auth-button" class="w-full py-4 bg-vsrep-blue-dark text-white font-bold text-xl rounded-xl
                                                                       shadow-lg button-shimmer overflow-hidden relative group
                                                                       hover:bg-vsrep-blue-medium transform hover:-translate-y-1 transition-all duration-300
                                                                       hover:shadow-button-hover-blue">
                        Login
                        <span class="absolute inset-0 block bg-gradient-to-r from-transparent via-white/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 animate-shimmer"></span>
                    </button>
                </form>
                <p id="auth-message" class="mt-8 text-vsrep-red flex items-center justify-center gap-2 min-h-[1.5rem] font-medium transition-all duration-300 ease-in-out">
                    <i id="auth-message-icon" class="fas text-xl"></i>
                    <span id="auth-message-text"></span>
                </p>
            </div>
        </div>

        <!-- Main Application Content (Initially Hidden) -->
        <div id="app-content">
            <!-- Top Navigation Menu -->
            <nav class="sticky top-0 z-40 bg-vsrep-blue-dark py-3 shadow-md">
                <div class="max-w-7xl mx-auto px-4 lg:px-8 flex flex-col sm:flex-row items-center justify-between">
                    <ul class="flex flex-wrap justify-center sm:justify-start gap-4 sm:gap-6 lg:gap-8 list-none m-0 p-0 mb-3 sm:mb-0">
                        <li class="group">
                            <a href="index.html" class="block text-white font-semibold text-base lg:text-lg px-4 py-2 rounded-lg transition-all duration-300 relative overflow-hidden
                                                         hover:bg-vsrep-blue-light/20 hover:scale-105 hover:shadow-md">
                                Home
                                <span class="absolute bottom-0 left-1/2 -translate-x-1/2 w-0 h-0.5 bg-white transition-all duration-300 group-hover:w-4/5"></span>
                            </a>
                        </li>
                        <li class="group">
                            <a href="AcademicSupportResourcesConsentAndTOS.html" class="block text-white font-semibold text-base lg:text-lg px-4 py-2 rounded-lg transition-all duration-300 relative overflow-hidden
                                                         hover:bg-vsrep-blue-light/20 hover:scale-105 hover:shadow-md">
                                Learning Support
                                <span class="absolute bottom-0 left-1/2 -translate-x-1/2 w-0 h-0.5 bg-white transition-all duration-300 group-hover:w-4/5"></span>
                            </a>
                        </li>
                        <li class="group">
                            <a href="Calendar.html" class="block text-white font-semibold text-base lg:text-lg px-4 py-2 rounded-lg transition-all duration-300 relative overflow-hidden
                                                         hover:bg-vsrep-blue-light/20 hover:scale-105 hover:shadow-md">
                                Calendar
                                <span class="absolute bottom-0 left-1/2 -translate-x-1/2 w-0 h-0.5 bg-white transition-all duration-300 group-hover:w-4/5"></span>
                            </a>
                        </li>
                        <li class="group">
                            <a href="https://www.vsrep.org/anonymous-reporting-form" target="_blank" rel="noopener noreferrer" class="block text-white font-semibold text-base lg:text-lg px-4 py-2 rounded-lg transition-all duration-300 relative overflow-hidden
                                                         hover:bg-vsrep-blue-light/20 hover:scale-105 hover:shadow-md">
                                Complaints
                                <span class="absolute bottom-0 left-1/2 -translate-x-1/2 w-0 h-0.5 bg-white transition-all duration-300 group-hover:w-4/5"></span>
                            </a>
                        </li>
                    </ul>
                    <!-- Logout Button -->
                    <div id="logout-button-container" class="mt-3 sm:mt-0 hidden">
                        <button id="logout-button" class="bg-vsrep-red text-white py-2 px-5 rounded-lg text-lg font-medium shadow-md
                                                         hover:bg-red-700 transform hover:-translate-y-0.5 transition-all duration-200
                                                         hover:shadow-button-hover-red">
                            Logout <i class="fas fa-sign-out-alt ml-2"></i>
                        </button>
                    </div>
                </div>
            </nav>

            <!-- New: Pharmacology Unit 3 Updates Notification -->
            <div id="pharmacology-update-notification" class="hidden bg-gradient-to-r from-vsrep-blue-medium to-vsrep-blue-dark text-white p-4 sm:p-5 rounded-b-3xl shadow-xl
                                                                flex items-center justify-between gap-4 animate-slideInDown relative z-30 overflow-hidden">
                <div class="absolute inset-0 bg-white/10 opacity-20 animate-shimmer pointer-events-none"></div>
                <div class="flex items-center flex-grow">
                    <i class="fas fa-flask text-3xl sm:text-4xl mr-3 sm:mr-4 text-vsrep-blue-light animate-icon-bounce"></i> <!-- Changed to animate-icon-bounce -->
                    <p class="text-lg sm:text-xl font-semibold">
                        <span class="block sm:inline">Important Update:</span> Pharmacology Unit 3 content has been published!
                    </p>
                </div>
                <button id="dismiss-pharmacology-update" class="text-vsrep-blue-light hover:text-white transition-all duration-300 text-2xl p-2 rounded-full hover:bg-white/20 hover:scale-110"> <!-- Added hover effects -->
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="max-w-7xl mx-auto px-6 lg:px-8 py-12 md:py-16">
                <!-- Welcome Section with User Name -->
                <header class="text-center p-8 md:p-12 bg-vsrep-blue-light/50 rounded-3xl mb-12 shadow-md border border-vsrep-gray-light animate-fadeIn">
                    <h1 class="text-5xl font-extrabold text-vsrep-blue-dark mb-4 leading-tight">
                        Welcome, <span id="welcome-user-name">Guest</span>!
                    </h1>
                    <!-- New: Happy 4th of July Celebration -->
                    <div id="fourth-of-july-message" class="relative inline-block text-4xl font-extrabold text-fourth-red mb-6 animate-fireworksPop">
                        <span class="text-fourth-blue">Happy</span> 
                        <span class="text-fourth-dark">4th</span> <!-- Changed to fourth-dark for better visibility -->
                        <span class="text-fourth-red">of</span> 
                        <span class="text-fourth-blue">July!</span>
                        <i class="fas fa-firecracker firecracker-icon text-fourth-red text-5xl absolute -top-8 -right-8 animate-firecracker"></i>
                        <!-- Sparkles for the text -->
                        <span class="sparkle text-fourth-red sparkle-1"></span>
                        <span class="sparkle text-fourth-blue sparkle-2"></span>
                        <span class="sparkle text-fourth-red sparkle-3"></span>
                        <span class="sparkle text-fourth-blue sparkle-4"></span>
                        <span class="sparkle text-fourth-red sparkle-5"></span>
                    </div>
                    <p class="text-vsrep-gray-medium text-xl max-w-2xl mx-auto">
                        Your central hub for support, scheduling, and student resources.
                    </p>
                </header>

                <main>
                    <!-- New: Introduction Video Section -->
                    <section class="bg-white p-8 md:p-10 rounded-3xl mb-12 shadow-xl border border-vsrep-gray-light
                                     transition-all duration-300 hover:scale-[1.005] hover:shadow-2xl">
                        <h2 class="text-3xl sm:text-4xl font-extrabold text-vsrep-blue-dark mb-8 pb-5 border-b-4 border-vsrep-blue-dark/20 flex items-center justify-center">
                            <i class="fas fa-video mr-3 text-vsrep-blue-medium"></i> Introduction to VSREP Hub
                        </h2>
                        <div class="relative w-full overflow-hidden rounded-xl shadow-lg" style="padding-top: 56.25%;"> <!-- 16:9 Aspect Ratio -->
                            <div class="absolute top-0 left-0 w-full h-full">
                                <!-- New Video Embed Code -->
                                <div class="sp-embed-player" data-id="cTif0ynlrME">
                                    <script src="https://go.screenpal.com/player/appearance/cTif0ynlrME"></script>
                                    <iframe width="100%" height="100%" style="border:0;" scrolling="no" src="https://go.screenpal.com/player/cTif0ynlrME?width=100%&height=100%&ff=1&title=0" allowfullscreen="true"></iframe>
                                </div>
                            </div>
                        </div>
                        <p class="text-vsrep-gray-medium text-center mt-6">
                            Watch this short video to get a quick overview of the VSREP Hub and its features.
                        </p>
                    </section>

                    <section class="bg-white p-8 md:p-10 rounded-3xl mb-12 shadow-xl border border-vsrep-gray-light
                                     transition-all duration-300 hover:scale-[1.005] hover:shadow-2xl">
                        <h2 class="text-3xl sm:text-4xl font-extrabold text-vsrep-blue-dark mb-8 pb-5 border-b-4 border-vsrep-blue-dark/20 flex items-center justify-center">
                            <i class="fas fa-handshake mr-3 text-vsrep-blue-medium"></i> Quick Access
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 justify-center">
                            <!-- Card 1: Anonymous Issue Reporting -->
                            <a href="https://www.vsrep.org/anonymous-reporting-form" target="_blank" rel="noopener noreferrer"
                               class="relative overflow-hidden group bg-vsrep-red/10 border border-vsrep-red text-vsrep-red
                                     p-8 rounded-2xl text-center font-bold text-xl flex flex-col items-center justify-center space-y-4
                                     shadow-lg transition-all duration-300 hover:shadow-card-hover hover:scale-105">
                                <div class="absolute inset-0 bg-vsrep-red opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>
                                <i class="fas fa-mask text-5xl leading-none transition-transform duration-300 group-hover:scale-110"></i>
                                <span class="block">Anonymous Issue Reporting</span>
                                <div class="absolute inset-0 pointer-events-none button-shimmer"></div>
                            </a>
                            
                            <!-- Card 2: Calendar / Upcoming Events -->
                            <a href="Calendar.html"
                               class="relative overflow-hidden group bg-vsrep-green/10 border border-vsrep-green text-vsrep-green
                                     p-8 rounded-2xl text-center font-bold text-xl flex flex-col items-center justify-center space-y-4
                                     shadow-lg transition-all duration-300 hover:shadow-card-hover hover:scale-105">
                                <div class="absolute inset-0 bg-vsrep-green opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>
                                <i class="fas fa-calendar-alt text-5xl leading-none transition-transform duration-300 group-hover:scale-110"></i>
                                <span class="block">Calendar / Upcoming Events</span>
                                <div class="absolute inset-0 pointer-events-none button-shimmer"></div>
                            </a>
                            
                            <!-- Card 3: Academic Support Resources -->
                            <a href="AcademicSupportResourcesConsentAndTOS.html"
                               class="relative overflow-hidden group bg-vsrep-blue-light border border-vsrep-blue-medium text-vsrep-blue-dark
                                     p-8 rounded-2xl text-center font-bold text-xl flex flex-col items-center justify-center space-y-4
                                     shadow-lg transition-all duration-300 hover:shadow-card-hover hover:scale-105">
                                <div class="absolute inset-0 bg-vsrep-blue-medium opacity-0 group-hover:opacity-10 transition-opacity duration-300"></div>
                                <i class="fas fa-graduation-cap text-5xl leading-none transition-transform duration-300 group-hover:scale-110"></i>
                                <span class="block">Academic Support Resources</span>
                                <div class="absolute inset-0 pointer-events-none button-shimmer"></div>
                            </a>
                        </div>
                    </section>

                    <!-- Dynamic Announcements/News Section -->
                    <section class="bg-white p-8 md:p-10 rounded-3xl mb-12 shadow-xl border border-vsrep-gray-light
                                     transition-all duration-300 hover:scale-[1.005] hover:shadow-2xl">
                        <h2 class="text-3xl sm:text-4xl font-extrabold text-vsrep-blue-dark mb-8 pb-5 border-b-4 border-vsrep-blue-dark/20 flex items-center justify-center">
                            <i class="fas fa-bullhorn mr-3 text-vsrep-orange"></i> Important Announcements
                        </h2>
                        <div class="space-y-6">
                            <div class="bg-vsrep-blue-light/50 p-6 rounded-xl border border-vsrep-gray-light flex items-start space-x-4">
                                <i class="fas fa-info-circle text-vsrep-blue-medium text-3xl mt-1"></i>
                                <div>
                                    <h3 class="text-xl font-bold text-vsrep-blue-dark mb-1">Hub Maintenance Scheduled</h3>
                                    <p class="text-vsrep-gray-medium text-base">
                                        The VSREP Hub will undergo scheduled maintenance on **July 15th, 2 AM - 4 AM EST**.
                                        Access may be briefly interrupted. We apologize for any inconvenience.
                                    </p>
                                </div>
                            </div>
                            <div class="bg-vsrep-green/10 p-6 rounded-xl border border-vsrep-gray-light flex items-start space-x-4">
                                <i class="fas fa-star text-vsrep-green text-3xl mt-1"></i>
                                <div>
                                    <h3 class="text-xl font-bold text-vsrep-blue-dark mb-1">New Study Resources Added!</h3>
                                    <p class="text-vsrep-gray-medium text-base">
                                        Exciting new study guides and practice quizzes for Nursing Semester 2 have been uploaded.
                                        Check out the "Academic Support Resources" section!
                                    </p>
                                </div>
                            </div>
                            <!-- More announcements can be added here -->
                        </div>
                    </section>
                </main>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-vsrep-blue-dark text-white py-8 px-6 mt-auto rounded-t-3xl shadow-lg">
            <div class="max-w-7xl mx-auto text-center md:flex md:justify-between md:items-center">
                <div class="mb-4 md:mb-0">
                    <h3 class="text-2xl font-bold mb-1">VSREP Hub</h3>
                    <p class="text-vsrep-blue-light text-sm">Empowering your success.</p>
                </div>
                <div class="mb-4 md:mb-0">
                    <ul class="flex flex-wrap justify-center gap-x-6 gap-y-2 list-none m-0 p-0">
                        <li><a href="index.html" class="text-white hover:text-vsrep-blue-light transition-colors text-sm">Home</a></li>
                        <li><a href="AcademicSupportResourcesConsentAndTOS.html" class="text-white hover:text-vsrep-blue-light transition-colors text-sm">Learning Support</a></li>
                        <li><a href="Calendar.html" class="text-white hover:text-vsrep-blue-light transition-colors text-sm">Calendar</a></li>
                        <li><a href="https://www.vsrep.org/anonymous-reporting-form" target="_blank" rel="noopener noreferrer" class="text-white hover:text-vsrep-blue-light transition-colors text-sm">Complaints</a></li>
                    </ul>
                </div>
                <div>
                    <p class="text-vsrep-blue-light text-sm">&copy; 2025 Cole Ashton for VSREP. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Firebase SDK Imports -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged, 
            sendPasswordResetEmail,
            setPersistence, 
            browserLocalPersistence, 
            browserSessionPersistence 
        } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";

        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBj6SkqR0iNxNTRMA3x7qske9cmZ6pwpV8",
            authDomain: "vsrep-92201.firebaseapp.com",
            projectId: "vsrep-92201",
            storageBucket: "vsrep-92201.appspot.com",
            messagingSenderId: "833328760520",
            appId: "1:833328760520:web:c25191e71a3ae31a55c7fd",
            measurementId: "G-WQKB2E7CLH"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // --- UI Elements ---
        const authContainer = document.getElementById('auth-container');
        const appContent = document.getElementById('app-content');
        const authEmailInput = document.getElementById('auth-email');
        const authPasswordInput = document.getElementById('auth-password');
        const authConfirmPasswordInput = document.getElementById('auth-confirm-password'); 
        const mainAuthButton = document.getElementById('main-auth-button'); 
        const logoutButton = document.getElementById('logout-button');
        const logoutButtonContainer = document.getElementById('logout-button-container');
        const authMessage = document.getElementById('auth-message');
        const authMessageIcon = document.getElementById('auth-message-icon');
        const authMessageText = document.getElementById('auth-message-text');
        const forgotPasswordLink = document.getElementById('forgot-password-link');
        const rememberMeCheckbox = document.getElementById('remember-me-checkbox');

        const showLoginButton = document.getElementById('show-login'); 
        const showSignupButton = document.getElementById('show-signup'); 
        const confirmPasswordGroup = document.getElementById('confirm-password-group'); 
        const welcomeUserName = document.getElementById('welcome-user-name'); 

        // New: Pharmacology update notification elements
        const pharmacologyUpdateNotification = document.getElementById('pharmacology-update-notification');
        const dismissPharmacologyUpdateBtn = document.getElementById('dismiss-pharmacology-update');

        // New: 4th of July elements
        const fourthOfJulyMessage = document.getElementById('fourth-of-july-message');
        const fireworksDisplay = document.getElementById('fireworks-display'); // This is the container for the canvas

        let isLoginMode = true; // Track current mode (login by default)

        // --- Helper Functions ---

        // Function to switch between Login and Signup forms
        function setAuthMode(mode) {
            isLoginMode = (mode === 'login');

            // Update button styles
            if (isLoginMode) {
                showLoginButton.classList.add('bg-vsrep-blue-dark', 'text-white');
                showLoginButton.classList.remove('bg-vsrep-gray-medium', 'hover:bg-vsrep-gray-dark');
                showSignupButton.classList.add('bg-vsrep-gray-medium', 'text-white');
                showSignupButton.classList.remove('bg-vsrep-blue-dark', 'hover:bg-vsrep-blue-medium');
                mainAuthButton.textContent = 'Login';
                mainAuthButton.classList.remove('hover:shadow-button-hover-gray');
                mainAuthButton.classList.add('hover:shadow-button-hover-blue');

                confirmPasswordGroup.classList.add('hidden');
                forgotPasswordLink.classList.remove('hidden'); // Show forgot password for login
            } else {
                showSignupButton.classList.add('bg-vsrep-blue-dark', 'text-white');
                showSignupButton.classList.remove('bg-vsrep-gray-medium', 'hover:bg-vsrep-gray-dark');
                showLoginButton.classList.add('bg-vsrep-gray-medium', 'text-white');
                showLoginButton.classList.remove('bg-vsrep-blue-dark', 'hover:bg-vsrep-blue-medium');
                mainAuthButton.textContent = 'Create Account';
                mainAuthButton.classList.remove('hover:shadow-button-hover-blue');
                mainAuthButton.classList.add('hover:shadow-button-hover-gray');

                confirmPasswordGroup.classList.remove('hidden');
                forgotPasswordLink.classList.add('hidden'); // Hide forgot password for signup
            }
            displayAuthMessage('', false); // Clear messages on mode switch
            clearInputFeedback(authEmailInput);
            clearInputFeedback(authPasswordInput);
            // Clear confirm password input feedback only if element exists
            if (authConfirmPasswordInput) clearInputFeedback(authConfirmPasswordInput);
            
            authEmailInput.value = '';
            authPasswordInput.value = '';
            if (authConfirmPasswordInput) authConfirmPasswordInput.value = '';
            rememberMeCheckbox.checked = false; // Reset remember me
        }

        // Function to display messages to the user
        function displayAuthMessage(message, isSuccess = false) {
            authMessageText.textContent = message; 
            authMessage.className = 'mt-8 flex items-center justify-center gap-2 min-h-[1.5rem] font-medium transition-all duration-300 ease-in-out opacity-0'; // Reset classes and hide

            authMessageIcon.className = 'fas text-xl'; // Reset icon classes

            if (isSuccess) {
                authMessage.classList.add('text-vsrep-green');
                authMessageIcon.classList.add('fa-check-circle');
            } else {
                authMessage.classList.add('text-vsrep-red');
                authMessageIcon.classList.add('fa-exclamation-circle');
            }

            // Trigger animation
            requestAnimationFrame(() => {
                authMessage.classList.add('opacity-100'); // Fade in
            });
        }

        // Function to clear input and error states
        function clearInputFeedback(inputElement) {
            if (inputElement) { // Check if element exists before manipulating
                inputElement.classList.remove('input-error', 'input-success');
                const errorP = document.getElementById(`${inputElement.id}-error`);
                if (errorP) errorP.textContent = '';
            }
        }

        // Function to set input error state
        function setInputError(inputElement, message) {
            if (inputElement) {
                inputElement.classList.add('input-error');
                inputElement.classList.remove('input-success');
                const errorP = document.getElementById(`${inputElement.id}-error`);
                if (errorP) errorP.textContent = message;
            }
        }

        // Function to set input success state
        function setInputSuccess(inputElement) {
            if (inputElement) {
                inputElement.classList.add('input-success');
                inputElement.classList.remove('input-error');
                const errorP = document.getElementById(`${inputElement.id}-error`);
                if (errorP) errorP.textContent = '';
            }
        }

        // Basic client-side validation
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(String(email).toLowerCase());
        }

        function validatePassword(password) {
            return password.length >= 6;
        }

        function validateForm() {
            let isValid = true;
            const email = authEmailInput.value;
            const password = authPasswordInput.value;

            clearInputFeedback(authEmailInput);
            clearInputFeedback(authPasswordInput);
            if (authConfirmPasswordInput) clearInputFeedback(authConfirmPasswordInput); // Only clear if exists

            if (!validateEmail(email)) {
                setInputError(authEmailInput, 'Please enter a valid email address.');
                isValid = false;
            } else {
                setInputSuccess(authEmailInput);
            }

            if (!validatePassword(password)) {
                setInputError(authPasswordInput, 'Password must be at least 6 characters.');
                isValid = false;
            } else {
                setInputSuccess(authPasswordInput);
            }

            if (!isLoginMode) { // Only for signup mode
                const confirmPassword = authConfirmPasswordInput ? authConfirmPasswordInput.value : '';
                if (password !== confirmPassword) {
                    setInputError(authConfirmPasswordInput, 'Passwords do not match.');
                    isValid = false;
                } else if (!validatePassword(confirmPassword)) { // Redundant if password passed, but good for direct input
                    setInputError(authConfirmPasswordInput, 'Confirm password must be at least 6 characters.');
                    isValid = false;
                } else {
                    setInputSuccess(authConfirmPasswordInput);
                }
            }

            return isValid;
        }

        // --- Fireworks Animation Logic (Canvas-based) ---
        const canvas = document.getElementById('fireworks-canvas');
        const ctx = canvas.getContext('2d');
        let fireworks = [];
        let particles = [];
        let hue = 0; // For color cycling
        let fireworkAnimationId; // To store the requestAnimationFrame ID

        // Function to resize canvas
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }

        // Particle class for firework trails and explosions
        class Particle {
            constructor(x, y, hue, isFirework = false) {
                this.x = x;
                this.y = y;
                this.isFirework = isFirework; // True for the main firework rocket, false for explosion particles
                this.hue = hue;
                this.brightness = 0;
                this.alpha = 1;
                this.decay = Math.random() * 0.015 + 0.01; // How fast the particle fades

                if (isFirework) {
                    this.angle = Math.PI / 2; // Always shoot upwards
                    this.speed = Math.random() * 10 + 5;
                    this.velocity = {
                        x: Math.cos(this.angle) * this.speed,
                        y: Math.sin(this.angle) * this.speed * -1 // Negative for upwards movement
                    };
                    this.friction = 0.99; // Slow down slightly
                    this.gravity = 0.5; // Pull down
                    this.size = 3;
                } else {
                    this.angle = Math.random() * Math.PI * 2; // Random direction for explosion
                    this.speed = Math.random() * 10 + 1;
                    this.velocity = {
                        x: Math.cos(this.angle) * this.speed,
                        y: Math.sin(this.angle) * this.speed
                    };
                    this.friction = 0.95; // More friction for explosion particles
                    this.gravity = 0.2;
                    this.size = Math.random() * 2 + 1;
                }
            }

            update() {
                if (this.isFirework) {
                    this.velocity.x *= this.friction;
                    this.velocity.y *= this.friction;
                    this.velocity.y += this.gravity; // Apply gravity
                    this.x += this.velocity.x;
                    this.y += this.velocity.y;
                    this.brightness = Math.random() * 50 + 50; // Brighter for firework trail
                } else {
                    this.velocity.x *= this.friction;
                    this.velocity.y *= this.friction;
                    this.velocity.y += this.gravity;
                    this.x += this.velocity.x;
                    this.y += this.velocity.y;
                    this.alpha -= this.decay; // Fade out
                    this.brightness = Math.random() * 30 + 50; // Explosion particles get dimmer
                }
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = `hsla(${this.hue}, 100%, ${this.brightness}%, ${this.alpha})`;
                ctx.fill();
            }
        }

        // Firework class (main rocket before explosion)
        class Firework extends Particle {
            constructor(startX, startY, targetX, targetY) {
                super(startX, startY, hue, true); // Call Particle constructor with isFirework = true
                this.targetX = targetX;
                this.targetY = targetY;
                // Calculate distance to target for accurate explosion timing
                this.distanceToTarget = Math.sqrt(Math.pow(targetX - startX, 2) + Math.pow(targetY - startY, 2));
                this.angle = Math.atan2(targetY - startY, targetX - startX);
                this.speed = 10;
                this.velocity = {
                    x: Math.cos(this.angle) * this.speed,
                    y: Math.sin(this.angle) * this.speed
                };
                this.trail = []; // For the visual trail behind the firework
                this.trailLength = 5;
            }

            update() {
                // Add current position to trail
                this.trail.push({ x: this.x, y: this.y, alpha: 1 });
                if (this.trail.length > this.trailLength) {
                    this.trail.shift(); // Remove oldest trail point
                }

                // Update firework position
                this.x += this.velocity.x;
                this.y += this.velocity.y;

                // Check if target reached (or passed)
                const distanceTraveled = Math.sqrt(Math.pow(this.x - this.trail[0].x, 2) + Math.pow(this.y - this.trail[0].y, 2));
                if (distanceTraveled >= this.distanceToTarget || this.y <= this.targetY) {
                    this.explode();
                    return true; // Indicate that this firework should be removed
                }
                return false; // Firework still active
            }

            draw() {
                // Draw trail - THIS IS NOW REMOVED FOR INSTANT DISAPPEARANCE
                // for (let i = 0; i < this.trail.length; i++) {
                //     const p = this.trail[i];
                //     ctx.beginPath();
                //     ctx.arc(p.x, p.y, this.size * (i / this.trailLength), 0, Math.PI * 2);
                //     ctx.fillStyle = `hsla(${this.hue}, 100%, 70%, ${p.alpha * (i / this.trailLength)})`;
                //     ctx.fill();
                // }

                // Draw main firework dot
                super.draw();
            }

            explode() {
                const particleCount = Math.random() * 100 + 50; // 50 to 150 particles
                for (let i = 0; i < particleCount; i++) {
                    particles.push(new Particle(this.x, this.y, this.hue, false));
                }
            }
        }

        // Animation loop for Canvas fireworks
        function animateFireworks() {
            fireworkAnimationId = requestAnimationFrame(animateFireworks);

            // Clear canvas completely each frame to remove trails
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            hue += 0.5; // Cycle colors

            // Update and draw fireworks
            for (let i = fireworks.length - 1; i >= 0; i--) {
                const firework = fireworks[i];
                if (firework.update()) {
                    fireworks.splice(i, 1); // Remove exploded firework
                } else {
                    firework.draw();
                }
            }

            // Update and draw particles
            for (let i = particles.length - 1; i >= 0; i--) {
                const particle = particles[i];
                particle.update();
                particle.draw();
                if (particle.alpha <= particle.decay) {
                    particles.splice(i, 1); // Remove faded particle
                }
            }

            // Launch new fireworks periodically
            if (Math.random() < 0.05 && fireworks.length < 5) { // Limit concurrent fireworks
                const startX = canvas.width / 2; // Always start from bottom center
                const startY = canvas.height;
                const targetX = Math.random() * canvas.width;
                const targetY = Math.random() * canvas.height / 2; // Target in upper half
                fireworks.push(new Firework(startX, startY, targetX, targetY));
            }
        }

        // Function to start the Canvas fireworks animation
        function startCanvasFireworks() {
            resizeCanvas(); // Ensure canvas is sized correctly
            fireworksDisplay.style.display = 'block'; // Show the fireworks container
            fireworkAnimationId = requestAnimationFrame(animateFireworks);
        }

        // Function to stop the Canvas fireworks animation
        function stopCanvasFireworks() {
            cancelAnimationFrame(fireworkAnimationId); // Stop the animation loop
            fireworks = []; // Clear all active fireworks
            particles = []; // Clear all active particles
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear the canvas
            fireworksDisplay.style.display = 'none'; // Hide the fireworks container
        }


        // Function to show/hide content based on authentication state
        function updateUI(user) {
            if (user) {
                // User is signed in, show app content and logout button
                authContainer.classList.add('hidden');
                appContent.classList.remove('hidden'); 
                appContent.classList.add('visible');
                logoutButtonContainer.classList.remove('hidden'); 

                // Show the pharmacology update notification after successful login
                pharmacologyUpdateNotification.classList.remove('hidden');

                // Show the 4th of July message and start fireworks
                fourthOfJulyMessage.classList.remove('hidden');
                startCanvasFireworks(); // Start the Canvas-based fireworks

                // Update welcome message with user email
                welcomeUserName.textContent = user.email || 'User'; // Fallback to 'User' if email is null/empty
                displayAuthMessage('', false); // Clear any login/signup messages
            } else {
                // User is signed out, show auth container and hide app content
                authContainer.classList.remove('hidden');
                appContent.classList.add('hidden'); 
                appContent.classList.remove('visible');
                logoutButtonContainer.classList.add('hidden'); 

                // Hide the pharmacology update notification when logged out
                pharmacologyUpdateNotification.classList.add('hidden');
                // Hide the 4th of July message and stop fireworks
                fourthOfJulyMessage.classList.add('hidden');
                stopCanvasFireworks(); // Stop the Canvas-based fireworks

                welcomeUserName.textContent = 'Guest';
                displayAuthMessage('', false); // Clear any messages on logout/initial load
            }
        }

        // --- Event Listeners ---

        // Listen for authentication state changes
        onAuthStateChanged(auth, (user) => {
            updateUI(user);
        });

        // Switch between Login/Signup modes
        showLoginButton.addEventListener('click', () => setAuthMode('login'));
        showSignupButton.addEventListener('click', () => setAuthMode('signup'));

        // Main auth button click handler (Login or Signup)
        mainAuthButton.addEventListener('click', async (e) => {
            e.preventDefault(); 
            if (!validateForm()) {
                displayAuthMessage('Please correct the errors in the form.', false);
                return;
            }

            const email = authEmailInput.value;
            const password = authPasswordInput.value;
            const rememberMe = rememberMeCheckbox.checked; 

            displayAuthMessage(isLoginMode ? 'Logging in...' : 'Creating account...', true); 

            try {
                await setPersistence(auth, rememberMe ? browserLocalPersistence : browserSessionPersistence);
                
                let userCredential;
                if (isLoginMode) {
                    userCredential = await signInWithEmailAndPassword(auth, email, password);
                    console.log('User logged in:', userCredential.user.email);
                    displayAuthMessage('Successfully logged in!', true);
                } else {
                    userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    console.log('User signed up:', userCredential.user.email);
                    displayAuthMessage('Account created and logged in successfully!', true);
                }
            } catch (error) {
                let errorMessage = 'An unknown error occurred. Please try again.';
                if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Invalid email address format.';
                } else if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                    errorMessage = 'Invalid email or password. Please try again.';
                } else if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Email address already in use. Please try logging in or resetting password.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Password is too weak (min 6 characters).';
                } else {
                    errorMessage = `Error: ${error.message}`;
                }
                console.error("Auth error:", error);
                displayAuthMessage(errorMessage, false);
            }
        });

        // Logout button click handler
        logoutButton.addEventListener('click', async () => {
            try {
                await signOut(auth);
                console.log('User logged out.');
                displayAuthMessage('You have been logged out.', true); 
                // UI will update via onAuthStateChanged listener
            } catch (error) {
                console.error("Logout error:", error);
                displayAuthMessage(`Error logging out: ${error.message}`, false);
            }
        });

        // Forgot Password link handler
        forgotPasswordLink.addEventListener('click', async (e) => {
            e.preventDefault(); 
            const email = authEmailInput.value;

            if (!email || !validateEmail(email)) {
                setInputError(authEmailInput, 'Please enter a valid email to reset password.');
                displayAuthMessage('Please enter a valid email to reset your password.', false);
                return;
            }

            displayAuthMessage('Sending password reset email...', true);
            try {
                await sendPasswordResetEmail(auth, email);
                displayAuthMessage('Password reset email sent! Check your inbox (and spam folder).', true);
            } catch (error) {
                let errorMessage = 'An error occurred while sending the password reset email.';
                if (error.code === 'auth/invalid-email') {
                    errorMessage = 'The email address is not valid.';
                } else if (error.code === 'auth/user-not-found') {
                    errorMessage = 'No user found with that email address. Please check your email.';
                } else if (error.code === 'auth/missing-email') {
                    errorMessage = 'Please enter your email address to reset your password.';
                } else {
                    errorMessage = `Error: ${error.message}`;
                }
                console.error("Password reset error:", error);
                displayAuthMessage(errorMessage, false);
            }
        });

        // Dismiss pharmacology update notification
        dismissPharmacologyUpdateBtn.addEventListener('click', () => {
            pharmacologyUpdateNotification.classList.add('hidden');
        });

        // --- Link Handling Logic ---
        document.addEventListener('DOMContentLoaded', function () {
            // Initial setup of auth mode
            setAuthMode('login');
            resizeCanvas(); // Initial resize of the fireworks canvas

            // Select all links within the #app-content that are not the logout button
            const appContentLinks = document.querySelectorAll('#app-content a:not(#logout-button)');
            
            appContentLinks.forEach(link => {
                link.addEventListener('click', function (event) {
                    // If not authenticated, prevent default on all links within app-content, 
                    // as they shouldn't be accessible. Re-direct to login if they try.
                    if (!auth.currentUser) {
                        event.preventDefault();
                        displayAuthMessage("Please log in to access this resource.", false);
                        // Scroll to top and show login form
                        authContainer.classList.remove('hidden');
                        appContent.classList.add('hidden');
                        authContainer.scrollIntoView({ behavior: 'smooth' });
                        setAuthMode('login'); // Ensure login form is active
                    }
                    // If the user IS authenticated, the link's default behavior will proceed as normal.
                });
            });

            // Add resize listener for the canvas
            window.addEventListener('resize', resizeCanvas);
        });
    </script>
</body>
</html>
